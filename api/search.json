[{"id":"20a7da5a5694f08bc83b1c325a79dd48","title":"(åˆ†æ®µåˆ†è¡¨é”)ä½¿ç”¨Golangå®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„Map","content":"\n\n\n\n\n\n\n\n\nä¸Šå›è¯´åˆ°ï¼Œç”¨Golangå®ç°äº†ä¸€ä¸ªé«˜æ€§èƒ½çš„kvï¼Œå¹¶ä¸”ä¼˜åŒ–äº†é”çš„æ“ä½œï¼Œä»Šå¤©æˆ‘ä»¬å°±ä½¿ç”¨åˆ†æ®µåˆ†è¡¨é”çš„æ€è·¯ï¼Œæ¥å°†æˆ‘ä»¬çš„Mapæ€§èƒ½æå‡åˆ°ä¸€ä¸ªæ–°çš„é«˜åº¦ï¼Œç›¸å…³è§†é¢‘æ•™ç¨‹åœ¨å…¨æ–‡çš„æœ€åï¼Œå¯ä»¥ç‚¹å‡»ç›®å½•ä¸­çš„é”šç‚¹å¿«é€Ÿå‰å¾€\næœ¬blogçš„å¯¹åº”GitHubä»“åº“ä¸º: sunist-c/toy-frameworkï¼Œå°†ä½œä¸ºtoy-frameworkçš„ç»„ä»¶å­˜åœ¨ï¼Œå¯èƒ½éštoy-frameworkä¸€åŒæ›´æ–°\næ€è·¯é—®é¢˜äº§ç”Ÿgoå†…ç½®çš„mapæ˜¯å¹¶å‘ä¸å®‰å…¨çš„ï¼Œæ¯”å¦‚åœ¨ä¸‹é¢çš„å‡½æ•°ä¸­ï¼š\nfunc Function() {\n    m := make(map[int]int)\n    for i := 0; i &lt; 100; i++ {\n        go func(index int) {\n            key, value := index, rand.Int()\n            m[key] = value\n            v, ok := m[key]\n            fmt.Printf(\"%v-%v\\n\", ok, v == value)\n        }(i)\n    }\n}\n\næˆ‘ä»¬å¯ç”¨äº†100ä¸ªgoç¨‹ï¼Œå¹¶å‘åœ°å‘m := map[int]intå†™å…¥æ•°æ®ï¼Œç”šè‡³æ²¡æœ‰å¯¹åŒä¸€ä¸ªkeyå€¼è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯åœ¨å®é™…æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªå‡½æ•°ä¼šæŠ¥ä¸‹é¢çš„panicï¼š\nfatal error: concurrent map writes\n\né€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ï¼Œgoå†…ç½®çš„mapçš„å­˜å‚¨åº•å±‚ç»“æ„æ˜¯bucketï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªbucketå¯ä»¥å­˜å‚¨å…«ä¸ªKey-Value pairï¼Œä½†æ˜¯å½“bucketå·²ç»å­˜å‚¨æ»¡å…«ä¸ªKVå¯¹ä»¥åï¼Œä¾¿ä¼šè§¦å‘mapçš„æ‰©å®¹æœºåˆ¶(æ­¤æœºåˆ¶ä¸åœ¨æ­¤å¤„å±•å¼€)ï¼Œæ‰©å®¹ä¸­çš„mapæ˜¯æ— æ³•è¿›è¡Œæ“ä½œçš„ï¼Œè‹¥ä¸€ä¸ªgoroutineå¯¹mapè¿›è¡Œå†™æ“ä½œå¹¶ä¸”è§¦å‘æ‰©å®¹æœºåˆ¶æ—¶ï¼Œæ­¤æ—¶å…¶ä»–goroutineç»§ç»­æ“ä½œè¿™ä¸ªmapçš„è¯ï¼Œä¾¿ä¼šæŠ¥å‡ºä¸Šé¢æ‰€è¿°çš„concurrent map writes\nç®€å•æ”¹è¿›è§£å†³ä¸Šé¢è¿™ä¸€é—®é¢˜æœ€ç®€å•çš„æ–¹æ³•ä¾¿æ˜¯å¯¹mapåŠ ä¸€ä¸ªé”ï¼ŒåŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªgoroutineå¯¹mapè¿›è¡Œæ“ä½œï¼Œå…¶ä½™goroutineéƒ½éœ€è¦ç­‰å¾…æ­£åœ¨è¿›è¡Œæ“ä½œçš„goroutineå®Œæˆæ“ä½œé‡Šæ”¾é”åï¼Œå†è¿›è¡Œç«äº‰å¹¶è·å–é”\näºæ˜¯æˆ‘ä»¬çš„mapä¾¿æˆä¸ºäº†ä¸‹é¢çš„æ ·å­ï¼š\ntype AnotherMap[Key, Value any] struct {\n    mu *sync.Mutex\n    mp map[any]Value\n}\n\n\n\n\n\n\n\n\n\n\nä¸Šé¢è¿™æ®µä»£ç é‡‡ç”¨äº†go 1.18åŠä»¥ä¸Šç‰ˆæœ¬çš„æ³›å‹(Generics)è¯­æ³•ï¼Œå®é™…é‡‡ç”¨æ—¶è¯·æ³¨æ„goè¯­è¨€ç‰ˆæœ¬\næˆ‘ä»¬åœ¨å¯¹AnotherMapè¿›è¡Œæ“ä½œå‰ï¼Œå¯¹åº”çš„å‡½æ•°éƒ½éœ€è¦å°†muè¿›è¡ŒLock()æ“ä½œï¼Œæ“ä½œå®Œæˆåè¿›è¡ŒUnLock()æ“ä½œï¼Œä»¥æ­¤æ¥ä¿è¯åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªgoroutineèƒ½å¤Ÿå¯¹mpè¿›è¡Œæ“ä½œ\n\n\n\n\n\n\näº’æ–¥é”çš„ç‰¹å¾\näº’æ–¥é”(Mutex)å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š\n\né”æœ‰ä¸”ä»…æœ‰Lockedå’ŒUnlockedä¸¤ä¸ªçŠ¶æ€\nå½“é”å¤„äºLockedçŠ¶æ€æ—¶ï¼Œå…¶ä»–goroutineséƒ½ä¸èƒ½ç”³è¯·é”\nå½“é”å¤„äºUnlockedçŠ¶æ€æ—¶ï¼Œå…¶ä»–goroutinesæ‰å¯ä»¥ç”³è¯·é”\n\nå³åŒä¸€æ—¶é—´æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªgoroutineå¯ä»¥å¯¹é”è¿›è¡Œå ç”¨\n\nè¿™ä¸ªæ”¹è¿›çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š\n\nç‚¹å‡»å±•å¼€ä»¥æ˜¾ç¤ºä»£ç \npackage toy_kv\n\nimport (\n\t\"sync\"\n)\n\ntype CommonMap[Key, Value any] struct {\n\tmu *sync.Mutex\n\tm  map[any]Value\n}\n\nfunc (c *CommonMap[Key, Value]) Load(key Key) (value Value, ok bool) {\n\tc.mu.Lock()\n\tdefer c.mu.Unlock()\n\tgot, gotten := c.m[key]\n\treturn got, gotten\n}\n\nfunc (c *CommonMap[Key, Value]) Store(key Key, value Value) {\n\tc.mu.Lock()\n\tdefer c.mu.Unlock()\n\tc.m[key] = value\n}\n\nfunc (c *CommonMap[Key, Value]) Delete(key Key) {\n\tc.mu.Lock()\n\tdefer c.mu.Unlock()\n\tdelete(c.m, key)\n}\n\nfunc (c *CommonMap[Key, Value]) Range(f func(key Key, value Value) bool) {\n\tc.mu.Lock()\n\tdefer c.mu.Unlock()\n\tfor k, v := range c.m {\n\t\tif !f(k.(Key), v) {\n\t\t\treturn\n\t\t}\n\t}\n}\n\nfunc NewCommonMap[Key, Value any]() IMap[Key, Value] {\n\treturn &amp;CommonMap[Key, Value]{\n\t\tmu: &amp;sync.Mutex{},\n\t\tm:  make(map[any]Value),\n\t}\n}\n\n\nä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨äº†äº’æ–¥é”ï¼Œå¯¼è‡´äº†å¹¶å‘è¯·æ±‚åœ¨å®é™…å¤„ç†çš„æ—¶å€™ï¼Œå…¶å®æ˜¯ä¸²è¡Œå¤„ç†ï¼Œè€Œä¸æ˜¯å¹¶è¡Œå¤„ç†çš„ï¼Œå¯¼è‡´äº†æˆ‘ä»¬çš„mapå¹¶è¡Œæ€§èƒ½å’Œä¸²è¡Œæ€§èƒ½å…¶å®æ˜¯æ²¡æœ‰å·®åˆ«çš„ï¼Œè¿›è€Œäº§ç”Ÿç›¸å…³çš„æ€§èƒ½é—®é¢˜\nè¿›ä¸€æ­¥æ”¹è¿›ä½†å½“æˆ‘ä»¬ä»”ç»†å®¡è§†ä¸Šé¢é‚£ä¸ªç®€å•ç²—æš´çš„ï¼Œä½¿ç”¨äº’æ–¥é”çš„æ”¹è¿›åï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ä¸€ä¸ªé—®é¢˜ï¼š\nå½“mapæ²¡æœ‰è¿›è¡Œå†™æ“ä½œ(å³å¯èƒ½é€ æˆæ‰©å®¹ã€ç¼©æ¡¶æƒ…å†µ)çš„æ—¶å€™ï¼Œæ­¤æ—¶mapæ—¶å¯ä»¥è¿›è¡Œå¹¶å‘è¯»çš„ï¼Œå¹¶ä¸”æ— è®ºå¤šå°‘ä¸ªgoroutineè¿›è¡Œå¹¶å‘è¯»å–ï¼Œmapéƒ½æ˜¯å®‰å…¨çš„\n\n\n\n\n\n\nè¯»å†™é”çš„ç‰¹å¾\nè¯»å†™é”(RWMutex)å…·æœ‰ä¸‹é¢çš„ç‰¹å¾ï¼š\n\né”åˆ†ä¸ºReadLock(è¯»é”)å’ŒWriteLock(å†™é”)\nå½“é”çš„ç±»å‹ä¸ºReadLockçš„æ—¶å€™ï¼Œä¸å¯ä»¥ç”³è¯·WriteLockï¼Œåä¹‹äº¦ç„¶\nå½“é”çš„ç±»å‹ä¸ºReadLockçš„æ—¶å€™ï¼Œå…¶ä»–goroutineså¯ä»¥ç»§ç»­ç”³è¯·ReadLock\nå½“é”çš„ç±»å‹ä¸ºWriteLockçš„æ—¶å€™ï¼Œå…¶ä»–goroutinesä¸å¯ä»¥ç»§ç»­ç”³è¯·WriteLock\n\n\n\nè¯»å†™é”çš„ç‰¹å¾ä¸æˆ‘ä»¬mapçš„æƒ…å†µç›¸å½“ä¸€è‡´ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¯»å†™é”æ¥å¯¹mapè¿›è¡Œå¹¶å‘æ§åˆ¶ï¼Œåœ¨è¿›è¡Œè¯»æ“ä½œçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç”³è¯·è¯»é”ï¼Œåœ¨è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç”³è¯·å†™é”ï¼Œç”±æ­¤æ¥æœ€å¤§é™åº¦åœ°ä¿è¯å•ä¸ªmapè¢«æœ€å¤§ç¨‹åº¦åœ°ä½¿ç”¨\né‚£ä¹ˆç°åœ¨æˆ‘ä»¬çš„mapä¾¿å˜æˆäº†ä¸‹é¢çš„ç»“æ„ï¼š\ntype AnotherMap[Key, Value any] struct {\n\tmu *sync.RWMutex\n\tmp map[any]Value\n}\n\nè¿™ä¸ªæ”¹è¿›çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š\n\nç‚¹å‡»å±•å¼€ä»¥æ˜¾ç¤ºä»£ç \npackage toy_kv\n\nimport \"sync\"\n\ntype SimpleMap[Key, Value any] struct {\n\tmu *sync.RWMutex\n\tmp map[any]Value\n}\n\nfunc (m *SimpleMap[Key, Value]) Load(key Key) (value Value, ok bool) {\n\tm.mu.RLock()\n\tdefer m.mu.RUnlock()\n\tgot, gotten := m.mp[key]\n\treturn got, gotten\n}\n\nfunc (m *SimpleMap[Key, Value]) Store(key Key, value Value) {\n\tm.mu.Lock()\n\tdefer m.mu.Unlock()\n\tm.mp[key] = value\n}\n\nfunc (m *SimpleMap[Key, Value]) Delete(key Key) {\n\tm.mu.Lock()\n\tdefer m.mu.Unlock()\n\tdelete(m.mp, key)\n}\n\nfunc (m *SimpleMap[Key, Value]) Range(f func(key Key, value Value) bool) {\n\tm.mu.Lock()\n\tdefer m.mu.Unlock()\n\tfor k, v := range m.mp {\n\t\tif !f(k.(Key), v) {\n\t\t\treturn\n\t\t}\n\t}\n}\n\nfunc NewSimpleMap[Key, Value any]() IMap[Key, Value] {\n\treturn &amp;SimpleMap[Key, Value]{\n\t\tmu: &amp;sync.RWMutex{},\n\t\tmp: map[any]Value{},\n\t}\n}\n\n\næ›´è¿›ä¸€æ­¥æ”¹è¿›åœ¨ä¸Šé¢çš„ã€Œè¿›ä¸€æ­¥æ”¹è¿›ã€ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œå…¶å®æˆ‘ä»¬çš„mapåœ¨è¯»çš„æ—¶å€™æ˜¯å¹¶è¡Œæ“ä½œçš„ï¼Œä½†æ˜¯åœ¨å†™çš„æ—¶å€™æ˜¯ä¸²è¡Œæ“ä½œçš„ï¼Œå¹¶ä¸”åŒä¸€æ—¶åˆ»åªèƒ½è¿›è¡Œè¯»æˆ–è€…å†™ä¸­çš„ä¸€ç§æ“ä½œï¼Œæ— æ³•åŒæ—¶è¿›è¡Œè¯»å’Œå†™ã€‚é‚£æœ‰æ²¡æœ‰ä¸€ç§å¯èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥è®©æˆ‘ä»¬çš„mapåŒæ—¶è¿›è¡Œè¯»å’Œå†™ï¼Œå¹¶ä¸”è¯»å’Œå†™éƒ½æ˜¯å¹¶è¡Œæ“ä½œå‘¢\nç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆ†è¡¨çš„æ€è·¯ï¼šå°†æˆ‘ä»¬çš„å¤§mapåˆ†ä¸ºå¤šä»½å°mapï¼Œè¿™æ ·ï¼Œå½“å…¶ä¸­ä¸€ä¸ªmapåœ¨è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œå…¶ä½™mapä¾æ—§å¯ä»¥è¿›è¡Œå†™æ“ä½œï¼Œè¾¾åˆ°äº†æ”¯æŒå¹¶å‘è¯»ä¸å¹¶å‘å†™çš„æ•ˆæœã€‚å¹¶ä¸”ï¼Œå½“æˆ‘ä»¬çš„åˆ†è¡¨è¶³å¤Ÿå¤šï¼Œä¸”å…ƒç´ ç»†åˆ†è¶³å¤Ÿå‡åŒ€çš„æƒ…å†µä¸‹ï¼Œå¯¹å…¶ä¸­ä¸€ä¸ªåˆ†è¡¨çš„Lockæ“ä½œé€ æˆçš„å½±å“äºæ•´ä¸ªå¤§mapè€Œè¨€ï¼Œå°±å¯ä»¥å¿½ç•¥ä¸è®¡äº†\nç”±æ­¤ï¼Œæˆ‘ä»¬çš„mapå°±å˜æˆäº†è¿™ä¸ªæ ·å­ï¼š\ntype Table[Key, Value any] struct {\n\tmu *sync.RWMutex\n\tmp map[any]Value\n}\n\ntype AnotherMap[Key, Value any] struct {\n\ttables map[uint]*Table[Key, Value]\n}\n\næˆ‘ä»¬å¯¹mapè¿›è¡Œæ“ä½œæ—¶ï¼Œæ­¥éª¤ä¹Ÿæ›´æ”¹ä¸ºå¦‚ä¸‹ï¼š\n\nå¯¹Keyè¿›è¡Œhashï¼Œç¡®å®šå…¶è¦å­˜å…¥å“ªå¼ åˆ†è¡¨\nç”±åˆ†è¡¨å…·ä½“è¿›è¡Œæ“ä½œ\n\nè¿™ä¸€éƒ¨åˆ†çš„å®ç°å°±è¯·è½¬åˆ°ã€Œå®ç°ã€å°èŠ‚\n\n\n\n\n\n\næ›´æ›´æ›´è¿›ä¸€æ­¥æ”¹è¿›\nä¸éš¾å‘ç°ï¼Œå…¶å®é€ æˆmapå¹¶å‘ä¸å®‰å…¨çš„åŸå› ï¼Œå°±æ˜¯mapçš„æ‰©å®¹ã€ç¼©æ¡¶æœºåˆ¶ï¼Œå¦‚æœä¸€ä¸ªKeyå­˜åœ¨çš„è¯ï¼Œæˆ‘ä»¬å¯¹å®ƒè¿›è¡Œé‡æ–°èµ‹å€¼ï¼Œè™½ç„¶è¿™ä¸ªæ“ä½œæ˜¯å†™æ“ä½œï¼Œä½†ä¸ä¼šé€ æˆmapçš„panicï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†mapçš„æ“ä½œï¼š\n\næ–°å¢KV\nä¿®æ”¹KV\nåˆ é™¤å­˜åœ¨çš„KV\nåˆ é™¤ä¸å­˜åœ¨çš„KV\nè¯»å–KV\n\nä¸Šé¢çš„æ‰€æœ‰ã€ŒåŸå­ã€æ“ä½œä¸­ï¼Œåªæœ‰(1)ï¼Œ(3)éœ€è¦ç”³è¯·å†™é”ï¼Œå…¶ä½™çš„æ“ä½œå‡ä¸éœ€è¦ç”³è¯·å†™é”ï¼Œç…§æ­¤æ€è·¯è¿›è¡Œç»§ç»­æ”¹è¿›ï¼Œåˆ™mapçš„æ€§èƒ½ä¹Ÿä¼šè¿›ä¸€æ­¥æé«˜\n\nå®ç°é¦–å…ˆæˆ‘ä»¬éœ€è¦ç»™å‡ºMapçš„æ¥å£ï¼š\ntype IMap[Key, Value any] interface {\n\t// Load ä»kvä¸­è¯»å–ä¸€ä¸ªKey,è·å–å®ƒçš„Valueä»¥åŠæ˜¯å¦å­˜åœ¨\n\tLoad(key Key) (value Value, ok bool)\n\n\t// Store å‘kvä¸­å­˜å‚¨ä¸€ä¸ªKey-Value\n\tStore(key Key, value Value)\n\n\t// Delete åœ¨kvä¸­åˆ é™¤ä¸€ä¸ªKey-Value\n\tDelete(key Key)\n\n\t// Range éå†kv-map,å¯¹æ¯ä¸€ä¸ªKey-Value,å‡è°ƒç”¨f,å½“fè¿”å›falseçš„æ—¶å€™,åœæ­¢éå†\n\tRange(f func(key Key, value Value) bool)\n}\n\nHashå‡½æ•°è®¾è®¡Hashå‡½æ•°çš„è®¾è®¡æ˜¯æˆ‘ä»¬åˆ†æ®µåˆ†è¡¨é”å®ç°Mapçš„é‡ä¸­ä¹‹é‡ï¼Œå› ä¸ºä¸€ä¸ªå¥½çš„Hashå‡½æ•°å¯ä»¥Keyå‡åŒ€åœ°åˆ†å¸ƒåœ¨åˆ†è¡¨ä¸­ï¼ŒåŒæ—¶ä¹Ÿè¦å…¼é¡¾è¿ç®—é€Ÿåº¦ï¼Œä¸èƒ½åƒMD5é‚£æ ·è¿›è¡Œè¿‡äºå¤æ‚çš„è®¡ç®—ï¼Œé€ æˆæ—¶é—´ä¸Šçš„æµªè´¹\næˆ‘ä»¬æ­¤å¤„ä½¿ç”¨çš„Hashç®—æ³•ä¸ºSDBM Hashï¼Œç”±Ken Thompson(Cè¯­è¨€/Unixä¸Golangçš„è®¾è®¡è€…)å‘æ˜ï¼Œè¿™ä¸ªHashçš„ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š\nfunc sdbmHash(data []byte) uint {\n\tvar hash uint\n\tfor _, b := range data {\n\t\thash = uint(b) + (hash &lt;&lt; 6) + (hash &lt;&lt; 16) - hash\n\t}\n\n\treturn hash\n}\n\nè¿™ä¸ªhashçš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼Œå³ä¸dataçš„é•¿åº¦æœ‰å…³\né‚£ä¹ˆè½¬å›æœ¬æ–‡ï¼Œæ‘†åœ¨æˆ‘ä»¬é¢å‰çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚ä½•åœ¨ä¸çŸ¥é“Keyç±»å‹çš„æƒ…å†µä¸‹(ä¸ä½¿ç”¨reflectç¡®å®šç±»å‹çš„åŸå› æ˜¯ï¼Œreflectçš„æ€§èƒ½è¾ƒå·®)ï¼Œè·å–Keyä¸­å­˜å‚¨çš„æ•°æ®\næˆ‘ä»¬é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯unsafe.Pointerå’Œuintptr\n\n\n\n\n\n\nunsafe.Pointerå’Œuintptrçš„ç‰¹å¾\nunsafe.Pointerå…·æœ‰å¦‚ä¸‹ç‰¹å¾:\n\nä»»æ„ç±»å‹çš„æŒ‡é’ˆéƒ½å¯ä»¥è½¬åŒ–ä¸ºunsafe.Pointer\nunsafe.Pointerå¯ä»¥è½¬åŒ–ä¸ºä»»æ„ç±»å‹çš„æŒ‡é’ˆï¼Œå¹¶ä¸”å¿½ç•¥ç±»å‹æ£€æŸ¥(å³ä¸ä¼šæŠ¥é”™)\n\nuintptrå…·æœ‰å¦‚ä¸‹ç‰¹å¾:\n\nuintpträ¸æ˜¯æŒ‡é’ˆ\nunsafe.Pointerå¯ä»¥è½¬åŒ–ä¸ºuintptrï¼Œuintpträ¹Ÿå¯ä»¥è½¬åŒ–ä¸ºunsafe.Pointer\nuintptrå¯ä»¥è¿›è¡ŒæŒ‡é’ˆè¿ç®—ï¼Œå³Cè¯­è¨€çš„int *ptr = &amp;num; ptr++ä¸€ç±»çš„æ“ä½œ\nä½¿ç”¨unsafe.SizeOf(x)å¯ä»¥è·å¾—xç±»å‹çš„é•¿åº¦ï¼Œç»“æœä¸ºuintptr\nxçš„uintptråˆæ³•å–å€¼èŒƒå›´ä¸º: [uintptr(unsafe.Pointer(&amp;x)), uintptr(unsafe.Pointer(&amp;x))+unsafe.SizeOf(x)]\n\n\n\nä½¿ç”¨unsafeåŒ…æ—¶ï¼Œéœ€è¦æ ¼å¤–æ³¨æ„æ“ä½œé€»è¾‘ï¼Œä¸‹é¢æ˜¯ä½¿ç”¨unsafeåŒ…çš„ç¤ºä¾‹ä»£ç :\nfunc unsafeExample() {\n\tx := struct{\n\t\t// ...fields\n\t}{\n\t\t// ...values\n\t}\n\n\t// uintpträ¸æ˜¯æŒ‡é’ˆï¼Œéœ€è¦é˜²æ­¢xè¢«gcé‡Šæ”¾ï¼Œæ‰€ä»¥æ‰‹åŠ¨åˆ›å»ºä¸€æŒ‡é’ˆæŒ‡å‘x\n\tgc := &amp;x\n\n\t// è·å–xç›¸å…³çš„unsafeå±æ€§\n\tstartPtr := uintptr(unsafe.Pointer(gc))\n\toffset := unsafe.SizeOf(x)\n\tendPtr := startPtr + offset\n\n\t// è¿›è¡Œç›¸å…³æ“ä½œ\n\tfor ptr := startPtr; ptr &lt;= endPtr; ptr += 1 {\n\t\t// y := *(*WantType)(unsafe.Pointer(ptr))\n\t\t// ...operations\n\t}\n}\n\n\n\n\n\n\n\n\nå®‰å…¨æ€§è­¦å‘Š\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å®é™…å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨unsafe.Pointerå’Œuintptræ—¶è¦å¯¹è‡ªå·±çš„é€»è¾‘æ ¼å¤–çš„æ˜ç¡®ï¼Œä»»ä½•ä¸€ç‚¹é”™è¯¯éƒ½å¯èƒ½é€ æˆä¸¥é‡çš„åæœï¼Œæ­£å¦‚åŒ…åunsafeæ‰€ç¤º\nä¸‹é¢æ˜¯ä¸€ä¸ªé”™è¯¯ä½¿ç”¨çš„èŒƒä¾‹(ä¸è¦é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„):\nfunc errorExample() {\n\t// å£°æ˜ä¸€ä¸ªå˜é‡xï¼Œç±»å‹ä¸ºint32ï¼Œé•¿åº¦ä¸º4byte\n\tx := int32(0)\n\t\n\t// å°†intç±»å‹çš„xè½¬æ¢ä¸ºunsafe.Pointer\n\tunsafePtr := unsafe.Pointer(&amp;x)\n\n\t// å°†unsafePtrå¼ºåˆ¶è½¬æ¢ä¸º*[]byteç±»å‹çš„æŒ‡é’ˆï¼Œå¹¶å°†æŒ‡é’ˆè§£å¼•ç”¨ï¼Œèµ‹å€¼ç»™bytesArr\n\tbytesArr := *(*[]byte)(unsafePtr)\n\n\t// æ‰“å°bytesArrçš„é•¿åº¦\n\tfmt.Printf(\"length of bytesArr: %v\\n\", len(bytesArr))\t\n}\n\nå½“æˆ‘ä»¬è¿è¡Œä¸Šé¢çš„ä»£ç çš„æ—¶å€™ï¼Œgoä¼šç»™æˆ‘ä»¬ä¸€ä¸ªæƒŠå–œï¼Œxçš„é•¿åº¦åº”è¯¥æ˜¯ï¼Œè€Œç»“æœå´æ˜¯å¦‚ä¸‹æ‰€ç¤º:\n=== RUN   errorExample\nlength of bytesArr: 1374389829464\n--- PASS: errorExample (0.00s)\nPASS\n\nå¦‚æœæ­¤æ—¶å¯¹bytesArrè¿›è¡Œæ“ä½œâ€¦\n\næ‰€ä»¥ï¼Œæˆ‘ä»¬å°†ç›´æ¥è·å–Keyçš„æ•°æ®ï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸º[]byteï¼Œç„¶åå†é€šè¿‡sdmbHash()å–å¾—Keyçš„hashå€¼ï¼š\n\nç‚¹å‡»å±•å¼€ä»¥æ˜¾ç¤ºä»£ç \nfunc hash[Key any](key Key) uint {\n\tgc := &amp;key\n\tstart := uintptr(unsafe.Pointer(gc))\n\toffset := unsafe.Sizeof(key)\n\tsizeOfByte := unsafe.Sizeof(byte(0))\n\n\thashSum := uint(0)\n\tfor ptr := start; ptr &lt; start+offset; ptr += sizeOfByte {\n\t\tb := *(*byte)(unsafe.Pointer(ptr))\n\t\thashSum += uint(b)\n\t\thashSum = uint(b) + (hashSum &lt;&lt; 6) + (hashSum &lt;&lt; 16) - hashSum\n\t}\n\treturn hashSum\n}\n\n\næ€»è¡¨å®ç°æˆ‘ä»¬å°†æ€»è¡¨å®šä¹‰å¦‚ä¸‹ï¼š\ntype RWMap[Key, Value any] struct {\n\ttables map[uint]*Table[Key, Value]\n\tlength uint\n}\n\ntablesæ˜¯åˆ†è¡¨çš„ç»“æ„ï¼Œlengthåˆ™ä¸ºåˆ†è¡¨çš„æ•°ç›®\næˆ‘ä»¬åªéœ€è¦å°†æ‰€æœ‰ä¼ å…¥è¯·æ±‚çš„Keyè¿›è¡Œhashï¼Œç„¶åå†å°†è¯·æ±‚è½¬åˆ°å¯¹åº”çš„åˆ†è¡¨è¿›è¡Œæ“ä½œï¼Œå¹¶è¿”å›åˆ†è¡¨æ“ä½œçš„ç»“æœå³å¯\n\nç‚¹å‡»å±•å¼€ä»¥æ˜¾ç¤ºä»£ç \ntype RWMap[Key, Value any] struct {\n\ttables map[uint]*Table[Key, Value]\n\tlength uint\n}\n\nfunc (R *RWMap[Key, Value]) Load(key Key) (value Value, ok bool) {\n\tindex := hash(key) % R.length\n\treturn R.tables[index].get(key)\n}\n\nfunc (R *RWMap[Key, Value]) Store(key Key, value Value) {\n\tindex := hash(key) % R.length\n\tR.tables[index].set(key, value)\n}\n\nfunc (R *RWMap[Key, Value]) Delete(key Key) {\n\tindex := hash(key) % R.length\n\tR.tables[index].del(key)\n}\n\nfunc (R *RWMap[Key, Value]) Range(f func(key Key, value Value) bool) {\n\tfor _, t := range R.tables {\n\t\tif !t.tRange(f) {\n\t\t\tbreak\n\t\t}\n\t}\n}\n\n\nåˆ†è¡¨å®ç°æˆ‘ä»¬å°†åˆ†è¡¨å®šä¹‰å¦‚ä¸‹ï¼š\ntype Table[Key, Value any] struct {\n\tmu    *sync.RWMutex\n\tlines map[any]Value\n}\n\nåˆ†è¡¨çš„å®ç°ä¸ä¸Šæ–‡çš„SimpleMapç±»ä¼¼ï¼ŒåŒæ ·é€šè¿‡RWMutexè¿›è¡Œå¹¶å‘æ§åˆ¶\n\nç‚¹å‡»å±•å¼€ä»¥æ˜¾ç¤ºä»£ç \ntype Table[Key, Value any] struct {\n\tmu    *sync.RWMutex\n\tlines map[any]Value\n}\n\nfunc (t *Table[Key, Value]) set(key Key, value Value) {\n\tt.mu.Lock()\n\tdefer t.mu.Unlock()\n\tt.lines[key] = value\n}\n\nfunc (t *Table[Key, Value]) get(key Key) (value Value, ok bool) {\n\tt.mu.RLock()\n\tdefer t.mu.RUnlock()\n\tgot, gotten := t.lines[key]\n\treturn got, gotten\n}\n\nfunc (t *Table[Key, Value]) del(key Key) {\n\tt.mu.Lock()\n\tdefer t.mu.Unlock()\n\tdelete(t.lines, key)\n}\n\nfunc (t *Table[Key, Value]) tRange(f func(Key, Value) bool) bool {\n\tfor k, v := range t.lines {\n\t\tif !f(k.(Key), v) {\n\t\t\treturn false\n\t\t}\n\t}\n\n\treturn true\n}\n\nfunc NewRWMap[Key, Value any](length uint) IMap[Key, Value] {\n\trwMap := RWMap[Key, Value]{\n\t\ttables: map[uint]*Table[Key, Value]{},\n\t\tlength: length,\n\t}\n\n\tfor i := uint(0); i &lt; length; i++ {\n\t\trwMap.tables[i] = &amp;Table[Key, Value]{\n\t\t\tmu:    &amp;sync.RWMutex{},\n\t\t\tlines: map[any]Value{},\n\t\t}\n\t}\n\n\treturn &amp;rwMap\n}\n\n\næµ‹è¯•ä¸Šæ–‡ä¸­ç®€å•æ”¹è¿›çš„å®ç°ç±»ä¸ºCommonMapï¼Œè¿›ä¸€æ­¥æ”¹è¿›çš„å®ç°ç±»å‹ä¸ºSimpleMapï¼Œæ›´è¿›ä¸€æ­¥æ”¹è¿›çš„å®ç°ç±»å‹ä¸ºRWMap\nå•å…ƒæµ‹è¯•å•å…ƒæµ‹è¯•å‡½æ•°type TestCase[Key, Value any] struct {\n\tIndexes        []int\n\tStoreKeys      map[int]Key\n\tStoreValues    map[int]Value\n\tLoadKeys       map[int]Key\n\tWantLoadValues map[int]Value\n\tWantLoaded     map[int]bool\n\tDeleteKeys     map[int]Key\n\tRangeFunc      func(Key, Value) bool\n\tEquals         func(v1, v2 Value) bool\n}\n\nfunc UnitTestFunc[Key, Value any](m IMap[Key, Value], testCase *TestCase[Key, Value], t *testing.T) {\n\tfor _, index := range testCase.Indexes {\n\t\tm.Store(testCase.StoreKeys[index], testCase.StoreValues[index])\n\t}\n\n\tfor _, index := range testCase.Indexes {\n\t\tm.Delete(testCase.DeleteKeys[index])\n\t}\n\n\tfor _, index := range testCase.Indexes {\n\t\tgot, gotten := m.Load(testCase.LoadKeys[index])\n\t\tif gotten != testCase.WantLoaded[index] {\n\t\t\tt.Errorf(\"key %v want loaded: %v, but load: %v\", testCase.LoadKeys[index], testCase.WantLoaded[index], gotten)\n\t\t}\n\t\tif !testCase.Equals(got, testCase.WantLoadValues[index]) {\n\t\t\tt.Errorf(\"key %v want got: %v, but got: %v\", testCase.LoadKeys[index], testCase.WantLoadValues[index], got)\n\t\t}\n\t}\n\n\tm.Range(testCase.RangeFunc)\n}\n\nå•å…ƒæµ‹è¯•å†…å®¹func TestCommonMap(t *testing.T) {\n\tt.Run(\"test-intIntCase\", func(t *testing.T) {\n\t\tm := NewCommonMap[int, int]()\n\t\tUnitTestFunc(m, &amp;intIntCase, t)\n\t})\n\tt.Run(\"test-stringStringCase\", func(t *testing.T) {\n\t\tm := NewCommonMap[string, string]()\n\t\tUnitTestFunc(m, &amp;stringStringCase, t)\n\t})\n\tt.Run(\"test-structStructCase\", func(t *testing.T) {\n\t\tm := NewCommonMap[testStruct, testStruct]()\n\t\tUnitTestFunc(m, &amp;structStructCase, t)\n\t})\n\tt.Run(\"test-intStructCase\", func(t *testing.T) {\n\t\tm := NewCommonMap[int, testStruct]()\n\t\tUnitTestFunc(m, &amp;intStructCase, t)\n\t})\n}\n\nfunc TestSimpleMap(t *testing.T) {\n\tt.Run(\"test-intIntCase\", func(t *testing.T) {\n\t\tm := NewSimpleMap[int, int]()\n\t\tUnitTestFunc(m, &amp;intIntCase, t)\n\t})\n\tt.Run(\"test-stringStringCase\", func(t *testing.T) {\n\t\tm := NewSimpleMap[string, string]()\n\t\tUnitTestFunc(m, &amp;stringStringCase, t)\n\t})\n\tt.Run(\"test-structStructCase\", func(t *testing.T) {\n\t\tm := NewSimpleMap[testStruct, testStruct]()\n\t\tUnitTestFunc(m, &amp;structStructCase, t)\n\t})\n\tt.Run(\"test-intStructCase\", func(t *testing.T) {\n\t\tm := NewSimpleMap[int, testStruct]()\n\t\tUnitTestFunc(m, &amp;intStructCase, t)\n\t})\n}\n\nfunc TestRWMap(t *testing.T) {\n\tt.Run(\"test-intIntCase\", func(t *testing.T) {\n\t\tm := NewRWMap[int, int](1)\n\t\tUnitTestFunc(m, &amp;intIntCase, t)\n\t})\n\tt.Run(\"test-stringStringCase\", func(t *testing.T) {\n\t\tm := NewRWMap[string, string](1)\n\t\tUnitTestFunc(m, &amp;stringStringCase, t)\n\t})\n\tt.Run(\"test-structStructCase\", func(t *testing.T) {\n\t\tm := NewRWMap[testStruct, testStruct](1)\n\t\tUnitTestFunc(m, &amp;structStructCase, t)\n\t})\n\tt.Run(\"test-intStructCase\", func(t *testing.T) {\n\t\tm := NewRWMap[int, testStruct](1)\n\t\tUnitTestFunc(m, &amp;intStructCase, t)\n\t})\n}\n\nå•å…ƒæµ‹è¯•ç”¨ä¾‹\nç‚¹å‡»å±•å¼€ä»¥æ˜¾ç¤ºä»£ç \nvar (\n\tintIntCase TestCase[int, int] = TestCase[int, int]{\n\t\tIndexes: []int{1, 2, 3},\n\t\tStoreKeys: map[int]int{\n\t\t\t1: 114514,\n\t\t\t2: 1919810,\n\t\t\t3: 2147,\n\t\t},\n\t\tStoreValues: map[int]int{\n\t\t\t1: 1919810,\n\t\t\t2: 114514,\n\t\t\t3: 65535,\n\t\t},\n\t\tDeleteKeys: map[int]int{\n\t\t\t1: 2147,\n\t\t\t2: 2147,\n\t\t\t3: 2147,\n\t\t},\n\t\tLoadKeys: map[int]int{\n\t\t\t1: 2147,\n\t\t\t2: 114514,\n\t\t\t3: 1919810,\n\t\t},\n\t\tWantLoaded: map[int]bool{\n\t\t\t1: false,\n\t\t\t2: true,\n\t\t\t3: true,\n\t\t},\n\t\tWantLoadValues: map[int]int{\n\t\t\t1: 0,\n\t\t\t2: 1919810,\n\t\t\t3: 114514,\n\t\t},\n\t\tRangeFunc: func(a, b int) bool {\n\t\t\tfmt.Printf(\"key: %d, value: %d\\n\", a, b)\n\t\t\treturn true\n\t\t},\n\t\tEquals: func(a, b int) bool {\n\t\t\treturn a == b\n\t\t},\n\t}\n\tstringStringCase TestCase[string, string] = TestCase[string, string]{\n\t\tIndexes: []int{1, 2, 3},\n\t\tStoreKeys: map[int]string{\n\t\t\t1: \"114514\",\n\t\t\t2: \"1919810\",\n\t\t\t3: \"2147\",\n\t\t},\n\t\tStoreValues: map[int]string{\n\t\t\t1: \"1919810\",\n\t\t\t2: \"114514\",\n\t\t\t3: \"65535\",\n\t\t},\n\t\tDeleteKeys: map[int]string{\n\t\t\t1: \"2147\",\n\t\t\t2: \"2147\",\n\t\t\t3: \"2147\",\n\t\t},\n\t\tLoadKeys: map[int]string{\n\t\t\t1: \"2147\",\n\t\t\t2: \"114514\",\n\t\t\t3: \"1919810\",\n\t\t},\n\t\tWantLoaded: map[int]bool{\n\t\t\t1: false,\n\t\t\t2: true,\n\t\t\t3: true,\n\t\t},\n\t\tWantLoadValues: map[int]string{\n\t\t\t1: \"\",\n\t\t\t2: \"1919810\",\n\t\t\t3: \"114514\",\n\t\t},\n\t\tRangeFunc: func(a, b string) bool {\n\t\t\tfmt.Printf(\"key: %v, value: %v\\n\", a, b)\n\t\t\treturn true\n\t\t},\n\t\tEquals: func(a, b string) bool {\n\t\t\treturn a == b\n\t\t},\n\t}\n\tintStructCase TestCase[int, testStruct] = TestCase[int, testStruct]{\n\t\tIndexes: []int{1, 2, 3},\n\t\tStoreKeys: map[int]int{\n\t\t\t1: 114514,\n\t\t\t2: 1919810,\n\t\t\t3: 2147,\n\t\t},\n\t\tStoreValues: map[int]testStruct{\n\t\t\t1: {val: 1919810},\n\t\t\t2: {val: 114514},\n\t\t\t3: {val: 65535},\n\t\t},\n\t\tDeleteKeys: map[int]int{\n\t\t\t1: 2147,\n\t\t\t2: 2147,\n\t\t\t3: 2147,\n\t\t},\n\t\tLoadKeys: map[int]int{\n\t\t\t1: 2147,\n\t\t\t2: 114514,\n\t\t\t3: 1919810,\n\t\t},\n\t\tWantLoaded: map[int]bool{\n\t\t\t1: false,\n\t\t\t2: true,\n\t\t\t3: true,\n\t\t},\n\t\tWantLoadValues: map[int]testStruct{\n\t\t\t1: {},\n\t\t\t2: {val: 1919810},\n\t\t\t3: {val: 114514},\n\t\t},\n\t\tRangeFunc: func(a int, b testStruct) bool {\n\t\t\tfmt.Printf(\"key: %d, value: %#v\\n\", a, b)\n\t\t\treturn true\n\t\t},\n\t\tEquals: func(a, b testStruct) bool {\n\t\t\treturn a.val == b.val\n\t\t},\n\t}\n\tstructStructCase TestCase[testStruct, testStruct] = TestCase[testStruct, testStruct]{\n\t\tIndexes: []int{1, 2, 3},\n\t\tStoreKeys: map[int]testStruct{\n\t\t\t1: {val: 114514},\n\t\t\t2: {val: 1919810},\n\t\t\t3: {val: 2147},\n\t\t},\n\t\tStoreValues: map[int]testStruct{\n\t\t\t1: {val: 1919810},\n\t\t\t2: {val: 114514},\n\t\t\t3: {val: 65535},\n\t\t},\n\t\tDeleteKeys: map[int]testStruct{\n\t\t\t1: {val: 2147},\n\t\t\t2: {val: 2147},\n\t\t\t3: {val: 2147},\n\t\t},\n\t\tLoadKeys: map[int]testStruct{\n\t\t\t1: {val: 2147},\n\t\t\t2: {val: 114514},\n\t\t\t3: {val: 1919810},\n\t\t},\n\t\tWantLoaded: map[int]bool{\n\t\t\t1: false,\n\t\t\t2: true,\n\t\t\t3: true,\n\t\t},\n\t\tWantLoadValues: map[int]testStruct{\n\t\t\t1: {},\n\t\t\t2: {val: 1919810},\n\t\t\t3: {val: 114514},\n\t\t},\n\t\tRangeFunc: func(a, b testStruct) bool {\n\t\t\tfmt.Printf(\"key: %#v, value: %#v\\n\", a, b)\n\t\t\treturn true\n\t\t},\n\t\tEquals: func(a, b testStruct) bool {\n\t\t\treturn a.val == b.val\n\t\t},\n\t}\n)\n\n\nå•å…ƒæµ‹è¯•ç»“æœ\nç‚¹å‡»å±•å¼€ä»¥æ˜¾ç¤ºç»“æœ\n=== RUN   TestCommonMap\n=== RUN   TestCommonMap/test-intIntCase\nkey: 1919810, value: 114514\nkey: 114514, value: 1919810\n=== RUN   TestCommonMap/test-stringStringCase\nkey: 114514, value: 1919810\nkey: 1919810, value: 114514\n=== RUN   TestCommonMap/test-structStructCase\nkey: toy_kv.testStruct{val:114514}, value: toy_kv.testStruct{val:1919810}\nkey: toy_kv.testStruct{val:1919810}, value: toy_kv.testStruct{val:114514}\n=== RUN   TestCommonMap/test-intStructCase\nkey: 114514, value: toy_kv.testStruct{val:1919810}\nkey: 1919810, value: toy_kv.testStruct{val:114514}\n--- PASS: TestCommonMap (0.00s)\n    --- PASS: TestCommonMap/test-intIntCase (0.00s)\n    --- PASS: TestCommonMap/test-stringStringCase (0.00s)\n    --- PASS: TestCommonMap/test-structStructCase (0.00s)\n    --- PASS: TestCommonMap/test-intStructCase (0.00s)\n=== RUN   TestSimpleMap\n=== RUN   TestSimpleMap/test-intIntCase\nkey: 1919810, value: 114514\nkey: 114514, value: 1919810\n=== RUN   TestSimpleMap/test-stringStringCase\nkey: 114514, value: 1919810\nkey: 1919810, value: 114514\n=== RUN   TestSimpleMap/test-structStructCase\nkey: toy_kv.testStruct{val:114514}, value: toy_kv.testStruct{val:1919810}\nkey: toy_kv.testStruct{val:1919810}, value: toy_kv.testStruct{val:114514}\n=== RUN   TestSimpleMap/test-intStructCase\nkey: 114514, value: toy_kv.testStruct{val:1919810}\nkey: 1919810, value: toy_kv.testStruct{val:114514}\n--- PASS: TestSimpleMap (0.00s)\n    --- PASS: TestSimpleMap/test-intIntCase (0.00s)\n    --- PASS: TestSimpleMap/test-stringStringCase (0.00s)\n    --- PASS: TestSimpleMap/test-structStructCase (0.00s)\n    --- PASS: TestSimpleMap/test-intStructCase (0.00s)\n=== RUN   TestRWMap\n=== RUN   TestRWMap/test-intIntCase\nkey: 1919810, value: 114514\nkey: 114514, value: 1919810\n=== RUN   TestRWMap/test-stringStringCase\nkey: 114514, value: 1919810\nkey: 1919810, value: 114514\n=== RUN   TestRWMap/test-structStructCase\nkey: toy_kv.testStruct{val:114514}, value: toy_kv.testStruct{val:1919810}\nkey: toy_kv.testStruct{val:1919810}, value: toy_kv.testStruct{val:114514}\n=== RUN   TestRWMap/test-intStructCase\nkey: 114514, value: toy_kv.testStruct{val:1919810}\nkey: 1919810, value: toy_kv.testStruct{val:114514}\n--- PASS: TestRWMap (0.00s)\n    --- PASS: TestRWMap/test-intIntCase (0.00s)\n    --- PASS: TestRWMap/test-stringStringCase (0.00s)\n    --- PASS: TestRWMap/test-structStructCase (0.00s)\n    --- PASS: TestRWMap/test-intStructCase (0.00s)\nPASS\n\n\nåŸºå‡†æµ‹è¯•åŸºå‡†æµ‹è¯•å‡½æ•°// MapBenchmarkTestFunc å„ç§IMapçš„åŸºå‡†æµ‹è¯•å‡½æ•°ä½“\nfunc MapBenchmarkTestFunc(m IMap[int, int], goroutines, operations int, b *testing.B) {\n\tfor i := 0; i &lt; b.N; i++ {\n\t\twg := &amp;sync.WaitGroup{}\n\t\twg.Add(goroutines * operations)\n\t\tfor j := 0; j &lt; goroutines; j++ {\n\t\t\tgo func(index int) {\n\t\t\t\tfor k := 0; k &lt; operations; k++ {\n\t\t\t\t\tm.Store(index*operations+k, k)\n\t\t\t\t\tm.Load(index*operations + k)\n\t\t\t\t\twg.Done()\n\t\t\t\t}\n\t\t\t}(j)\n\t\t}\n\t\twg.Wait()\n\t}\n}\n\nåŸºå‡†æµ‹è¯•å†…å®¹// BenchmarkCommonMapTest æµ‹è¯•CommonMapè¿›è¡Œ100ä¸‡æ¬¡è¯»å’Œå†™çš„åŸºå‡†æ€§èƒ½\nfunc BenchmarkCommonMapTest(b *testing.B) {\n\tm := NewCommonMap[int, int]()\n\tMapBenchmarkTestFunc(m, 100, 10000, b)\n}\n\n// BenchmarkSimpleMapTest æµ‹è¯•SimpleMapè¿›è¡Œ100ä¸‡æ¬¡è¯»å’Œå†™çš„åŸºå‡†æ€§èƒ½\nfunc BenchmarkSimpleMapTest(b *testing.B) {\n\tm := NewSimpleMap[int, int]()\n\tMapBenchmarkTestFunc(m, 100, 10000, b)\n}\n\n// BenchmarkRWMapTest æµ‹è¯•RWMapè¿›è¡Œ100ä¸‡æ¬¡è¯»å’Œå†™çš„åŸºå‡†æ€§èƒ½\nfunc BenchmarkRWMapTest(b *testing.B) {\n\tm := NewRWMap[int, int](10007)\n\tMapBenchmarkTestFunc(m, 100, 10000, b)\n}\n\nåŸºå‡†æµ‹è¯•ç»“æœ\n\n\n\n\n\n\n\n\nç”±äºæˆ‘ä»¬ä½¿ç”¨äº†ç»Ÿä¸€çš„æµ‹è¯•å‡½æ•°ï¼Œé€šè¿‡è¿™ä¸ªå‡½æ•°æ¥è¿›è¡Œè°ƒç”¨ï¼Œä¼šäº§ç”Ÿé¢å¤–çš„(å¸¸æ•°çº§)æ€§èƒ½å¼€é”€ï¼Œå®é™…ä½¿ç”¨æ—¶çš„æ€§èƒ½æ¯”æœ¬æµ‹è¯•ç»“æœé«˜\n\n\n\næµ‹è¯•æ¬¡æ•°\næµ‹è¯•åç§°\nåŸºå‡†æ€§èƒ½\nä¼°ç®—\næµ‹è¯•ç»“æœ\n\n\n\n1\nBenchmarkCommonMapTest\n493900208 ns/op\nç™¾ä¸‡çº§ååé‡\nPASS\n\n\n1\nBenchmarkSimpleMapTest\n317186708 ns/op\nç™¾ä¸‡çº§ååé‡\nPASS\n\n\n1\nBenchmarkRWMapTest\n87778174 ns/op\nåƒä¸‡çº§ååé‡\nPASS\n\n\n2\nBenchmarkCommonMapTest\n520827944 ns/op\nç™¾ä¸‡çº§ååé‡\nPASS\n\n\n2\nBenchmarkSimpleMapTest\n302985188 ns/op\nç™¾ä¸‡çº§ååé‡\nPASS\n\n\n2\nBenchmarkRWMapTest\n81960308 ns/op\nåƒä¸‡çº§ååé‡\nPASS\n\n\n3\nBenchmarkCommonMapTest\n575636938 ns/op\nç™¾ä¸‡çº§ååé‡\nPASS\n\n\n3\nBenchmarkSimpleMapTest\n301984916 ns/op\nç™¾ä¸‡çº§ååé‡\nPASS\n\n\n3\nBenchmarkRWMapTest\n82087205 ns/op\nåƒä¸‡çº§ååé‡\nPASS\n\n\nè§†é¢‘æ•™ç¨‹\n.bili-div {\n    position: relative;\n    overflow: hidden;\n    padding-top: 56.25%;\n}\n\n.bili-player {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    border: 0;\n}\n\n\nIntroductionè§†é¢‘åœ°å€: [Go] ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ªæ¯ç§’åƒä¸‡çº§æ“ä½œçš„Key-Valueå­˜å‚¨ - Introduction\n\n     \n\n\nCommonMapè§†é¢‘åœ°å€: [Go] ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ªæ¯ç§’åƒä¸‡çº§æ“ä½œçš„Key-Valueå­˜å‚¨ - CommonMap\n\n     \n\n\nSimpleMapè§†é¢‘åœ°å€: [Go] ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ªæ¯ç§’åƒä¸‡çº§æ“ä½œçš„Key-Valueå­˜å‚¨ - SimpleMap\n\n     \n\n\nRWMapè§†é¢‘åœ°å€: [Go] ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ªæ¯ç§’åƒä¸‡çº§æ“ä½œçš„Key-Valueå­˜å‚¨ - RWMap\n\n     \n\n\nå‚è€ƒèµ„æ–™\nHash Functions in Go - James Smith\n\n","slug":"KeyValueStore-GolangImplement-3","date":"2022-08-15T01:53:46.000Z","categories_index":"blog","tags_index":"Golang,Redis,KeyValue","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"47859f6ed3b9b77bc9f9046f0cd4ce8c","title":"(ç¬¬äºŒå¼¹)ä½¿ç”¨Golangå®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„Map","content":"\n\n\n\n\n\n\n\n\nä¸Šå›è¯´åˆ°ï¼Œç”¨Golangå®ç°äº†ä¸€ä¸ªé«˜æ€§èƒ½çš„kvï¼Œä½†æ˜¯ç”±äºé”çš„å…³ç³»ï¼Œå³ä½¿æœ‰å¤šä¸ªgoç¨‹å¹¶å‘å¯¹kvè¿›è¡Œæ“ä½œï¼Œä½†è¿˜æ˜¯ä¼šå› ä¸ºå…¨å±€çš„é”å¯¼è‡´ä¸€goå¹²æ´»ï¼Œå¤šgoçœ‹æˆçš„åœºé¢ï¼Œä»Šå¤©å°±æ¥ä¼˜åŒ–ä¸€ä¸‹è¿™ä¸ªkvï¼Œè®©å®ƒå®ç°çœŸæ­£çš„å¹¶å‘å¹²æ´»\næ€è·¯æ€»ä½“è®¾è®¡æ€è·¯è¿˜æ˜¯æ²¡æœ‰å˜æ»´ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦ç”¨ä¸Šæ¬¡é‚£ä¸ªæ¨¡å‹è¿›è¡Œæ€»ä½“è®¾è®¡ï¼Œä½†æ˜¯æˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æœºåˆ¶ï¼šå°†dirtyæ•°æ®åˆ†æ•£å­˜å‚¨åˆ°è‹¥å¹²ä¸ªmapé‡Œï¼Œè¿™æ ·é”å°±åªä¼šé”ä½å•ä¸ªmapï¼Œå…¶ä½™çš„mapè¿˜æ˜¯å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œçš„ï¼Œé€šè¿‡è¿™æ ·æ¥è®©å¤šgoç¨‹çœŸæ­£åœ°å¹¶å‘å·¥ä½œ\næ€»ä½“ç»“æ„å›¾ï¼š\n\nè¯»å†™æµç¨‹å›¾ï¼š\n\n\n\n\n\n\n\n\n\n\nå…ˆæ‹¿ä¸Šæ¬¡çš„å›¾é¡¶ä¸ªæ•°ï¼Œä¸‹æ¬¡æ›´æ–°å†æŠŠå›¾æ”¾ä¸Šæ¥ï¼Œæ€»ä½“ä¹Ÿå·®ä¸å¤š\nå®ç°ç›¸å¯¹äºä¸Šæ¬¡çš„å®ç°ï¼Œæˆ‘ä»¬å¼•å…¥äº†æ›´å¤šçš„æ–‡ä»¶ï¼š\n.\n|-- buff.go         // ç¼“å†²channelç›¸å…³å®ç°\n|-- db.go           // kvä¸»ä½“å®ç°\n|-- db_test.go      // æµ‹è¯•æ–‡ä»¶\n|-- dirty.go        // dirtyMapä¸å®é™…å­˜å‚¨çš„entityçš„å®ç°\n|-- error.go        // è‡ªå®šä¹‰é”™è¯¯\n`-- operator.go     // å…·ä½“æ“ä½œkvçš„å®ç°\n\nbuff.gopackage kv\n\ntype typeRequest int\n\nconst (\n\tgetValue typeRequest = iota\n\tsetValue\n\tdeleteKey\n\trangeDB\n)\n\ntype typeResponse int\n\nconst (\n\twithError typeResponse = iota\n\twithValue\n)\n\ntype requestFields int\n\nconst (\n\trequestKey requestFields = iota\n\trequestValue\n\trequestTimeout\n\trequestFunc\n)\n\ntype responseFields int\n\nconst (\n\tresponseKey responseFields = iota\n\tresponseValue\n\tresponseTimeout\n\tresponseError\n)\n\ntype dbRequest struct &#123;\n\trequestType typeRequest\n\targs        map[requestFields]interface&#123;&#125;\n\tcallback    chan dbResponse\n&#125;\n\ntype dbResponse struct &#123;\n\tresponseType typeResponse\n\treturns      map[responseFields]interface&#123;&#125;\n&#125;\n\nfunc newDbRequest(rType typeRequest) *dbRequest &#123;\n\treturn &amp;dbRequest&#123;\n\t\trequestType: rType,\n\t\targs:        make(map[requestFields]interface&#123;&#125;),\n\t\tcallback:    make(chan dbResponse, 1),\n\t&#125;\n&#125;\n\ndb.gopackage kv\n\nimport (\n\t\"sync\"\n\t\"time\"\n)\n\ntype IDatabase interface &#123;\n\tGet(key interface&#123;&#125;) (value interface&#123;&#125;, timeout time.Duration, err error)\n\tSet(key interface&#123;&#125;, value interface&#123;&#125;, timeout time.Duration) (v interface&#123;&#125;, t time.Duration, e error)\n\tDelete(key interface&#123;&#125;) (ok bool, err error)\n\tRange(f func(key, value interface&#123;&#125;))\n\tClose()\n&#125;\n\nfunc NewDatabase(workers, buffSize, dirtyCount uint, hash func(key interface&#123;&#125;) uint) IDatabase &#123;\n\t// init kv-database\n\tdb := &amp;database&#123;\n\t\tbuff:    make(chan *dbRequest, buffSize),\n\t\texit:    make(chan struct&#123;&#125;, 1),\n\t\tdata:    make(map[uint]*dirtyMap, dirtyCount),\n\t\tsize:    dirtyCount,\n\t\tworkers: workers,\n\t\thash:    hash,\n\t&#125;\n\n\t// init dirty-map\n\tfor i := uint(0); i &lt; dirtyCount; i++ &#123;\n\t\tdb.data[i] = &amp;dirtyMap&#123;\n\t\t\tlock:  sync.RWMutex&#123;&#125;,\n\t\t\tdirty: make(map[interface&#123;&#125;]*entity),\n\t\t&#125;\n\t&#125;\n\n\t// start up operators\n\tdb.operator()\n\treturn db\n&#125;\n\ntype database struct &#123;\n\tsize    uint\n\tworkers uint\n\tbuff    chan *dbRequest\n\texit    chan struct&#123;&#125;\n\tdata    map[uint]*dirtyMap\n\thash    func(interface&#123;&#125;) uint\n&#125;\n\nfunc (d *database) Get(key interface&#123;&#125;) (value interface&#123;&#125;, timeout time.Duration, err error) &#123;\n\treq := newDbRequest(getValue)\n\tdefer close(req.callback)\n\treq.args = map[requestFields]interface&#123;&#125;&#123;\n\t\trequestKey: key,\n\t&#125;\n\td.buff &lt;- req\n\n\tresp := &lt;-req.callback\n\tswitch resp.responseType &#123;\n\tcase withError:\n\t\terr := resp.returns[responseError].(error)\n\t\treturn nil, time.Duration(0), err\n\tdefault:\n\t\treturn resp.returns[responseValue], resp.returns[responseTimeout].(time.Duration), nil\n\t&#125;\n&#125;\n\nfunc (d *database) Set(key interface&#123;&#125;, value interface&#123;&#125;, timeout time.Duration) (v interface&#123;&#125;, t time.Duration, e error) &#123;\n\treq := newDbRequest(setValue)\n\tdefer close(req.callback)\n\treq.args = map[requestFields]interface&#123;&#125;&#123;\n\t\trequestKey:     key,\n\t\trequestValue:   value,\n\t\trequestTimeout: timeout,\n\t&#125;\n\td.buff &lt;- req\n\n\tresp := &lt;-req.callback\n\tswitch resp.responseType &#123;\n\tcase withError:\n\t\terr := resp.returns[responseError].(error)\n\t\treturn nil, time.Duration(0), err\n\tdefault:\n\t\treturn resp.returns[responseValue], resp.returns[responseTimeout].(time.Duration), nil\n\t&#125;\n&#125;\n\nfunc (d *database) Delete(key interface&#123;&#125;) (ok bool, err error) &#123;\n\treq := newDbRequest(deleteKey)\n\tdefer close(req.callback)\n\treq.args = map[requestFields]interface&#123;&#125;&#123;\n\t\trequestKey: key,\n\t&#125;\n\td.buff &lt;- req\n\n\tresp := &lt;-req.callback\n\tswitch resp.responseType &#123;\n\tcase withError:\n\t\terr := resp.returns[responseError].(error)\n\t\treturn false, err\n\tdefault:\n\t\treturn true, nil\n\t&#125;\n&#125;\n\nfunc (d *database) Range(f func(key interface&#123;&#125;, value interface&#123;&#125;)) &#123;\n\treq := newDbRequest(rangeDB)\n\tdefer close(req.callback)\n\treq.args = map[requestFields]interface&#123;&#125;&#123;\n\t\trequestFunc: f,\n\t&#125;\n\td.buff &lt;- req\n\n\t&lt;-req.callback\n\treturn\n&#125;\n\nfunc (d *database) Close() &#123;\n\td.exit &lt;- struct&#123;&#125;&#123;&#125;\n&#125;\n\ndirty.gopackage kv\n\nimport (\n\t\"sync\"\n\t\"time\"\n)\n\ntype entity struct &#123;\n\ttimeout time.Time\n\tdata    interface&#123;&#125;\n&#125;\n\ntype dirtyMap struct &#123;\n\tlock  sync.RWMutex\n\tdirty map[interface&#123;&#125;]*entity\n&#125;\n\nerror.gopackage kv\n\nimport \"fmt\"\n\ntype outOfRangeError struct &#123;\n\tupperIndex int\n\tlowerIndex int\n&#125;\n\nfunc (o outOfRangeError) Error() string &#123;\n\treturn fmt.Sprintf(\"kv-db out of range with [%v:%v]\", o.lowerIndex, o.upperIndex)\n&#125;\n\ntype notFoundError struct &#123;\n\tkey interface&#123;&#125;\n&#125;\n\nfunc (n notFoundError) Error() string &#123;\n\treturn fmt.Sprintf(\"kv-db cannot find key: %#v\", n.key)\n&#125;\n\noperator.gopackage kv\n\nimport (\n\t\"time\"\n)\n\nfunc (d *database) operator() &#123;\n\t// start up exit listener\n\texitChan := make(chan struct&#123;&#125;, d.workers)\n\tgo listenExitChan(d.exit, exitChan, d.workers)\n\n\t// start up operators\n\tfor i := uint(0); i &lt; d.workers; i++ &#123;\n\t\tgo startupOperator(d, exitChan)\n\t&#125;\n&#125;\n\nfunc listenExitChan(from, to chan struct&#123;&#125;, workers uint) &#123;\n\tselect &#123;\n\tcase &lt;-from:\n\t\tfor i := uint(0); i &lt; workers; i++ &#123;\n\t\t\tto &lt;- struct&#123;&#125;&#123;&#125;\n\t\t&#125;\n\t&#125;\n&#125;\n\nfunc startupOperator(d *database, e chan struct&#123;&#125;) &#123;\n\tfor &#123;\n\t\tselect &#123;\n\t\tcase request := &lt;-d.buff:\n\t\t\tswitch request.requestType &#123;\n\t\t\tcase getValue:\n\t\t\t\trequest.callback &lt;- getValueOperate(d, request.args[requestKey])\n\t\t\tcase setValue:\n\t\t\t\trequest.callback &lt;- setValueOperate(d, request.args[requestKey], request.args[requestValue], request.args[requestTimeout].(time.Duration))\n\t\t\tcase deleteKey:\n\t\t\t\trequest.callback &lt;- deleteKeyOperate(d, request.args[requestKey])\n\t\t\tcase rangeDB:\n\t\t\t\trequest.callback &lt;- rangeDbOperate(d, request.args[requestFunc].(func(interface&#123;&#125;, interface&#123;&#125;)))\n\t\t\t&#125;\n\t\tcase &lt;-e:\n\t\t\treturn\n\t\t&#125;\n\t&#125;\n&#125;\n\nfunc getValueOperate(d *database, key interface&#123;&#125;) (resp dbResponse) &#123;\n\t// get dirty-map index and set read-lock\n\tindex := d.hash(key) % d.size\n\t_map := d.data[index]\n\t_map.lock.RLock()\n\tdefer _map.lock.RUnlock()\n\n\tif v, ok := _map.dirty[key]; !ok &#123;\n\t\t// condition: cannot find key in dirty-map\n\t\t// return error\n\t\tresp = dbResponse&#123;\n\t\t\tresponseType: withError,\n\t\t\treturns: map[responseFields]interface&#123;&#125;&#123;\n\t\t\t\tresponseError: notFoundError&#123;key: key&#125;,\n\t\t\t&#125;,\n\t\t&#125;\n\t&#125; else &#123;\n\t\t// condition: get entity succeed in dirty-map\n\t\tif v.timeout.Before(time.Now()) &#123;\n\t\t\t// condition: key-value pair timeout\n\t\t\t// delete key-value pair\n\t\t\t_map.lock.Lock()\n\t\t\tdefer _map.lock.Unlock()\n\t\t\tdelete(_map.dirty, key)\n\n\t\t\t// return error\n\t\t\tresp = dbResponse&#123;\n\t\t\t\tresponseType: withError,\n\t\t\t\treturns: map[responseFields]interface&#123;&#125;&#123;\n\t\t\t\t\tresponseError: notFoundError&#123;key: key&#125;,\n\t\t\t\t&#125;,\n\t\t\t&#125;\n\t\t&#125; else &#123;\n\t\t\t// condition: key-value pair not timeout\n\t\t\t// return value\n\t\t\tresp = dbResponse&#123;\n\t\t\t\tresponseType: withValue,\n\t\t\t\treturns: map[responseFields]interface&#123;&#125;&#123;\n\t\t\t\t\tresponseValue:   v.data,\n\t\t\t\t\tresponseTimeout: v.timeout.Sub(time.Now()),\n\t\t\t\t&#125;,\n\t\t\t&#125;\n\t\t&#125;\n\t&#125;\n\n\treturn resp\n&#125;\n\nfunc setValueOperate(d *database, key, value interface&#123;&#125;, timeout time.Duration) (resp dbResponse) &#123;\n\t// get dirty-map index and set write-lock\n\tindex := d.hash(key) % d.size\n\t_map := d.data[index]\n\t_map.lock.Lock()\n\tdefer _map.lock.Unlock()\n\n\t// update dirty-map\n\tv := &amp;entity&#123;\n\t\ttimeout: time.Now().Add(timeout),\n\t\tdata:    value,\n\t&#125;\n\t_map.dirty[key] = v\n\n\t// return value\n\tresp = dbResponse&#123;\n\t\tresponseType: withValue,\n\t\treturns: map[responseFields]interface&#123;&#125;&#123;\n\t\t\tresponseValue:   v.data,\n\t\t\tresponseTimeout: v.timeout.Sub(time.Now()),\n\t\t&#125;,\n\t&#125;\n\n\treturn resp\n&#125;\n\nfunc deleteKeyOperate(d *database, key interface&#123;&#125;) (resp dbResponse) &#123;\n\t// get dirty-map index and set read-lock\n\tindex := d.hash(key) % d.size\n\t_map := d.data[index]\n\t_map.lock.RLock()\n\tdefer _map.lock.RUnlock()\n\n\tif _, ok := _map.dirty[key]; !ok &#123;\n\t\t// condition: cannot find key in dirty-map\n\t\t// return value\n\t\tresp = dbResponse&#123;\n\t\t\tresponseType: withValue,\n\t\t\treturns:      nil,\n\t\t&#125;\n\t&#125; else &#123;\n\t\t// delete key-value pair\n\t\t_map.lock.Lock()\n\t\tdefer _map.lock.Unlock()\n\t\tdelete(_map.dirty, key)\n\n\t\t// return value\n\t\tresp = dbResponse&#123;\n\t\t\tresponseType: withValue,\n\t\t\treturns:      nil,\n\t\t&#125;\n\t&#125;\n\n\treturn resp\n&#125;\n\nfunc rangeDbOperate(d *database, f func(key, value interface&#123;&#125;)) (resp dbResponse) &#123;\n\tfor i := uint(0); i &lt; d.size; i++ &#123;\n\t\t// set write-lock\n\t\tcurrent := d.data[i]\n\t\tcurrent.lock.Lock()\n\n\t\t// execute function\n\t\tfor k, v := range current.dirty &#123;\n\t\t\tf(k, v.data)\n\t\t&#125;\n\t\tcurrent.lock.Unlock()\n\t&#125;\n\n\t// return value\n\tresp = dbResponse&#123;\n\t\tresponseType: withValue,\n\t\treturns:      nil,\n\t&#125;\n\n\treturn resp\n&#125;\n\næµ‹è¯•ç»æµ‹è¯•ï¼Œå¤šgoç¨‹çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œä¸€åƒä¸‡æ¬¡è¯»å†™æ‰€ç”¨çš„æ€»æ—¶é—´ä¸º8.6sï¼Œæ¯”ä¸Šæ¬¡è¿›è¡Œçš„å•goç¨‹æ€§èƒ½æ›´ä¼˜\n","slug":"KeyValueStore-GolangImplement-2","date":"2022-07-21T07:39:53.000Z","categories_index":"blog","tags_index":"Golang,Redis,KeyValue","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"9d5491a5ddb5a138c7973036a7b8ad61","title":"ä½¿ç”¨Golangå®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„Map","content":"\n\n\n\n\n\n\n\n\nè¿™ç¯‡åšæ–‡æ˜¯CeobeBotçš„æ¡†æ¶CeobeBotFrameworkçš„kvéƒ¨åˆ†çš„æ€»ç»“\næ€»è¯´rediså•çº¿ç¨‹æ€§èƒ½é«˜ï¼Œæœ€è¿‘æ­£å¥½åœ¨å®ç°è‡ªæ‹Ÿçš„æ¡†æ¶ï¼Œäºæ˜¯äº§ç”Ÿäº†ä¸€ä¸ªç”¨golangå®ç°ä¸€ä¸ªé«˜æ€§èƒ½kvçš„æƒ³æ³•ï¼Œè¿›è¡Œäº†ä¸€å¤©çš„codingã€å•å…ƒæµ‹è¯•å’ŒåŸºå‡†æµ‹è¯•ä»¥åï¼Œå¾—å‡ºçš„ç»“è®ºæ˜¯ï¼š\n\næœ‰é”çš„å¹¶å‘kvæ€§èƒ½ä½äºæ— é”çš„kv\n\næ€è·¯å…ˆè´´ä¸€ä¸‹å®šä¹‰ç»“æ„çš„ä»£ç ï¼š\ntype IDatabase interface &#123;\n\tGet(key interface&#123;&#125;) (value interface&#123;&#125;, timeout time.Duration, err error)\n\tSet(key interface&#123;&#125;, value interface&#123;&#125;, timeout time.Duration) (v interface&#123;&#125;, t time.Duration, e error)\n\tDelete(key interface&#123;&#125;) (ok bool, err error)\n\tRange(f func(key, value interface&#123;&#125;))\n\tClose()\n&#125;\n\ntype database struct &#123;\n\tmu    sync.RWMutex\n\tbuff  chan *dbRequest\n\texit  chan struct&#123;&#125;\n\tdirty map[interface&#123;&#125;]*entity\n&#125;\n\nç›¸ä¿¡å¤§å®¶çœ‹åˆ°è¿™é‡Œéƒ½å·²ç»çŸ¥é“äº†æˆ‘çš„æ€è·¯ï¼šå°±æ˜¯ç”¨ä¸€ä¸ªchanelä½œä¸ºkvçš„å‘½ä»¤ç¼“å†²åŒºï¼Œä¿è¯kvçš„å¹¶å‘å®‰å…¨æ€§ï¼Œç„¶åä½¿ç”¨go routineä½œä¸ºconsumeræ¶ˆè´¹è¿™ä¸ªchanelé‡Œçš„æŒ‡ä»¤ï¼Œè‡³äºé‚£ä¸ªé”mu sync.RWMutexå‘¢ï¼Œåˆ™æ˜¯ä¸ºè¿›è¡Œå¹¶å‘è¯»å†™çš„å®ç°æ–¹å¼å‡†å¤‡çš„\næ•´ä¸ªç»“æ„å›¾å¦‚ä¸‹ï¼š\n\nè¯»å†™è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š\n\nå®ç°é¦–å…ˆè¦è¯´æ˜çš„æ˜¯é¡¹ç›®çš„ç»“æ„ï¼š\n.\n|-- buff.go         // ç¼“å†²chanelç›¸å…³çš„ç»“æ„ä½“\n|-- db.go           // kvä¸»ä½“å®ç°\n|-- db_test.go      // æµ‹è¯•æ–‡ä»¶\n|-- entity.go       // kvå®é™…å­˜å‚¨å†…å®¹\n`-- error.go        // è‡ªå®šä¹‰é”™è¯¯\n\ndb.gopackage kv\n\nimport (\n\t\"sync\"\n\t\"time\"\n)\n\ntype IDatabase interface &#123;\n\tGet(key interface&#123;&#125;) (value interface&#123;&#125;, timeout time.Duration, err error)\n\tSet(key interface&#123;&#125;, value interface&#123;&#125;, timeout time.Duration) (v interface&#123;&#125;, t time.Duration, e error)\n\tDelete(key interface&#123;&#125;) (ok bool, err error)\n\tRange(f func(key, value interface&#123;&#125;))\n\tClose()\n&#125;\n\nfunc NewDatabase(workers, buffSize int) IDatabase &#123;\n\tdb := &amp;database&#123;\n\t\tbuff:  make(chan *dbRequest, buffSize),\n\t\texit:  make(chan struct&#123;&#125;, 1),\n\t\tdirty: make(map[interface&#123;&#125;]*entity),\n\t\tmu:    sync.RWMutex&#123;&#125;,\n\t&#125;\n\tdb.operator(workers)\n\treturn db\n&#125;\n\ntype database struct &#123;\n\tmu    sync.RWMutex\n\tbuff  chan *dbRequest\n\texit  chan struct&#123;&#125;\n\tdirty map[interface&#123;&#125;]*entity\n&#125;\n\nfunc (d database) Get(key interface&#123;&#125;) (value interface&#123;&#125;, timeout time.Duration, err error) &#123;\n\treq := newDbRequest(getValue)\n\tdefer close(req.callback)\n\treq.args = map[requestFields]interface&#123;&#125;&#123;\n\t\trequestKey: key,\n\t&#125;\n\td.buff &lt;- req\n\n\tresp := &lt;-req.callback\n\tswitch resp.responseType &#123;\n\tcase withError:\n\t\terr := resp.returns[responseError].(error)\n\t\treturn nil, time.Duration(0), err\n\tdefault:\n\t\tvalue := resp.returns[responseValue]\n\t\ttimeout := resp.returns[responseTimeout].(time.Time)\n\t\tout := timeout.Sub(time.Now())\n\t\treturn value, out, nil\n\t&#125;\n&#125;\n\nfunc (d database) Set(key interface&#123;&#125;, value interface&#123;&#125;, timeout time.Duration) (v interface&#123;&#125;, t time.Duration, e error) &#123;\n\treq := newDbRequest(setValue)\n\tdefer close(req.callback)\n\treq.args = map[requestFields]interface&#123;&#125;&#123;\n\t\trequestKey:     key,\n\t\trequestValue:   value,\n\t\trequestTimeout: time.Now().Add(timeout),\n\t&#125;\n\td.buff &lt;- req\n\n\tresp := &lt;-req.callback\n\tswitch resp.responseType &#123;\n\tcase withError:\n\t\terr := resp.returns[responseError].(error)\n\t\treturn nil, time.Duration(0), err\n\tdefault:\n\t\tvalue := resp.returns[responseValue]\n\t\ttimeout := resp.returns[responseTimeout].(time.Time)\n\t\tout := timeout.Sub(time.Now())\n\t\treturn value, out, nil\n\t&#125;\n&#125;\n\nfunc (d database) Delete(key interface&#123;&#125;) (ok bool, err error) &#123;\n\treq := newDbRequest(deleteKey)\n\tdefer close(req.callback)\n\treq.args = map[requestFields]interface&#123;&#125;&#123;\n\t\trequestKey: key,\n\t&#125;\n\td.buff &lt;- req\n\n\tresp := &lt;-req.callback\n\tswitch resp.responseType &#123;\n\tcase withError:\n\t\terr := resp.returns[responseError].(error)\n\t\treturn false, err\n\tdefault:\n\t\treturn true, nil\n\t&#125;\n&#125;\n\nfunc (d database) Range(f func(key interface&#123;&#125;, value interface&#123;&#125;)) &#123;\n\treq := newDbRequest(rangeDB)\n\tdefer close(req.callback)\n\treq.args = map[requestFields]interface&#123;&#125;&#123;\n\t\trequestFunc: f,\n\t&#125;\n\td.buff &lt;- req\n\n\t&lt;-req.callback\n\treturn\n&#125;\n\nfunc (d *database) operator(workers int) &#123;\n\tif workers == 1 &#123;\n\t\tgo func(d *database) &#123;\n\t\t\tfor &#123;\n\t\t\t\tselect &#123;\n\t\t\t\tcase request := &lt;-d.buff:\n\t\t\t\t\tswitch request.requestType &#123;\n\t\t\t\t\tcase getValue:\n\t\t\t\t\t\tkey := request.args[requestKey]\n\t\t\t\t\t\tif entity, ok := d.dirty[key]; !ok &#123;\n\t\t\t\t\t\t\tcallback := dbResponse&#123;\n\t\t\t\t\t\t\t\tresponseType: withError,\n\t\t\t\t\t\t\t\treturns: map[responseFields]interface&#123;&#125;&#123;\n\t\t\t\t\t\t\t\t\tresponseError: notFoundError&#123;key: key&#125;,\n\t\t\t\t\t\t\t\t&#125;,\n\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\trequest.callback &lt;- callback\n\t\t\t\t\t\t&#125; else &#123;\n\t\t\t\t\t\t\tif entity.timeout.Before(time.Now()) &#123;\n\t\t\t\t\t\t\t\tdelete(d.dirty, key)\n\t\t\t\t\t\t\t\tcallback := dbResponse&#123;\n\t\t\t\t\t\t\t\t\tresponseType: withError,\n\t\t\t\t\t\t\t\t\treturns: map[responseFields]interface&#123;&#125;&#123;\n\t\t\t\t\t\t\t\t\t\tresponseError: notFoundError&#123;key: key&#125;,\n\t\t\t\t\t\t\t\t\t&#125;,\n\t\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\t\trequest.callback &lt;- callback\n\t\t\t\t\t\t\t&#125; else &#123;\n\t\t\t\t\t\t\t\tcallback := dbResponse&#123;\n\t\t\t\t\t\t\t\t\tresponseType: withValue,\n\t\t\t\t\t\t\t\t\treturns: map[responseFields]interface&#123;&#125;&#123;\n\t\t\t\t\t\t\t\t\t\tresponseValue:   entity.data,\n\t\t\t\t\t\t\t\t\t\tresponseTimeout: entity.timeout,\n\t\t\t\t\t\t\t\t\t&#125;,\n\t\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\t\trequest.callback &lt;- callback\n\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t&#125;\n\t\t\t\t\tcase setValue:\n\t\t\t\t\t\tkey := request.args[requestKey]\n\t\t\t\t\t\tvalue := request.args[requestValue]\n\t\t\t\t\t\ttimeout := request.args[requestTimeout].(time.Time)\n\t\t\t\t\t\tentity := &amp;entity&#123;\n\t\t\t\t\t\t\ttimeout: timeout,\n\t\t\t\t\t\t\tdata:    value,\n\t\t\t\t\t\t\tmu:      sync.RWMutex&#123;&#125;,\n\t\t\t\t\t\t&#125;\n\t\t\t\t\t\td.dirty[key] = entity\n\n\t\t\t\t\t\tcallback := dbResponse&#123;\n\t\t\t\t\t\t\tresponseType: withValue,\n\t\t\t\t\t\t\treturns: map[responseFields]interface&#123;&#125;&#123;\n\t\t\t\t\t\t\t\tresponseValue:   entity.data,\n\t\t\t\t\t\t\t\tresponseTimeout: entity.timeout,\n\t\t\t\t\t\t\t&#125;,\n\t\t\t\t\t\t&#125;\n\t\t\t\t\t\trequest.callback &lt;- callback\n\t\t\t\t\tcase deleteKey:\n\t\t\t\t\t\tkey := request.args[requestKey]\n\t\t\t\t\t\tif _, ok := d.dirty[key]; ok &#123;\n\t\t\t\t\t\t\tdelete(d.dirty, key)\n\t\t\t\t\t\t\tcallback := dbResponse&#123;\n\t\t\t\t\t\t\t\tresponseType: withValue,\n\t\t\t\t\t\t\t\treturns:      nil,\n\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\trequest.callback &lt;- callback\n\t\t\t\t\t\t&#125; else &#123;\n\t\t\t\t\t\t\tcallback := dbResponse&#123;\n\t\t\t\t\t\t\t\tresponseType: withValue,\n\t\t\t\t\t\t\t\treturns:      nil,\n\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\trequest.callback &lt;- callback\n\t\t\t\t\t\t&#125;\n\t\t\t\t\tcase rangeDB:\n\t\t\t\t\t\tfunction := request.args[requestFunc].(func(key, value interface&#123;&#125;))\n\t\t\t\t\t\tfor i, e := range d.dirty &#123;\n\t\t\t\t\t\t\tfunction(i, e.data)\n\t\t\t\t\t\t&#125;\n\t\t\t\t\t\tcallback := dbResponse&#123;\n\t\t\t\t\t\t\tresponseType: withValue,\n\t\t\t\t\t\t\treturns:      nil,\n\t\t\t\t\t\t&#125;\n\t\t\t\t\t\trequest.callback &lt;- callback\n\t\t\t\t\t&#125;\n\t\t\t\tcase &lt;-d.exit:\n\t\t\t\t\treturn\n\t\t\t\t&#125;\n\t\t\t&#125;\n\t\t&#125;(d)\n\t&#125; else &#123;\n\t\texitChan := make(chan struct&#123;&#125;, workers)\n\t\tfor i := 0; i &lt; workers; i++ &#123;\n\t\t\tgo func(e chan struct&#123;&#125;, d *database) &#123;\n\t\t\t\tfor &#123;\n\t\t\t\t\tselect &#123;\n\t\t\t\t\tcase request := &lt;-d.buff:\n\t\t\t\t\t\tswitch request.requestType &#123;\n\t\t\t\t\t\tcase getValue:\n\t\t\t\t\t\t\td.mu.RLock()\n\t\t\t\t\t\t\tkey := request.args[requestKey]\n\t\t\t\t\t\t\tif entity, ok := d.dirty[key]; !ok &#123;\n\t\t\t\t\t\t\t\tcallback := dbResponse&#123;\n\t\t\t\t\t\t\t\t\tresponseType: withError,\n\t\t\t\t\t\t\t\t\treturns: map[responseFields]interface&#123;&#125;&#123;\n\t\t\t\t\t\t\t\t\t\tresponseError: notFoundError&#123;key: key&#125;,\n\t\t\t\t\t\t\t\t\t&#125;,\n\t\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\t\trequest.callback &lt;- callback\n\t\t\t\t\t\t\t&#125; else &#123;\n\t\t\t\t\t\t\t\tentity.read()\n\t\t\t\t\t\t\t\tif entity.timeout.Before(time.Now()) &#123;\n\t\t\t\t\t\t\t\t\tdelete(d.dirty, key)\n\t\t\t\t\t\t\t\t\tcallback := dbResponse&#123;\n\t\t\t\t\t\t\t\t\t\tresponseType: withError,\n\t\t\t\t\t\t\t\t\t\treturns: map[responseFields]interface&#123;&#125;&#123;\n\t\t\t\t\t\t\t\t\t\t\tresponseError: notFoundError&#123;key: key&#125;,\n\t\t\t\t\t\t\t\t\t\t&#125;,\n\t\t\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\t\t\trequest.callback &lt;- callback\n\t\t\t\t\t\t\t\t&#125; else &#123;\n\t\t\t\t\t\t\t\t\tcallback := dbResponse&#123;\n\t\t\t\t\t\t\t\t\t\tresponseType: withValue,\n\t\t\t\t\t\t\t\t\t\treturns: map[responseFields]interface&#123;&#125;&#123;\n\t\t\t\t\t\t\t\t\t\t\tresponseValue:   entity.data,\n\t\t\t\t\t\t\t\t\t\t\tresponseTimeout: entity.timeout,\n\t\t\t\t\t\t\t\t\t\t&#125;,\n\t\t\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\t\t\trequest.callback &lt;- callback\n\t\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\t\tentity.readDone()\n\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\td.mu.RUnlock()\n\t\t\t\t\t\tcase setValue:\n\t\t\t\t\t\t\td.mu.Lock()\n\t\t\t\t\t\t\tkey := request.args[requestKey]\n\t\t\t\t\t\t\tvalue := request.args[requestValue]\n\t\t\t\t\t\t\ttimeout := request.args[requestTimeout].(time.Time)\n\t\t\t\t\t\t\tentity := &amp;entity&#123;\n\t\t\t\t\t\t\t\ttimeout: timeout,\n\t\t\t\t\t\t\t\tdata:    value,\n\t\t\t\t\t\t\t\tmu:      sync.RWMutex&#123;&#125;,\n\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\tentity.write()\n\t\t\t\t\t\t\td.dirty[key] = entity\n\n\t\t\t\t\t\t\tcallback := dbResponse&#123;\n\t\t\t\t\t\t\t\tresponseType: withValue,\n\t\t\t\t\t\t\t\treturns: map[responseFields]interface&#123;&#125;&#123;\n\t\t\t\t\t\t\t\t\tresponseValue:   entity.data,\n\t\t\t\t\t\t\t\t\tresponseTimeout: entity.timeout,\n\t\t\t\t\t\t\t\t&#125;,\n\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\tentity.writeDone()\n\t\t\t\t\t\t\trequest.callback &lt;- callback\n\t\t\t\t\t\t\td.mu.Unlock()\n\t\t\t\t\t\tcase deleteKey:\n\t\t\t\t\t\t\td.mu.Lock()\n\t\t\t\t\t\t\tkey := request.args[requestKey]\n\t\t\t\t\t\t\tif e, ok := d.dirty[key]; ok &#123;\n\t\t\t\t\t\t\t\te.write()\n\t\t\t\t\t\t\t\tdelete(d.dirty, key)\n\t\t\t\t\t\t\t\tcallback := dbResponse&#123;\n\t\t\t\t\t\t\t\t\tresponseType: withValue,\n\t\t\t\t\t\t\t\t\treturns:      nil,\n\t\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\t\trequest.callback &lt;- callback\n\t\t\t\t\t\t\t&#125; else &#123;\n\t\t\t\t\t\t\t\tcallback := dbResponse&#123;\n\t\t\t\t\t\t\t\t\tresponseType: withValue,\n\t\t\t\t\t\t\t\t\treturns:      nil,\n\t\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\t\trequest.callback &lt;- callback\n\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\td.mu.Unlock()\n\t\t\t\t\t\tcase rangeDB:\n\t\t\t\t\t\t\td.mu.Lock()\n\t\t\t\t\t\t\tfunction := request.args[requestFunc].(func(key, value interface&#123;&#125;))\n\t\t\t\t\t\t\tfor i, e := range d.dirty &#123;\n\t\t\t\t\t\t\t\te.write()\n\t\t\t\t\t\t\t\tfunction(i, e.data)\n\t\t\t\t\t\t\t\te.writeDone()\n\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\tcallback := dbResponse&#123;\n\t\t\t\t\t\t\t\tresponseType: withValue,\n\t\t\t\t\t\t\t\treturns:      nil,\n\t\t\t\t\t\t\t&#125;\n\t\t\t\t\t\t\trequest.callback &lt;- callback\n\t\t\t\t\t\t\td.mu.Unlock()\n\t\t\t\t\t\t&#125;\n\t\t\t\t\tcase &lt;-exitChan:\n\t\t\t\t\t\treturn\n\t\t\t\t\t&#125;\n\t\t\t\t&#125;\n\t\t\t&#125;(exitChan, d)\n\t\t&#125;\n\t\tgo func(e chan struct&#123;&#125;, d *database, w int) &#123;\n\t\t\tselect &#123;\n\t\t\tcase &lt;-d.exit:\n\t\t\t\tfor i := 0; i &lt; w; i++ &#123;\n\t\t\t\t\te &lt;- struct&#123;&#125;&#123;&#125;\n\t\t\t\t&#125;\n\t\t\t&#125;\n\t\t&#125;(exitChan, d, workers)\n\t&#125;\n\n&#125;\n\nfunc (d database) Close() &#123;\n\td.exit &lt;- struct&#123;&#125;&#123;&#125;\n&#125;\n\nentity.gopackage kv\n\nimport (\n\t\"sync\"\n\t\"time\"\n)\n\ntype entity struct &#123;\n\tmu      sync.RWMutex\n\ttimeout time.Time\n\tdata    interface&#123;&#125;\n&#125;\n\nfunc (e *entity) write() &#123;\n\te.mu.Lock()\n&#125;\n\nfunc (e *entity) writeDone() &#123;\n\te.mu.Unlock()\n&#125;\n\nfunc (e *entity) read() &#123;\n\te.mu.RLock()\n&#125;\n\nfunc (e *entity) readDone() &#123;\n\te.mu.RUnlock()\n&#125;\n\nbuff.gopackage kv\n\ntype typeRequest int\n\nconst (\n\tgetValue typeRequest = iota\n\tsetValue\n\tdeleteKey\n\trangeDB\n)\n\ntype typeResponse int\n\nconst (\n\twithError typeResponse = iota\n\twithValue\n)\n\ntype requestFields int\n\nconst (\n\trequestKey requestFields = iota\n\trequestValue\n\trequestTimeout\n\trequestFunc\n)\n\ntype responseFields int\n\nconst (\n\tresponseKey responseFields = iota\n\tresponseValue\n\tresponseTimeout\n\tresponseError\n)\n\ntype dbRequest struct &#123;\n\trequestType typeRequest\n\targs        map[requestFields]interface&#123;&#125;\n\tcallback    chan dbResponse\n&#125;\n\ntype dbResponse struct &#123;\n\tresponseType typeResponse\n\treturns      map[responseFields]interface&#123;&#125;\n&#125;\n\nfunc newDbRequest(rType typeRequest) *dbRequest &#123;\n\treturn &amp;dbRequest&#123;\n\t\trequestType: rType,\n\t\targs:        make(map[requestFields]interface&#123;&#125;),\n\t\tcallback:    make(chan dbResponse, 1),\n\t&#125;\n&#125;\n\nerror.gopackage kv\n\nimport \"fmt\"\n\ntype outOfRangeError struct &#123;\n\tupperIndex int\n\tlowerIndex int\n&#125;\n\nfunc (o outOfRangeError) Error() string &#123;\n\treturn fmt.Sprintf(\"kv-db out of range with [%v:%v]\", o.lowerIndex, o.upperIndex)\n&#125;\n\ntype notFoundError struct &#123;\n\tkey interface&#123;&#125;\n&#125;\n\nfunc (n notFoundError) Error() string &#123;\n\treturn fmt.Sprintf(\"kv-db cannot find key: %#v\", n.key)\n&#125;\n\næµ‹è¯•æµ‹è¯•æ–‡ä»¶ä¸‹é¢çš„å„ç§æƒ…å†µçš„æµ‹è¯•å‡åœ¨æœ¬æ–‡ä»¶çš„åŸºç¡€ä¸‹è¿›è¡Œï¼ŒåŒºåˆ«æ˜¯æ”¹äº†éƒ¨åˆ†å‚æ•°ï¼Œå•æ¬¡operationå‡ä¸ºåä¸‡æ¬¡è¯»&#x2F;å†™\npackage kv\n\nimport (\n\t\"math/rand\"\n\t\"testing\"\n\t\"time\"\n)\n\nvar (\n\tdb = NewDatabase(1, 1000)\n)\n\nfunc init() &#123;\n\tfor j := 0; j &lt; 10000; j++ &#123;\n\t\tdb.Set(rand.Int(), j, time.Second)\n\t&#125;\n&#125;\n\nfunc BenchmarkTest(b *testing.B) &#123;\n\n\tfor i := 0; i &lt; b.N; i++ &#123;\n\t\tfor j := 0; j &lt; 33333; j++ &#123;\n\t\t\tdb.Set(rand.Int(), j, time.Second)\n\t\t&#125;\n\t\tfor j := 0; j &lt; 33333; j++ &#123;\n\t\t\tdb.Delete(rand.Int())\n\t\t&#125;\n\t\tfor j := 0; j &lt; 33333; j++ &#123;\n\t\t\tdb.Get(rand.Int())\n\t\t&#125;\n\t&#125;\n&#125;\n\nçº¯è¯»å–æµ‹è¯•goos: darwin\ngoarch: arm64\npkg: github.com/sunist-c/CeobeBotFramework/infrastructure/kv\nBenchmarkTest\nBenchmarkTest-8   \t      13\t  85523782 ns/op\nPASS\n\nçº¯å†™å…¥æµ‹è¯•goos: darwin\ngoarch: arm64\npkg: github.com/sunist-c/CeobeBotFramework/infrastructure/kv\nBenchmarkTest\nBenchmarkTest-8   \t       8\t 148629094 ns/op\nPASS\n\nè¯»å†™æ··åˆæµ‹è¯•goos: darwin\ngoarch: arm64\npkg: github.com/sunist-c/CeobeBotFramework/infrastructure/kv\nBenchmarkTest\nBenchmarkTest-8   \t      12\t 105071628 ns/op\nPASS\n\nå¤šgoç¨‹çº¯è¯»å–æµ‹è¯•goos: darwin\ngoarch: arm64\npkg: github.com/sunist-c/CeobeBotFramework/infrastructure/kv\nBenchmarkTest\nBenchmarkTest-8   \t      13\t  85009984 ns/op\nPASS\n\nå¤šgoç¨‹çº¯å†™å…¥æµ‹è¯•goos: darwin\ngoarch: arm64\npkg: github.com/sunist-c/CeobeBotFramework/infrastructure/kv\nBenchmarkTest\nBenchmarkTest-8   \t       8\t 150155224 ns/op\nPASS\n\nå¤šgoç¨‹è¯»å†™æ··åˆæµ‹è¯•goos: darwin\ngoarch: arm64\npkg: github.com/sunist-c/CeobeBotFramework/infrastructure/kv\nBenchmarkTest\nBenchmarkTest-8   \t      12\t 106118806 ns/op\nPASS\n\nåœ¨åŸºå‡†æµ‹è¯•ä¸­ï¼Œç”±äºæµ‹è¯•æ˜¯é¡ºåºè¿›è¡Œçš„ï¼Œæ²¡æœ‰è¿›è¡Œå¹¶å‘å¤„ç†ï¼Œæˆ‘ä»¬åé¢åŠ ä¸Šäº†å¹¶å‘çš„æµ‹è¯•ï¼š\n\n\n\né¡¹ç›®\nè€—æ—¶\næµ‹è¯•é‡\n\n\n\nå•goç¨‹å‡è¡¡æµ‹è¯•\n647.506166ms\n100goç¨‹ï¼Œæ¯goç¨‹ä¸‡æ¬¡è¯»&#x2F;å†™\n\n\nå¤šgoç¨‹å‡è¡¡æµ‹è¯•\n784.627083ms\n100goç¨‹ï¼Œæ¯goç¨‹ä¸‡æ¬¡è¯»&#x2F;å†™\n\n\nå•goç¨‹å‡è¡¡æµ‹è¯•\n8.808718542s\n1000goç¨‹ï¼Œæ¯goç¨‹ä¸‡æ¬¡è¯»&#x2F;å†™\n\n\nå¤šgoç¨‹å‡è¡¡æµ‹è¯•\n11.675095125s\n1000goç¨‹ï¼Œæ¯goç¨‹ä¸‡æ¬¡è¯»&#x2F;å†™\n\n\nå¯è§ï¼Œéšç€goç¨‹çš„å¢å¤šï¼Œå•goç¨‹çš„æ–¹å¼å°±è¶Šæ¥è¶Šå¿«\næ€»ç»“æœ¬æ¥åšå¤šgoç¨‹workerçš„æ—¶å€™ï¼Œæ˜¯æ²¡æœ‰ç»™dirtyåŠ é”çš„ï¼Œåé¢æŠ¥äº†panicï¼ŒæŸ¥é˜…äº†èµ„æ–™ä»¥åå‘ç°ï¼Œmapä¸æ˜¯å¹¶å‘å®‰å…¨çš„åœ°æ–¹è¡¨ç°å°±è¡¨ç°åœ¨ï¼Œå®ƒä¸èƒ½å¹¶å‘åœ°è¿›è¡Œè¯»å†™ï¼ŒåŸæ¥è¿˜ä»¥ä¸ºåªæ˜¯ç®€å•è„æ•°æ®çš„é—®é¢˜â€¦æ‰€ä»¥åé¢æ— å¥ˆåŠ ä¸Šäº†é”\nè‡³äºçœŸÂ·å¤šgoç¨‹å®ç°ï¼Œå°±éœ€è¦ç­‰ä¸‹æ¬¡æœ‰ç©ºæ‘¸é±¼çš„æ—¶å€™æŠ›å¼ƒå†…å»ºmapè¿›è¡Œä¸€ä¸ªé‡æ„äº†\n","slug":"KeyValueStore-GolangImplement","date":"2022-07-20T09:16:54.000Z","categories_index":"blog","tags_index":"Golang,Redis,KeyValue","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"e234e9c36130a19f52c8637c43f3ee43","title":"æµ…è¯•golangæ³›å‹","content":"Golang 1.18æ­£å¼æ”¯æŒäº†æ³›å‹ï¼Œå½“æ—¶å°±æƒ³è¯•ä¸€è¯•ï¼Œæ— å¥ˆGolandå½“æ—¶çš„ç‰ˆæœ¬ä¸æ”¯æŒï¼Œæœ€è¿‘æ‰æ„è¯†åˆ°2022å¹´çš„Golandå·²ç»å¼€å§‹æ”¯æŒGolangçš„æ³›å‹äº†ï¼Œé‚è¿›è¡Œä¸€ä¸‹å°å°è¯•ï¼Œé¡ºä¾¿åšä¸€ä¸‹è®°å½•\nEnv\n\n\n\n\n\n\n\n\næ“ä½œç³»ç»Ÿ: macOS Monterey Version12.4\nIDE: Goland 2021.3.4\nGoEnv: go 1.18.4 arm64\næ³›å‹ä½¿ç”¨ä½¿ç”¨æ–¹æ³•Golangçš„æ³›å‹å£°æ˜æ–¹æ³•å’ŒJava&#x2F;C++ç›¸å·®ä¸å¤§ï¼Œå…¶è¯­æ³•å¦‚ä¸‹ï¼š\nfunc sort[T any](array []T, cmp func(T, T) bool) &#123;\n    // ...implements\n&#125;\n\ntype IList[T any] interface &#123;\n    // ...methods\n&#125;\n\ntype List[T any] struct &#123;\n    // ...fields\n&#125;\n\nå®Œæ•´ç¤ºä¾‹ä¸‹é¢çš„ä»£ç æ˜¯ç®€å•å®ç°çš„æ’åºæ–¹æ³•ï¼Œæ‡’å°±å†™äº†ä¸ªç®€å•çš„å†’æ³¡ï¼š\npackage main\n\nimport \"fmt\"\n\nfunc sort[T any](arr []T, cmp func(a, b T) bool) &#123;\n\tfmt.Printf(\"sorting array: %#v\\n\", arr)\n\tsorted := false\n\tfor i := 0; !sorted; i++ &#123;\n\t\tsorted = true\n\t\tfor j := i; j &lt; len(arr); j++ &#123;\n\t\t\tif cmp(arr[i], arr[j]) &#123;\n\t\t\t\tarr[i], arr[j] = arr[j], arr[i]\n\t\t\t\tsorted = false\n\t\t\t&#125;\n\t\t&#125;\n\t&#125;\n&#125;\n\nfunc cmp(a, b int) bool &#123;\n\treturn a >= b\n&#125;\n\nfunc main() &#123;\n\tarr := []int&#123;1, 4, 5, 3, 2&#125;\n\tsort(arr, cmp)\n\tfmt.Printf(\"sorted array: %#v\\n\", arr)\n&#125;\n\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\nsorting array: []int&#123;1, 4, 5, 3, 2&#125;\nsorted array: []int&#123;1, 2, 3, 4, 5&#125;\n\nProcess finished with the exit code 0\n\næ³¨æ„äº‹é¡¹è™½ç„¶interface&#123;&#125;å’Œstruct&#123;&#125;å¯ä»¥è¢«[T any]ä¿®é¥°ï¼Œä½†æ˜¯å°†[T any]ä¿®é¥°ç»“æ„ä½“çš„æ–¹æ³•æ—¶ï¼ŒGolandåˆ™ä¼šæŠ¥é”™ï¼š\nMethod cannot have type parameters\n\nå¹¶ä¸”ç”¨ç»“æ„ä½“å®ç°å¸¦[T any]ä¿®é¥°çš„æ¥å£æ—¶ï¼ŒGolandè‡ªåŠ¨ç”Ÿæˆå®ç°æ—¶ï¼Œä¼šä¿®æ”¹æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œå°†Tä¿®æ”¹ä¸ºinterface&#123;&#125;ï¼š\nå®šä¹‰çš„æ¥å£ï¼š\ntype IList[T any] interface &#123;\n\tInsert(int, T)\n&#125;\n\nè‡ªåŠ¨ç”Ÿæˆçš„å®ç°ï¼š\nfunc (l List) Insert(i int, t interface&#123;&#125;) &#123;\n\t//TODO implement me\n\tpanic(\"implement me\")\n&#125;\n\næ€»ç»“æˆ‘ä¹Ÿåªæ˜¯ä¸ªåˆšå…¥é—¨goçš„å°è’Ÿè’»ï¼Œæ€»ç»“å¯èƒ½ä¸åˆ°ä½ï¼Œæ°‘é‚£æ¡‘çœ‹çœ‹å°±å¥½\n\nç¬¬ä¸€çœ¼çœ‹å±…ç„¶å’Œtemplate&lt;class T&gt;å·®ä¸å¤šï¼Œæœ¬æ¥ä»¥ä¸ºèƒ½å¤Ÿçªç ´goé’ˆå¯¹ä¸åŒç±»å‹ä»£ç å¤ç”¨çŠ¶å†µï¼Œå®é™…ä½¿ç”¨ä¸‹æ¥ä¹Ÿåªèƒ½åœ¨å‡½æ•°ä¸Šä¸‹ä¸‹åŠŸå¤«ï¼ŒåŸºæœ¬ç­‰äºé™æ€æ–¹æ³•çš„æ³›å‹\næœ¬ä»¥ä¸ºå¯ä»¥çªç ´C&#x2F;C++è¿è¡Œæ—¶æ³›å‹çš„å±€é™ï¼Œå› ä¸ºgoçš„æ³›å‹æ˜¯åœ¨ç¼–è¯‘å‰å°±ä¼šæç¤ºé”™è¯¯çš„ï¼Œä½†æ˜¯ç»“æœgoçš„æ³›å‹å¹¶ä¸èƒ½æŒ‚åœ¨ç»“æ„ä½“ä¹Ÿå°±æ˜¯å¯¹è±¡ä¸Šä½¿ç”¨ï¼Œæ€»ä½“æ¥è¯´æ²¡æœ‰Java&#x2F;C#ä¸€ç±»çš„å¼ºOOPè¯­è¨€èˆ’æœ\næœŸå¾…å¤§ä½¬ä»¬èƒ½å¤Ÿåœ¨goæ³›å‹çš„åŸºç¡€ä¸Šå°ä¸€äº›å®¹å™¨å‡ºæ¥äº†ï¼Œåˆ°æ—¶å€™å°±ä¸ç”¨æ‰‹å†™åŸºç¡€ç»“æ„ä½“äº†ï¼Œç›´æ¥è°ƒåŒ…â€¦â€¦\n\n","slug":"Try-GolangGenerics","date":"2022-07-18T06:44:39.000Z","categories_index":"blog","tags_index":"Golang,OOP,Generics","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"a3fb736aa42338fc8e8d5d10993cc4eb","title":"ProjectAnalysis - è®¾è®¡æ–‡æ¡£","content":"\n\n\n\n\n\n\n\n\næœ¬blogæ˜¯ SunistC åœ¨å­¦å¹´è®¾è®¡æœŸé—´ï¼Œä¸ºäº†å·ä¸€ä¸ªé¡¹ç›®å’Œå°ç»„åŒå­¦ä¸€èµ·æ‹¿é«˜åˆ†ï¼Œè®¡åˆ’å¼€å‘çš„åŸºäºå¤§æ•°æ®çš„åˆ†å¸ƒå¼å¾®æœåŠ¡ç³»ç»Ÿï¼Œç”¨äºå¯è§†åŒ–å±•ç¤ºå…¨çƒçš„ç–«æƒ…çŠ¶å†µï¼Œæœ¬æ–‡æ˜¯è®¾è®¡é˜¶æ®µçš„è®°å½•ï¼Œæœ¬æ–‡æ‰€å¯¹åº”çš„ä»“åº“ä¸º ProjectAnalysis ï¼Œé‡‡ç”¨ MIT åè®®\n1. æ¶æ„1.1 Overview\n1.2 Frontend - å±•ç¤ºæ•°æ®\nä½¿ç”¨Vue.jsæ„å»ºWeb\nä½¿ç”¨Echartsæ‰§è¡Œå›¾å½¢å¯è§†åŒ–\nä½¿ç”¨Materialä½œä¸ºUIæ¡†æ¶\n\n1.3 Backend - å“åº”å‰ç«¯&#x2F;è°ƒèµ·å¤§æ•°æ®æœåŠ¡\nä½¿ç”¨go-ginæ„å»ºhttpæœåŠ¡\nä½¿ç”¨go-zeroæ‹†åˆ†å¾®æœåŠ¡\nä½¿ç”¨OAuth2.0è¿›è¡Œå®¢æˆ·ç«¯è®¤è¯\nä½¿ç”¨Kafkaè¿›è¡Œæ—¥å¿—æ”¶é›†\nä½¿ç”¨Rediså’ŒClickHouseä½œä¸ºä¸´æ—¶æ•°æ®å­˜å‚¨\nä½¿ç”¨Mysqlä½œä¸ºæŒä¹…åŒ–æ•°æ®å­˜å‚¨\nä½¿ç”¨cronå®šæ—¶å¤„ç†scrapyçˆ¬è™«ä»»åŠ¡\n\n1.4 Big Data - å¤§æ•°æ®ç¦»çº¿å¤„ç†\nä½¿ç”¨SpringRPCè¿›è¡Œrpcè°ƒç”¨\nä½¿ç”¨Hiveä½œä¸ºå¤§æ•°æ®ç¦»çº¿å¤„ç†å·¥å…·\nä½¿ç”¨Mysqlä½œä¸ºæŒä¹…åŒ–æ•°æ®å­˜å‚¨\nä½¿ç”¨HBaseä½œä¸ºæ•°æ®ä»“åº“\n\n2. åŠŸèƒ½ç‚¹2.1 å‰ç«¯åŠŸèƒ½ç‚¹Overview\n\n\n\n\n\n\n\n\nç«å“å‚è€ƒï¼š COVID-19 Map - Johns Hopkins Coronavirus Resource Center (jhu.edu)\n\n\nåŠŸèƒ½1: åœ°å›¾å¯è§†åŒ–\nåˆ†ä¸ºå›½é™…åœ°å›¾ã€å›½å†…åœ°å›¾ã€åŸå¸‚åœ°å›¾ä¸‰ä¸ªå±‚çº§ï¼Œæ¯ä¸ªå±‚çº§åˆ†åˆ«å¯è§†åŒ–å±•ç¤ºçƒ­åŠ›å›¾æˆ–è€…æ•£ç‚¹å›¾\nå›½é™…åœ°å›¾ç‚¹å‡»ä¸­å›½å›½ç•Œå¯ä»¥è·³è½¬åˆ°å›½å†…åœ°å›¾\nå›½å†…åœ°å›¾ç‚¹å‡»çœä»½å¯ä»¥è·³è½¬åˆ°åŸå¸‚åœ°å›¾\næœ€é«˜ç²¾åº¦ç²¾ç¡®åˆ°åŸå¸‚&#x2F;åŒº\n\n\nåŠŸèƒ½2: å›¾å½¢å¯è§†åŒ–\néšåœ°å›¾å¯è§†åŒ–åŠŸèƒ½åŒæ­¥å˜åŒ–ï¼Œç”¨æˆ·å¯é€‰å±•ç¤ºä¿¡æ¯\nå¯å±•ç¤ºä¿¡æ¯å¦‚ä¸‹ï¼š\nå½“å‰åŒºåŸŸæ¯å‘¨æ­»äº¡&#x2F;æ¯å‘¨æ„ŸæŸ“&#x2F;æ¯å‘¨æ²»æ„ˆç—…ä¾‹\nå½“å‰åŒºåŸŸæ¯å¤©æ­»äº¡&#x2F;æ¯å¤©æ„ŸæŸ“&#x2F;æ¯å¤©æ²»æ„ˆç—…ä¾‹\n\n\n\n\nåŠŸèƒ½3: TopNå›¾è¡¨\néšåœ°å›¾å¯è§†åŒ–åŠŸèƒ½åŒæ­¥å˜åŒ–ï¼Œç”¨æˆ·å¯é€‰å±•ç¤ºä¿¡æ¯\nå¯å±•ç¤ºä¿¡æ¯å¦‚ä¸‹ï¼š\nå½“å‰åŒºåŸŸæ„ŸæŸ“TopN\nå½“å‰åŒºåŸŸæ²»æ„ˆTopN\nå½“å‰åŒºåŸŸæ­»äº¡TopN\n\n\n\n\nåŠŸèƒ½4: å½“å‰åŒºåŸŸä¿¡æ¯å±•ç¤º\néšåœ°å›¾å¯è§†åŒ–åŠŸèƒ½åŒæ­¥å˜åŒ–ï¼Œå‘ç”¨æˆ·å±•ç¤ºä»¥ä¸‹ä¿¡æ¯ï¼š\nå½“å‰åŒºåŸŸç´¯è®¡ç—…ä¾‹\nå½“å‰åŒºåŸŸç´¯è®¡æ­»äº¡\nå½“å‰åŒºåŸŸç´¯è®¡æ²»æ„ˆ\nå½“å‰åŒºåŸŸæœ¬æœˆç—…ä¾‹\nå½“å‰åŒºåŸŸæœ¬æœˆæ­»äº¡\nå½“å‰åŒºåŸŸæœ¬æœˆæ²»æ„ˆ\nå½“å‰åŒºåŸŸæ¯æ—¥ç—…ä¾‹\nå½“å‰åŒºåŸŸæ¯æ—¥æ­»äº¡\nå½“å‰åŒºåŸŸæ¯æ—¥æ²»æ„ˆ\n\n\n\n\nåŠŸèƒ½5: å½“å‰åŒºåŸŸæ–°é—»å±•ç¤º\néšåœ°å›¾å¯è§†åŒ–åŠŸèƒ½åŒæ­¥å˜åŒ–ï¼Œå‘ç”¨æˆ·å±•ç¤ºå½“å‰åŒºåŸŸçš„ç–«æƒ…ç›¸å…³æ–°é—»ä¸æ‘˜è¦\n\n\n\n2.2 åç«¯åŠŸèƒ½ç‚¹\nåŠŸèƒ½1: åŸºäºOAuth2.0åè®®å’ŒJWTè¿›è¡Œå®¢æˆ·ç«¯éªŒè¯ä¸ç”¨æˆ·éªŒè¯\nåŠŸèƒ½2: åŸºäºKafkaè¿›è¡Œæ—¥å¿—æ”¶é›†å’Œæ¶ˆæ¯åˆ†å‘\nåŠŸèƒ½3: åŸºäºgRPCåè®®å’Œgo-zero&#x2F;go-ginæ¡†æ¶ï¼Œæä¾›httpæœåŠ¡ï¼Œå¹¶ä½¿ç”¨Dockeræ„å»ºå¾®æœåŠ¡é›†ç¾¤\nåŠŸèƒ½4: åŸºäºscrapyå’Œcronè¿›è¡Œå®šæœŸæ•°æ®çˆ¬å–æ•°æ®ï¼Œä½¿ç”¨rpcè°ƒç”¨å¤§æ•°æ®ç«¯è¿›è¡Œç¦»çº¿æ•°æ®å¤„ç†\nåŠŸèƒ½5: ä½¿ç”¨rediså’ŒClickHouseè¿›è¡Œæ•°æ®ç¼“å­˜\n\n2.3 å¤§æ•°æ®ç«¯åŠŸèƒ½ç‚¹\nåŠŸèƒ½1: åŸºäºçˆ¬è™«æ•°æ®è®¡ç®—å¹¶æ›´æ–°åœ°å›¾æ•°æ®\n\n3. æ¥å£3.1 å¤§æ•°æ®ç«¯æ¥å£\nUpdateData: æ›´æ–°ç‰¹å®šåŒºåŸŸçš„æ•°æ®æ¥å£(grpc)\n\nsyntax = \"proto3\";\n\noption java_package = \"cn.sunist.project-analysis.grpc\";\noption java_multiple_file = false;\noption java_outer_classname = \"UpdateDataService\";\n\n// æ›´æ–°åŒºåŸŸæ•°æ®rpcè¯·æ±‚\nmessage UpdateDataRequest &#123;\n\tmessage MapData &#123;\n\t\tstring LocationID = 1;\n\t\tstring LocationType = 2;\n\t&#125;\n\tint32 RequestTime = 1;\n\trepeated MapData MapRequest = 2;\n&#125;\n\n// æ›´æ–°åŒºåŸŸæ•°æ®rpcå“åº”\nmessage UpdateDataResponse &#123;\n\tmessage MapData &#123;\n\t\tstring LocationID = 1;\n\t\tstring LocationType = 2;\n\t\tbool LocationUpdateStatus = 3;\n\t&#125;\n\trepeated MapData MapResponse = 1;\n&#125;\n\n// æ›´æ–°åŒºåŸŸæ•°æ®rpcæœåŠ¡: æ ¹æ®æ—¶é—´å’Œåœ°ç‚¹åˆ—è¡¨ï¼Œæ›´æ–°å…¨éƒ¨è¯·æ±‚åŒºåŸŸçš„æ•°æ®ï¼Œå¹¶å°†å¤„ç†ç»“æœè¿”å›\nservice UpdateData &#123;\n\trpc updateData(UpdateDataRequest) returns (UpdateDataResponse);\n&#125;\n\n3.2 åç«¯æ¥å£\nOAuthæ¨¡å—\nNewClient: æ–°å»ºOAuthå®¢æˆ·ç«¯(http)\nNewUser: æ–°å»ºOAuthç”¨æˆ·(http)\nToken: ç”³è¯·OAuthçš„Token(http)\nRefreshToken: ç”³è¯·OAuthçš„RefreshToken(http)\nIntrospect: éªŒè¯OAuthçš„Token(http)\n\n\nOverviewæ¨¡å—\nMapOverview: è·å–æŸåŒºåŸŸçš„ç–«æƒ…æ¦‚å†µ(http)\n\n\nStatisticsæ¨¡å—\nMapStatistic: è·å–æŸåŒºåŸŸçš„ç–«æƒ…ç»Ÿè®¡(http)\n\n\nCronæ¨¡å—\nProcess: æ‰§è¡ŒCronä»»åŠ¡(http)\nReport: æŸ¥çœ‹Cronä»»åŠ¡çš„æ‰§è¡ŒçŠ¶å†µ(http)\nOptions: æ›´æ”¹Cronä»»åŠ¡é…ç½®(http)\n\n\nTraceæ¨¡å—ç¼ºçœï¼Œæœ‰ç©ºå†åš\n\n","slug":"ProjectAnalysisDesignDocument","date":"2022-06-26T16:00:00.000Z","categories_index":"blog","tags_index":"Backend,Golang,Big Data,Java","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"c241d614c6965b00ab46082015324893","title":"å­¦ä¹ ç¬”è®° - è®¡ç®—æœºç½‘ç»œ","content":"åè®®1. TCPç½‘ç»œçš„åˆ†å±‚TCPç½‘ç»œåˆ†å±‚åˆ†ä¸ºåº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œäº’è”å±‚ã€ç½‘ç»œè®¿é—®å±‚å’Œç‰©ç†å±‚äº”å±‚ã€‚ä»¥HTTPä¸ºä¾‹ï¼Œä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯ä¹‹é—´çš„é€šä¿¡ï¼Œéœ€è¦ç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼š\nClientçš„é€šä¿¡\n(åº”ç”¨å±‚)æ ¹æ®HTTPåè®®ç»„è£…æ•°æ®åŒ…\n(ä¼ è¾“å±‚)å°†ç«¯å£å·ã€åºåˆ—å·ç­‰ç»„è£…è¿›TCPå¤´éƒ¨ï¼Œå¢åŠ åˆ°æ•°æ®åŒ…å†…\n(ç½‘ç»œäº’è”å±‚)å°†æºIPåœ°å€ç­‰ä¿¡æ¯ç»„è£…è¿›IPå¤´éƒ¨ï¼Œå¢åŠ åˆ°æ•°æ®åŒ…å†…\n(ç½‘ç»œè®¿é—®å±‚)å°†MACåœ°å€ç­‰ä¿¡æ¯ç»„è£…è¿›ä»¥å¤ªç½‘å¤´éƒ¨ï¼Œå¢åŠ åˆ°æ•°æ®åŒ…å†…\n(ç‰©ç†å±‚)é€šè¿‡ç‰©ç†å±‚å‘é€æ•°æ®åŒ…\n\nServerçš„é€šä¿¡\n(ç‰©ç†å±‚)ä»ç‰©ç†å±‚æ¥å—æ•°æ®åŒ…\n(ç½‘ç»œè®¿é—®å±‚)å–å‡ºä»¥å¤ªç½‘ä¸­çš„ä»¥å¤ªç½‘å¤´éƒ¨ï¼Œæ ¹æ®MACåœ°å€åˆ¤æ–­åŒ…æ˜¯ä¸æ˜¯å‘ç»™è‡ªå·±çš„\n(ç½‘ç»œäº’è”å±‚)å–å‡ºIPåŒ…è¿›è¡ŒIPæŠ¥æ–‡è§£æï¼Œç¡®å®šä¼ é€æ•°æ®åŒ…ä¸è·¯ç”±\n(ä¼ è¾“å±‚)å–å‡ºTCPåŒ…è¿›è¡ŒTCPæŠ¥æ–‡è§£æ\n(åº”ç”¨å±‚)å–å‡ºHTTPåŒ…ï¼Œå¹¶ä½œå‡ºHTTPæŠ¥æ–‡è§£æ\n\nè®¾è®¡ä¼˜åŠ¿TCPç½‘ç»œåˆ†å±‚çš„ä¼˜åŠ¿å¦‚ä¸‹ï¼š\n\nå„å±‚ç‹¬ç«‹ é™åˆ¶äº†ä¾èµ–å…³ç³»çš„èŒƒå›´ï¼Œå„å±‚ä¹‹é—´ä½¿ç”¨æ ‡å‡†åŒ–çš„æ¥å£ï¼Œå„å±‚ä¸éœ€è¦çŸ¥é“ä¸Šä¸‹å±‚å®ç°åŸåœ°ï¼Œå¢åŠ æˆ–è€…ä¿®æ”¹ä¸€ä¸ªåº”ç”¨åè®®ä¸ä¼šå½±å“å…¶ä»–å±‚çº§\nçµæ´»æ€§é«˜ ä¾èµ–æŸä¸€å±‚çº§çš„è½¯ä»¶æˆ–è€…ç¡¬ä»¶ï¼Œåªéœ€è¦å¤„ç†å¥½æœ¬å±‚çº§çš„é€»è¾‘å³å¯ï¼Œä¸éœ€è¦åŠ è½½å…¶ä»–å±‚çº§\næ˜“äºæµ‹è¯•å’Œç»´æŠ¤ æé«˜äº†å¯æµ‹è¯•æ€§ï¼Œå¯ä»¥å¯¹æŸä¸€å±‚ç‹¬ç«‹æµ‹è¯•ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæ•´ä½“æ›¿æ¢\n\n2. TCPçš„ä¸‰æ¬¡æ¡æ‰‹TCPçš„ä¸‰æ¬¡æ¡æ‰‹ç”¨äºå»ºç«‹TCPè¿æ¥\næµç¨‹TCPçš„Clientå’ŒServerä¹‹é—´çš„ä¸‰æ¬¡æ¡æ‰‹æµç¨‹å¦‚ä¸‹ï¼š\n\nClientå‘é€è¿æ¥è¯·æ±‚ï¼ŒSYN seq = x\nServerå“åº”è¯·æ±‚ï¼ŒSYN seq = y, ACK = x + 1\nClientç¡®è®¤Serverçš„å“åº”è¯·æ±‚ï¼ŒACK = y + 1\n\nå¿…è¦æ€§\n\n\n\n\n\n\n\n\nTCPåè®®æ˜¯ä¼ è¾“å±‚åè®®ï¼Œå…¶æœ¬è´¨æ˜¯é¢å‘è¿æ¥çš„åè®®\n\nè‹¥TCPæ˜¯ä¸¤æ¬¡æ¡æ‰‹çš„è¯ï¼Œåˆ™Serveræ— æ³•ç¡®è®¤Clientçš„è¿æ¥èƒ½åŠ›ï¼Œé€ æˆServerç«¯çš„è¿æ¥èµ„æºæµªè´¹\nå› ä¸ºç¡®è®¤åŒæ–¹é€šä¿¡èƒ½åŠ›åªéœ€è¦ä¸‰æ¬¡è¿æ¥ï¼Œè‹¥TCPæ˜¯å››æ¬¡æ¡æ‰‹çš„è¯ï¼Œåˆ™ä¼šé€ æˆåŒæ–¹çš„è¿æ¥èµ„æºæµªè´¹\n\n3. TCPçš„å››æ¬¡æŒ¥æ‰‹TCPçš„å››æ¬¡æŒ¥æ‰‹ç”¨äºæ–­å¼€TCPè¿æ¥\næµç¨‹TCPçš„Clientå’ŒServerä¹‹é—´çš„å››æ¬¡æŒ¥æ‰‹æµç¨‹å¦‚ä¸‹ï¼š\n\nClientå‘é€ç»ˆæ­¢è¿æ¥è¯·æ±‚ï¼ŒFIN seq = x+2, ACK = y+1\nServerå“åº”ç»ˆæ­¢è¿æ¥è¯·æ±‚ï¼ŒACK = x+3\nServerå‘é€è¿æ¥ç»ˆæ­¢å“åº”ï¼ŒFIN seq = y+1\nClientç¡®è®¤è¿æ¥ç»ˆæ­¢ï¼ŒACK = y+2\n\n\n\n\n\n\n\n\n\n\n\næœ€è¿‘åœ¨æŠ•ç®€å†ï¼Œæ‰æ„è¯†åˆ°è¦æŠ•å®ä¹ äº†ï¼Œå…ˆå›å»ç¡è§‰äº†ï¼Œæ™šäº›å†æ›´\n","slug":"NetworkReview","date":"2022-04-14T13:38:28.000Z","categories_index":"blog","tags_index":"Algorithm,Backend,Network","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"aaa86bd7061c6b37fa4d0d3fb50508ac","title":"CeobeBotåç«¯ - è®¾è®¡","content":"\n\n\n\n\n\n\n\n\nå…ˆå ä¸ªå‘\n","slug":"CeobeBot-Backend","date":"2022-04-06T15:41:49.000Z","categories_index":"blog","tags_index":"Backend,Golang,CeobeBot","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"ad6656b837719f2ab38e772bf34bead7","title":"CeobeBotæ’ä»¶ - æ˜æ—¥æ–¹èˆŸæ¨¡å—","content":"\n\n\n\n\n\n\n\n\næœ¬blogä¾›CeobeBotç›¸å…³ç»´æŠ¤è€…å¼€å‘æ’ä»¶æ—¶å‚è€ƒï¼Œæœ¬æ’ä»¶çš„å®é™…ä»“åº“åœ°å€ä¸ºï¼šSchwarzPlatform::VCS(è¯·ä½¿ç”¨å®éªŒå®¤ç½‘ç»œè®¿é—®)ï¼Œå¤–éƒ¨ä»“åº“åœ°å€ä¸º: GitHubï¼Œé•œåƒåœ°å€ä¸º: Giteaã€‚å¤–éƒ¨ä»“åº“ä¸é•œåƒä»“åº“çš„æ›´æ–°å¯èƒ½ä¸åŠæ—¶\n1. è®¾è®¡æ€è·¯1.1 ArknightsPluginä¸CeobeBotçš„å¯¹æ¥æ•´ä¸ªæ˜æ—¥æ–¹èˆŸæ¨¡å—ä¸CeobeBotè§£è—•ï¼Œä»¥ç‹¬ç«‹é¡¹ç›®çš„å½¢å¼è¿è¡Œï¼Œåœ¨ArknightsPluginæ¨¡å—ä¸­ï¼Œå°†æ‰€æœ‰çš„ä¾èµ–å¦‚DbConnection/gin.Engine/log.Loggerç­‰ç»„ä»¶æŠ½ç¦»ï¼Œåœ¨ä¾é™„äºCeobeBotè¿è¡Œæ—¶ï¼Œä»å¤–éƒ¨è·å–ç›¸åº”ç»„ä»¶ï¼Œåœ¨ç‹¬ç«‹è¿è¡Œæ—¶ï¼Œä½¿ç”¨mainåŒ…ç‹¬ç«‹åˆ›å»ºç›¸å…³ç»„ä»¶å®ä½“\nArknightsPluginåœ¨è®¾è®¡æ—¶è¢«èµ‹äºˆä»¥ä¸‹åŠŸèƒ½ï¼š\n\nåŸºç¡€ä¿¡æ¯æŸ¥è¯¢ï¼Œå¦‚å¹²å‘˜ä¿¡æ¯ã€ææ–™ä¿¡æ¯ç­‰\nå…¬å¼€æ‹›å‹Ÿæ¨¡æ‹Ÿï¼Œå¦‚æ ¹æ®tagæ¥è·å–å…¬å¼€æ‹›å‹Ÿç»“æœï¼Œæˆ–æ ¹æ®æ¸¸æˆæˆªå›¾ï¼Œä½¿ç”¨ocræ¥è·å–tagï¼Œç„¶åè·å–å…¬å¼€æ‹›å‹Ÿç»“æœ\næ¨¡æ‹ŸæŠ½å¡ï¼Œä½¿ç”¨æ˜æ—¥æ–¹èˆŸå·²å…¬å¼€çš„æŠ½å¡æ¨¡å‹ï¼Œå³å›ºå®šæ¦‚ç‡+è¡¥æ­£æ¦‚ç‡ï¼Œå‘ä½¿ç”¨è€…è¿”å›æŠ½å¡ç»“æœ\næ•°æ®åŒæ­¥ï¼Œå³è®©æœ¬æ’ä»¶çš„å¹²å‘˜ä¿¡æ¯ã€å¡æ± ä¿¡æ¯ç­‰å®šæœŸä¸å…¬å¼€æ¸¸æˆæ•°æ®åŒæ­¥\n\nåˆ™ç°åœ¨ï¼Œç”¨æˆ·åœ¨CeobeBotä¸­ä½¿ç”¨ArknightsPluginæä¾›çš„åŠŸèƒ½ï¼Œè¿‡ç¨‹ä¸ºï¼š\n\nAdachiBotå‰ç«¯è·å–ç”¨æˆ·æŒ‡ä»¤ï¼Œå¹¶å‘CeobeBotåç«¯å‘èµ·è°ƒç”¨\nCeobeBotåç«¯è¿›è¡Œé‰´æƒç­‰æµç¨‹ï¼Œç„¶åè°ƒç”¨ArknightsPluginçš„æ¥å£\nCeobeBotåç«¯å¤„ç†å¹¶è¿”å›å“åº”ç»™AdachiBot\nAdachiBotå°†å“åº”è§£æå¹¶æ¸²æŸ“ã€å‘é€ç»™ç”¨æˆ·\n\n1.2 æ¨¡å—è®¾è®¡ArknightsPluginçš„ä¸»è¦æ¨¡å—ç”±coreï¼Œmoduleå’Œmiddlewareä¸‰ä¸ªåŒ…æ„æˆ\ncoreåŒ…coreåŒ…å†…æ˜¯æ‰€æœ‰CRUDä¸šåŠ¡é€»è¾‘çš„å®ç°ï¼ŒåŒ…æ‹¬ä¸‹è¿°æ–‡ä»¶ï¼š\ncore.go  // coreåŒ…çš„å…¬å…±å®ç°ï¼Œè¯¸å¦‚initï¼Œè·å–é…ç½®ï¼Œå®ä¾‹åŒ–å¿…é¡»ç»„ä»¶ç­‰å®ç°\nrecruit.go  // å…¬å¼€æ‹›å‹Ÿçš„å®ç°ï¼ŒåŒ…æ‹¬tagç­›é€‰ï¼Œç¬›å¡å°”ç§¯è®¡ç®—ï¼Œç»“æœç¡®å®šç­‰å®ç°\ninfo.go  // åŸºç¡€ä¿¡æ¯ç­‰å®ç°ï¼ŒåŒ…æ‹¬è·å–å¹²å‘˜åŸºæœ¬ä¿¡æ¯ï¼Œè·å–ææ–™åŸºæœ¬ä¿¡æ¯ç­‰å®ç°\ngacha.go  // æ¨¡æ‹ŸæŠ½å¡çš„å®ç°ï¼ŒåŒ…æ‹¬æ¦‚ç‡è®¡ç®—ï¼ŒæŠ½å¡æœŸæœ›(è¿˜éœ€è¦å¤šå°‘æŠ½å‡ºè´§)è®¡ç®—ç­‰å®ç°\n\nmoduleåŒ…moduleåŒ…æ˜¯æ‰€æœ‰ArknightsPluginæ‰€éœ€æ•°æ®åº“æ¨¡å‹æ•°æ®çš„ç»“æ„ï¼ŒåŒ…æ‹¬ä¸‹è¿°æ–‡ä»¶ï¼š\nglobal.go  // æ’ä»¶å†…å…¨å±€å˜é‡çš„å®šä¹‰ï¼Œå¦‚dbConnection/configData/apiRouterç­‰\nconfig.go  // æ’ä»¶è¿è¡Œæ‰€éœ€çš„å¿…è¦é…ç½®ï¼Œå¦‚databaseConfig/ocrConfig/routerConfigç­‰\noperator.go  // å¹²å‘˜ç›¸å…³ä¿¡æ¯çš„å®šä¹‰ï¼Œå¦‚å¹²å‘˜æŠ€èƒ½ï¼Œå¹²å‘˜å±æ€§ï¼Œå¹²å‘˜ä¿¡æ¯ç­‰\nmaterial.go  // ææ–™ä¿¡æ¯çš„ç›¸å…³å®šä¹‰ï¼Œå¦‚ææ–™ä¿¡æ¯ã€åˆæˆè¡¨ç­‰\nrecruit.go  // å…¬æ‹›ç›¸å…³ä¿¡æ¯çš„å®šä¹‰ï¼Œå¦‚tagä¿¡æ¯ç­‰\ngacha.go  // æŠ½å¡ä¿¡æ¯çš„ç›¸å…³å®šä¹‰ï¼Œå¦‚å¡æ± ä¿¡æ¯ã€æŠ½å¡è®°å½•ç­‰\n\nmiddlewareåŒ…mdiilewareåŒ…æ˜¯æ‰€æœ‰ArknightsPluginæ‰€éœ€å·¥å…·ç±»è¾…åŠ©åŠŸèƒ½çš„å®ç°ï¼ŒåŒ…æ‹¬ä¸‹è¿°åˆ†åŒ…ï¼š\nsyncer  // ä»GitHubå…¬å¼€çš„ArknightsGameDataåŒæ­¥æ˜æ—¥æ–¹èˆŸæ•°æ®åˆ°æœ¬åœ°\nfileReader  // ä»æ–‡ä»¶è·å–æ•°æ®å¦‚é…ç½®ä¿¡æ¯ï¼Œæ•°æ®åº“ç­‰åˆ°ArknightsPlugin\nfileWriter  // è¾“å‡ºArknightsäº§ç”Ÿçš„æ•°æ®å¦‚æ—¥å¿—ç­‰åˆ°æ–‡ä»¶\n\napiåŒ…apiåŒ…æ˜¯å°†coreåŒ…å®ç°çš„é€»è¾‘ä½¿ç”¨ginæ¡†æ¶åŒ…è£…ä¸ºhttpæœåŠ¡çš„å®ç°ã€‚\n1.3 APIè®¾è®¡\n\n\n\n\n\n\n\n\nå…·ä½“APIæ–‡æ¡£è¯·è½¬åˆ°é¡¹ç›®wiki\n:/recruitGET :/recruit/ocr\nbody: application/jsonï¼Œä¼ è¾“å›¾ç‰‡base64ç¼–ç \né€šè¿‡ocrè¿›è¡Œå…¬æ‹›æ¨¡æ‹Ÿ\nGET :/recruit/tags?tag=${tagArray}\nbody: null\né€šè¿‡è¯æ¡è¿›è¡Œå…¬æ‹›æ¨¡æ‹Ÿ\nGET :/recruit/operator/:operatorName\nbody: null\né€šè¿‡å¹²å‘˜åç§°è·å–å…¶å…¬æ‹›è¯æ¡ï¼Œå¹²å‘˜åä¸ºç©ºåˆ™è¿”å›æ‰€æœ‰èƒ½å¤Ÿå…¬æ‹›çš„å¹²å‘˜åŠå…¶è¯æ¡\nGET :/recruit/tag/:tagName\nbody: null\né€šè¿‡è¯æ¡è·å–è¯¥è¯æ¡èƒ½å¤Ÿæ‹›å‹Ÿåˆ°çš„å¹²å‘˜ï¼Œè¯æ¡åä¸ºç©ºåˆ™è¿”å›æ‰€æœ‰è¯æ¡åŠå…¶å¯æ‹›å‹Ÿå¹²å‘˜\n:/infoGET :/info/operator/:operatorName\nbody: null\né€šè¿‡å¹²å‘˜åç§°è·å–å¹²å‘˜ä¿¡æ¯ï¼Œå¹²å‘˜åç§°ä¸ºç©ºåˆ™è¿”å›å¹²å‘˜åˆ—è¡¨\nGET :/info/material/:materialName\nbody: null\né€šè¿‡ææ–™åç§°è·å–ææ–™ä¿¡æ¯ï¼Œææ–™åç§°ä¸ºç©ºåˆ™è¿”å›ææ–™åˆ—è¡¨\n:/gachaGET :/gacha/:tableName?count=${count}\nbody: application/jsonï¼ŒæŠ½å¡è€…çš„ä¿¡æ¯\nå¯¹tableNameæ± è¿›è¡Œcountæ¬¡æŠ½å¡ï¼Œcountä¸ºç©ºåˆ™é»˜è®¤åè¿ï¼ŒtableNameä¸ºç©ºåˆ™è¿”å›å¡æ± åˆ—è¡¨ï¼ŒtableNameä¸ºupåˆ™å¯¹æœ€æ–°upæ± è¿›è¡ŒæŠ½å¡\nGET :/gacha/:uid/statisitc?from=${date}\nbody: application/jsonï¼ŒæŠ½å¡è€…çš„ä¿¡æ¯\næ ¹æ®uidè·å–ç”¨æˆ·ä»dateè‡³ä»Šçš„æŠ½å¡è®°å½•ï¼Œfromä¸ºç©ºåˆ™è¿”å›æœ€è¿‘ä¸€ç™¾æ¡æŠ½å¡è®°å½•ï¼Œuidä¸ºç©ºåˆ™è¿”å›401\n:/manageGET: :/manage/:commandName\nbody: application/jsonï¼Œç®¡ç†è€…ä¿¡æ¯\nå¯¹ArknightsPluginè¿›è¡Œç®¡ç†ï¼Œæ‰§è¡ŒcommandNameå¯¹åº”çš„æ“ä½œï¼ŒcommandNameä¸ºç©ºåˆ™è¿”å›å‘½ä»¤åˆ—è¡¨ï¼Œç”¨æˆ·é‰´æƒä¸é€šè¿‡åˆ™è¿”å›403\n1.4 ç»„ä»¶é€‰ç”¨APIæ¡†æ¶APIæ¡†æ¶é€‰ç”¨è€ç‰Œçš„go-ginï¼Œæ€§èƒ½å¼ºåŠ²ä¸Šæ‰‹ç®€å•\næ•°æ®åº“ç”±äºArknightsPluginçš„æ•°æ®é‡å¾ˆå°ï¼Œåªæœ‰ç™¾æ¥ä¸ªå¹²å‘˜å’Œç™¾æ¥ç§ææ–™ï¼Œå…¨æ”¾å†…å­˜ä¹Ÿå°±å‡ MiBï¼Œå¹¶ä¸”ä¹Ÿæ˜¯åªè¯»æ•°æ®ã€‚æ‰€ä»¥é€‰ç”¨jsonæ–‡ä»¶ä½œä¸ºæ•°æ®å­˜å‚¨æ ¼å¼ï¼Œåœ¨æ’ä»¶å¯åŠ¨æ—¶å°†æ‰€æœ‰çš„æ•°æ®è¯»å…¥å†…å­˜ï¼Œè‹¥åæœŸæ•°æ®é‡æ‰©å¤§ï¼Œå¯æ¢ç”¨sqliteï¼Œæ¨¡æ‹ŸæŠ½å¡è®°å½•ä¹Ÿæ²¡ä»€ä¹ˆä¸šåŠ¡ä»·å€¼ä¸¢äº†å°±ä¸¢äº†ï¼Œæ‰€ä»¥é€‰ç”¨go-cacheåœ¨å†…å­˜é‡Œé€ ï¼Œä¸æ±¡æŸ“å†…å­˜å°±å¯ä»¥äº†ï¼Œè‹¥ç”¨æˆ·é‡å¤§äº†ï¼Œéœ€è¦æŒä¹…åŒ–ï¼Œåˆ™åˆ†å—å†™csvæˆ–jsonæ¥ä¿å­˜\nåˆ†å¸ƒå¼è¿™ä¹ˆå°ä¸ªæ’ä»¶(ç¬‘)ä¸Šä»€ä¹ˆåˆ†å¸ƒå¼\n1.5 å‡çº§è§„åˆ’\nå½“CeobeBotåŠŸèƒ½é€æ­¥æ‰©å¼ ï¼Œé‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„æ—¶ï¼Œå°†æœ¬æ’ä»¶ä»¥å¾®æœåŠ¡æ–¹å¼æ·»åŠ åˆ°CeobeBot\nå½“ç”¨æˆ·è§„æ¨¡æˆ–æ•°æ®è§„æ¨¡å¤§é‡å¢åŠ æ—¶ï¼Œé‡‡ç”¨æ•°æ®åº“æˆ–redisç­‰ç»„ä»¶ä»¥ç»´æŠ¤ç¨‹åºè¿è¡Œæ—¶æ•°æ®\nä½¿ç”¨rpcæ›¿ä»£httpä»¥æé«˜è°ƒç”¨æ•ˆç‡\nä½¿ç”¨GraphQLæˆ–neo4jç­‰æ„å»ºæ›´å¤§è§„æ¨¡çš„æ˜æ—¥æ–¹èˆŸæ•°æ®é›†ï¼Œå°†å¹²å‘˜å…³ç³»ã€å‰§æƒ…ç­‰è”ç³»èµ·æ¥\n\n2. å‡†å¤‡å·¥ä½œ2.1 è·å–Arknightsçš„æ¸¸æˆæ•°æ®\n\n\n\n\n\n\n\n\næœ¬æ–‡æ‰€ä½¿ç”¨çš„æ–¹æ³•ç›®çš„å‡ä¸ºæ¢è®¨å­¦ä¹ å…ˆè¿›æŠ€æœ¯ï¼Œä¸ä½œå®ƒç”¨\nå»GitHubä¸Šå¯»æ‰¾ArknightsGameDataç›¸å…³ä»“åº“ï¼Œå¹¶åˆ†æå…¶æ•°æ®ç»“æ„ã€‚å°†å…¶ååºåˆ—åŒ–å¹¶ç»„åˆåˆ°ArknightsPluginå†…ç½®çš„æ¨¡å‹ä¸­ï¼Œç”±äºç±³å¨œæ¡‘è·å–çš„GameDataç»“æ„å¯èƒ½ä¸ä¸€æ ·ï¼Œæ­¤å¤„å°±ä¸å…¬å¼€ååºåˆ—åŒ–ä»£ç äº†\nä¹Ÿå¯ä»¥è‡ªå·±åˆ°prts.wikiæˆ–wiki.biligame.comè‡ªå·±çˆ¬å–\n2.2 è®¾è®¡Arknightsç›¸å…³å®ä½“çš„æ•°æ®æ¨¡å‹Operatorä¸‹é¢æ˜¯ArknightsPluginåœ¨æœ€åˆè®¾è®¡æ—¶çš„Operatorï¼š\npackage module\n\n// Operator Arknightså¹²å‘˜\ntype Operator struct {\n\tName            string                      `json:\"name\"`            // å¹²å‘˜å§“å\n\tStar            int                         `json:\"star\"`            // å¹²å‘˜æ˜Ÿçº§\n\tType            string                      `json:\"type\"`            // å¹²å‘˜ç±»å‹(èŒä¸š)\n\tRedeploy        int                         `json:\"redeploy\"`        // å¹²å‘˜å†éƒ¨ç½²æ—¶é—´\n\tCost            int                         `json:\"cost\"`            // å¹²å‘˜éƒ¨ç½²è´¹ç”¨\n\tBlock           int                         `json:\"block\"`           // å¹²å‘˜é˜»æŒ¡æ•°\n\tAttackInterval  float64                     `json:\"attack_interval\"` // å¹²å‘˜æ”»å‡»é—´éš”\n\tTrustFix        string                      `json:\"trust_fix\"`       // å¹²å‘˜ä¿¡ä»»ä¿®æ­£\n\tProperties      Property                    `json:\"properties\"`      // å¹²å‘˜åŸºç¡€å±æ€§\n\tFlightSkills    []FlightSkill               `json:\"flight_skills\"`   // å¹²å‘˜æˆ˜æ–—æŠ€èƒ½\n\tLogisticsSkills []LogisticsSkill            `json:\"logisticsSkills\"` // å¹²å‘˜åå‹¤æŠ€èƒ½\n\tTalents         []Talent                    `json:\"talents\"`         // å¹²å‘˜å¤©èµ‹\n\tPotentials      []Potential                 `json:\"potentials\"`      // å¹²å‘˜æ½œèƒ½\n\tMods            []Mod                       `json:\"mods\"`            // å¹²å‘˜æ¨¡ç»„\n\tMaterials       map[string][]MaterialDemand `json:\"materials\"`       // å¹²å‘˜ææ–™éœ€æ±‚\n\tTags            []string                    `json:\"tags\"`            // å¹²å‘˜å…¬æ‹›Tagæ•°ç»„\n}\n\n// Property å¹²å‘˜åŸºç¡€å±æ€§\ntype Property struct {\n\tHealth       int                      `json:\"health\"`        // ç”Ÿå‘½å€¼\n\tAttack       int                      `json:\"attack\"`        // æ”»å‡»åŠ›\n\tDefence      int                      `json:\"defence\"`       // é˜²å¾¡åŠ›\n\tMagicDefence int                      `json:\"magic_defence\"` // é­”æ³•é˜²å¾¡åŠ›\n\tcalculator   func(level int) Property // å±æ€§è®¡ç®—å™¨\n}\n\n// FlightSkill å¹²å‘˜æˆ˜æ–—æŠ€èƒ½\ntype FlightSkill struct {\n\tName            string   `json:\"name\"`             // æŠ€èƒ½åç§°\n\tIconAddress     string   `json:\"icon_address\"`     // æŠ€èƒ½iconåœ°å€\n\tType            string   `json:\"type\"`             // æŠ€èƒ½ç±»å‹\n\tTriggerType     string   `json:\"trigger_type\"`     // æŠ€èƒ½è§¦å‘ç±»å‹\n\tContinuanceType string   `json:\"continuance_type\"` // æŠ€èƒ½è€ä¹…ç±»å‹\n\tDescription     []string `json:\"description\"`      // æŠ€èƒ½æ•°å€¼\n\tSPStart         []int    `json:\"sp_start\"`         // æŠ€èƒ½åˆå§‹æåŠ›\n\tSPCost          []int    `json:\"sp_cost\"`          // æŠ€èƒ½SPæ¶ˆè€—\n\tContinuance     []int    `json:\"continuance\"`      // æŠ€èƒ½è€ä¹…\n}\n\n// LogisticsSkill å¹²å‘˜åå‹¤æŠ€èƒ½\ntype LogisticsSkill struct {\n\tName        string `json:\"name\"`         // æŠ€èƒ½åç§°\n\tIconAddress string `json:\"icon_address\"` // æŠ€èƒ½iconåœ°å€\n\tUnlockRank  int    `json:\"unlock_rank\"`  // è§£é”æ¡ä»¶\n\tType        string `json:\"type\"`         // æŠ€èƒ½ç±»å‹\n\tDestination string `json:\"destination\"`  // ç”Ÿæ•ˆåœ°ç‚¹\n\tDescription string `json:\"description\"`  // æŠ€èƒ½æè¿°\n}\n\n// Talent å¹²å‘˜å¤©èµ‹\ntype Talent struct {\n\tIndex       int    `json:\"index\"`       // å¤©èµ‹åºå·\n\tName        string `json:\"name\"`        // å¤©èµ‹åç§°\n\tRank        int    `json:\"rank\"`        // æ‰€éœ€ç­‰é˜¶\n\tPotential   int    `json:\"potential\"`   // æ‰€éœ€æ½œèƒ½\n\tDescription string `json:\"description\"` // å¤©èµ‹æè¿°\n}\n\n// Potential å¹²å‘˜æ½œèƒ½\ntype Potential struct {\n\tIndex       int    `json:\"index\"`       // æ½œèƒ½æ•°\n\tDescription string `json:\"description\"` // æ½œèƒ½æ•ˆæœ\n}\n\n// Mod å¹²å‘˜æ¨¡ç»„\ntype Mod struct {\n\tName        string `json:\"name\"`         // æ¨¡ç»„ç±»å‹\n\tPropertyFix string `json:\"property_fix\"` // æ•°å€¼ä¿®æ­£\n\tTalentFix   string `json:\"talent_fix\"`   // å¤©èµ‹ä¿®æ­£\n}\n\n// MaterialDemand ææ–™éœ€æ±‚\ntype MaterialDemand struct {\n\tName  string `json:\"name\"`  // éœ€æ±‚ææ–™\n\tCount int    `json:\"count\"` // éœ€æ±‚æ•°é‡\n}\n\nMaterialä¸‹é¢æ˜¯ArknightsPluginåœ¨æœ€åˆè®¾è®¡æ—¶çš„Moduleï¼š\npackage module\n\n// Material ArknightsåŸ¹å…»ææ–™\ntype Material struct {\n\tName               string   `json:\"name\"`                // ææ–™åç§°\n\tRank               int      `json:\"rank\"`                // ææ–™ç­‰çº§\n\tDescription        string   `json:\"description\"`         // ææ–™æè¿°\n\tObtainMission      []string `json:\"obtain_mission\"`      // ææ–™è·å–å…³å¡\n\tSyntheticMaterials []string `json:\"synthetic_materials\"` // ææ–™åˆæˆç´ æ\n}\n\n2.3 è®¾è®¡Syncerçš„å®šæœŸåŒæ­¥æµç¨‹\nåœ¨GiteaMirrorä¸€ä»½GameDataä»“åº“ï¼ŒæŠŠå®šæœŸcronçš„æ“ä½œäº¤ç»™Giteaæ‰§è¡Œ\nåœ¨Mirrorä»“åº“é…ç½®webhookï¼Œæ¯è§¦å‘ä¸€æ¬¡Pushï¼Œåˆ™å‘CeobeBotå‘é€ä¿¡æ¯\nä½¿ç”¨CeoebBotè°ƒç”¨ArknightsPluginçš„Sync()æ–¹æ³•\n\n3. å…·ä½“å®ç°\n\n\n\n\n\n\n\n\nç”±äºCRUDçš„è¿‡ç¨‹æ¯”è¾ƒæ— èŠï¼Œç±³å¨œæ¡‘éƒ½æ²¡é—®é¢˜ï¼Œå°±åªè®²é‡ç‚¹äº†\n3.1 æ¨¡æ‹Ÿå…¬æ‹›çš„è¯æ¡ç»„åˆæ¨¡æ‹Ÿå…¬æ‹›æ—¶ï¼Œä»¥æä¾›äº”ä¸ªè¯æ¡ä¸ºä¾‹ï¼Œéœ€è¦å°†äº”ä¸ªè¯æ¡çš„æ‰€æœ‰ä¸€è¯æ¡ã€äºŒè¯æ¡ã€ä¸‰è¯æ¡ç»„åˆéƒ½åˆ—å‡ºï¼Œå¹¶é€ä¸€åœ¨å…¬æ‹›è§„åˆ™ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œç°åœ¨éœ€è¦è®¡ç®—éœ€è¦æŸ¥è¯¢çš„è¯æ¡ç»„åˆ\næœ€ç®€å•çš„åŠæ³•è‡ªç„¶æ˜¯æš´åŠ›ï¼Œè·å–è¯æ¡ç»„åˆè¿™ä¸ªé—®é¢˜å¯ç­‰ä»·äºå¯¹ä¸€ä¸ªé›†åˆ\n\nè¿›è¡Œæ¬¡ç¬›å¡å°”ç§¯ï¼Œå°†æ‰€æœ‰ç»“æœæ’åºåå»é‡ï¼Œå¾—åˆ°çš„ç»“æœå³ä¸ºæ‰€æ±‚ç»“æœ\n\n\n\n\n\n\n\n\n\nä½†æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•æ•ˆç‡å¥‡å·®ï¼Œä¸ç®—æ’åºå’Œå»é‡ï¼Œå…‰æ˜¯ç¬›å¡å°”ç§¯å°±éœ€è¦è®¡ç®—æ¬¡ï¼Œè€Œæ­¤é—®é¢˜çš„ç›®æ ‡è¾“å‡ºè§„æ¨¡ä¸ºï¼Œæ˜¾ç„¶è¿‡äºç¦»è°±\nç„¶åè‡ªç„¶è€Œç„¶æƒ³åˆ°äº†å¯¹é›†åˆè¿›è¡Œå…¨æ’åˆ—ï¼Œç„¶åè¿›è¡Œæ’åºå»é‡ï¼Œä¸ç®—æ’åºå’Œå»é‡çš„è¯ï¼Œé€’å½’è¿›è¡Œå…¨æ’åˆ—çš„è¿ç®—æ¬¡æ•°ä¸ºæ¬¡ï¼Œæ­¤æ—¶å·²ç»ä¼˜åŒ–äº†å¾ˆå¤šäº†ï¼Œä½†è¿˜æ˜¯å¤ªç¦»è°±äº†\næœ€åå°±æƒ³åˆ°äº†å°‘æœ‰æèµ·çš„å…¨ç»„åˆï¼Œå…¨ç»„åˆå¤©ç„¶çš„ä¼˜åŠ¿æ˜¯ä¸ç”¨å»é‡å’Œæ’åºï¼Œå¹¶ä¸”å…¨ç»„åˆçš„è¿ç®—æ¬¡æ•°ä¸ºæ¬¡ï¼Œå·²ç»å’Œç›®æ ‡çš„è¾“å‡ºè§„æ¨¡å¾ˆæ¥è¿‘äº†ï¼Œæ•…é‡‡ç”¨å…¨ç»„åˆæ¥å®ç°æ­¤éœ€æ±‚\nå¯¹äºå…¨ç»„åˆï¼Œæˆ‘ä»¬åªéœ€è¦å¼€è¾Ÿä¸€ä¸ªboolæ•°ç»„è™½ç„¶æœ€åä¼˜åŒ–æ‰äº†ï¼Œé•¿åº¦ä¸é›†åˆçš„å…ƒç´ ä¸ªæ•°ç›¸åŒå³å¯ï¼ŒæŒ‰ä½å¯¹åº”ï¼Œå…¶true/falseå³ä¸ºé›†åˆå¯¹åº”å…ƒç´ æ˜¯å¦å‡ºç°åœ¨ç»“æœä¸­ï¼Œéå†å®Œæ•°ç»„çš„æ¯ä¸€ä¸ªçŠ¶æ€ï¼Œå…¨ç»„åˆä¹Ÿå°±æ±‚å®Œäº†ã€‚å…¶golangå®ç°å¦‚ä¸‹ï¼š\nfunc combination(tags []string) (result [][]string) {\n\tlength := len(tags)\n\tupperBound := 1&lt;&lt;length\n\tresult = make([][]string, upperBound-1)\n\n\tfor i := 1; i &lt; upperBound; i++ {\n\t\ttemp := \"\"\n\t\tfor j := 0; j &lt; length; j++ {\n\t\t\tif i&gt;&gt;j == 0 {\n\t\t\t\tbreak\n\t\t\t} else {\n\t\t\t\tif (i&gt;&gt;j)^1 == 1 {\n\t\t\t\t\ttemp += tags[j] + \",\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tresult[i-1] = strings.Split(strings.TrimRight(temp, \",\"), \",\")\n\t}\n\n\treturn result\n}\n\n3.2 æ¨¡æ‹ŸæŠ½å¡çš„éšæœºæ•°ç”Ÿæˆç”±äºå®Œå…¨éšæœºè¾ƒå®¹æ˜“å‡ºç°æç«¯å€¼ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒä¸€ä¸ªæ­£æ€çš„å›¾å½¢å‡ºæ¥\n\n\n\n\n\n\n\nç‰¹åˆ«æ³¨æ„\nå°è¯•è¿‡è°ƒæ¨¡å‹äº†ï¼Œäº‹å®è¯æ˜è¿™ä¸ªæ´»é€‚åˆä¸“ä¸šäººå£«å»å¹²ï¼Œæƒ³ç”¨å¤§å®¶å–œé—»ä¹è§çš„åå€å¼€æ ¹å·è¿›è¡Œä¿®æ­£ï¼Œç»“æœè°ƒå‡ºäº†æå…¶å¥‡æ€ªçš„å›¾åƒğŸ¤¦â€â™€ï¸ï¼Œæœ‰å…´è¶£çš„å‹‡å£«å¯ä»¥è‡ªå·±å»è¯•è¯•\n\nç®€å•æµ‹è¯•äº†ä¸€ä¸‹randåº“çš„éšæœºæ•°å‡½æ•°çš„ç”Ÿæˆæ•ˆç‡ï¼Œç”Ÿæˆç»„ï¼Œæ¯ç»„ä¸ªéšæœºæ•°ï¼Œæ‰€ç”¨æ—¶é—´ä¸ºåäºŒç§’(æµ‹è¯•å¹³å°ä¸ºApple M1)ï¼Œå¯¹äºæŠ½å¡è€Œè¨€æ€§èƒ½æˆ‘çŒœå¤Ÿäº†\ngachaçš„å®ç°å¦‚ä¸‹ï¼Œç²¾ç¡®åº¦ä¸ºå°æ•°ç‚¹åå…­ä½è™½ç„¶ç”¨intæ‘å†™å¥½åƒæœ‰ç‚¹æ€ªæ€ªçš„ï¼Œéœ€åœ¨å¤–éƒ¨æå‰æ‰§è¡Œrand.Seed()ï¼š\nfunc gacha(alreadyGacha, count, fourStar, fiveStar, sixStar, sixStarCorrection int) (result []int) {\n\tresult = make([]int, count)\n\tcorrectionSixStar := sixStar\n\t\n\tfor i, _ := range result {\n\t\tif alreadyGacha &gt;= 50 {\n\t\t\tcorrectionSixStar += sixStarCorrection\n\t\t}\n\n\t\tprop := rand.Int() % 1000000\n\t\talreadyGacha += 1\n\t\tif prop &lt; fourStar {\n\t\t\tresult[i] = 3\n\t\t\tcontinue\n\t\t}\n\t\tswitch {\n\t\tcase prop &gt; correctionSixStar:\n\t\t\tresult[i] = 6\n\t\t\talreadyGacha = 0\n\t\t\tcorrectionSixStar = sixStar\n\t\tcase prop &gt; fiveStar:\n\t\t\tresult[i] = 5\n\t\tdefault:\n\t\t\tresult[i] = 4\n\t\t}\n\t}\n\n\treturn result\n}\n\nä¸Šé¢çš„å®ç°æ²¡æœ‰å››æ˜Ÿä¿åº•ï¼Œè™½ç„¶å®˜æ–¹ä¹Ÿæ²¡æœ‰æ˜ç¡®è¯´åè¿ä¸€å®šå‡ºç´«ï¼Œæœ‰æ—¶é—´ä¸‹æ¬¡ä¸€å®šå†æ”¹\n3.3 æ¨¡æ‹ŸæŠ½å¡çš„æœŸæœ›è®¡ç®—æˆ‘ä»¬çŸ¥é“éšæœºäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡ä¸ºï¼Œå³æŠ½å¡å‡ºè´§çš„æ¦‚ç‡ä¸º%ï¼Œé‚£ä¹ˆçš„å¯¹ç«‹äº‹ä»¶å³æŠ½å¡ä¸å‡ºè´§çš„æ¦‚ç‡ä¸º%%ï¼Œåˆ™è¿ç»­ä¸¤æ¬¡æŠ½å¡ä¸å‡ºè´§çš„æ¦‚ç‡ä¸º%ï¼Œä»¥æ­¤ç±»æ¨ï¼Œäº”åæŠ½ä»¥å†…ï¼Œå‰æ¬¡æŠ½å¡éƒ½ä¸å‡ºè´§çš„æ¦‚ç‡\nä½†æ˜¯å½“æŠ½å¡æ¬¡æ•°è¾¾åˆ°æŠ½ä»¥ä¸Šæ—¶ï¼Œå°†ä¼šè§¦å‘æ¦‚ç‡è¡¥æ­£ï¼Œå³å¢åŠ %çš„é¢å¤–æ¦‚ç‡ï¼Œäº”åæŠ½ä»¥åï¼Œå†æŠ½ä¸€å‘è¿˜ä¸å‡ºè´§çš„æ¦‚ç‡ä¸ºï¼Œå…¶ä¸­ä¸ºè¯¥æŠ½å‰ä¸å‡ºè´§çš„æ¦‚ç‡ï¼Œ%ï¼Œä¸ºå·²ç»æŠ½å¡æ¬¡æ•°\né‚£ä¹ˆè¿ç»­æŠ½æ¬¡éƒ½ä¸å‡ºè´§çš„æ¦‚ç‡è¡¨è¾¾å¼å¦‚ä¸‹ï¼š\n\né‚£ä¹ˆï¼Œè¿ç»­æŠ½æ¬¡è‡³å°‘å‡ºä¸€å¼ å…­æ˜Ÿçš„æ¦‚ç‡ï¼Œæˆ‘ä»¬å‡å®šå½“è‡³å°‘å‡ºä¸€å¼ å…­æ˜Ÿçš„æ¦‚ç‡å¤§äº%æ—¶ï¼Œä¸‹ä¸€æŠ½å¿…å‡ºè´§\né¡¶ç€float64æº¢å‡ºçš„è¾¹ç¼˜è®¡ç®—ï¼Œå¾—åˆ°ç»“æœï¼šå½“æŠ½å¡æ¬¡ä»æ²¡å‡ºè´§æ—¶ï¼Œä¸‹ä¸€æŠ½çš„å‡ºè´§çš„æ¦‚ç‡è‡³å°‘ä¸º%ï¼Œå¥½æƒ³å»é—®å€™é¹°è§’ä¸ºä»€ä¹ˆæˆ‘å››äº”æ¬¡åˆ°äº†70~77æŠ½æ‰å‡ºè´§\nè‡³äºé‚£ä¸ªç½‘ä¸Šæµä¼ å·²ä¹…çš„æœŸæœ›æŠ½æ˜¯æ€ä¹ˆæ¥çš„ï¼Œå¯ä»¥å‚è€ƒè¿™é‡ŒçŸ¥ä¹ - ä»æ˜æ—¥æ–¹èˆŸæŠ½å¡æœºåˆ¶å¼€å§‹çš„äº›å¾®æ¢ç´¢ï¼Œæˆ‘åªèƒ½è¯´æˆ‘ç­‰éé…‹æ°¸è¿œæ˜¯è¢«å¹³å‡çš„\nä¸Šé¢è¿™ä¸ªå®ç°å¤ªç®€å•äº†å°±ç•¥\n\n\n\n\n\n\n\n\n\n\nå…ˆè¿™ä¹ˆå¤šï¼Œå…¶ä»–çš„æƒ³åˆ°å†å†™\n","slug":"CeobeBot-ArknightsPlugin","date":"2022-04-01T08:52:36.000Z","categories_index":"blog","tags_index":"Backend,Golang,CeobeBot,Arknights","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"f8e8d6bc4eb4a88923ac2738fbdf0bbf","title":"æµ…è®°sync.WaitGroupä½¿ç”¨æ—¶çš„ä¸€äº›é”™è¯¯","content":"\n\n\n\n\n\n\n\n\næ­¤å¤„æ‰€ä½¿ç”¨çš„ä»£ç å‡ä¸ºæ¼”ç¤ºå‡ºç°çš„é”™è¯¯\n1. sync.WaitGroupä¼ é€’æ–¹å¼ä¸å½“å¯¼è‡´negative counteré”™è¯¯ä»£ç package main\n\nimport (\n\t\"sync\"\n\t\"time\"\n)\n\nfunc main() {\n\tch := make(chan struct{}, 10)\n\twg := sync.WaitGroup{}\n\tgo Println(ch, wg)\n\tgo Insert(100, ch, wg)\n\twg.Wait()\n}\n\nfunc Println(ch chan struct{}, wg sync.WaitGroup) {\n\tindex := 1\n\tfor {\n\t\tselect {\n\t\tcase &lt;-ch:\n\t\t\tprintln(index)\n\t\t\tindex++\n\t\t\twg.Done()\n\t\tdefault:\n\t\t\tprintln(\"wait for printing...\")\n\t\t\ttime.Sleep(time.Millisecond)\n\t\t}\n\t}\n}\n\nfunc Insert(times int, ch chan struct{}, wg sync.WaitGroup) {\n\tfor i := 0; i &lt; times; {\n\t\tselect {\n\t\tcase ch &lt;- struct{}{}:\n\t\t\ti++\n\t\t\twg.Add(1)\n\t\tdefault:\n\t\t\tprintln(\"wait for inserting...\")\n\t\t\ttime.Sleep(time.Millisecond)\n\t\t}\n\t}\n}\n\næŠ¥é”™ä¿¡æ¯panic: sync: negative WaitGroup counter\n\ngoroutine 3 [running]:\nsync.(*WaitGroup).Add(0x1400009a000, 0xffffffffffffffff)\n        /opt/homebrew/Cellar/go/1.17.8/libexec/src/sync/waitgroup.go:74 +0x14c\nsync.(*WaitGroup).Done(...)\n        /opt/homebrew/Cellar/go/1.17.8/libexec/src/sync/waitgroup.go:99\nmain.Println(0x140000160c0, {{}, {0x0, 0x1, 0x0}})\n        $ProjectPath/main.go:24 +0x94\ncreated by main.main\n        $ProjectPath/main.go:12 +0x98\n\nProcess finished with the exit code 2\n\né”™è¯¯åŸå› æŸ¥è¯¢äº†ä¸€ä¸‹èµ„æ–™å^1ï¼Œå‘ç°æ­¤é”™è¯¯çš„åŸå› æ˜¯sync.WaitGroupåœ¨å‚æ•°ä¼ é€’æ—¶åº”è¯¥ä½¿ç”¨æŒ‡é’ˆä¼ é€’åœ°å€ï¼Œå¦‚æœç›´æ¥ä¼ å€¼åˆ™ä¼šå‘ç”Ÿæ‹·è´ï¼Œæ­¤æ—¶ä¼ å…¥çš„WaitGroupå¹¶ä¸ä¼šè¢«å¦ä¸€ä¸ªgoç¨‹ä¿®æ”¹\næ­¤å¤„ä¹Ÿè§¦å‘äº†ä¸€ä¸ªå•¸å•¸çš„çŸ¥è¯†ç›²åŒºï¼Œå› ä¸ºä¸€å‰ç”¨sliceå’Œinterfaceçš„æ—¶å€™ç‰¹åˆ«é¡ºæ‰‹ï¼Œå…¶ä¼ é€’å®é™…ä¸Šä¼ é€’çš„æ˜¯å…±äº«çš„æŒ‡é’ˆï¼Œä»”ç»†æŸ¥é˜…äº†^1ä»¥åæ‰å‘ç°ï¼Œgoå‚æ•°ä¼ å€¼æ˜¯ä¼ é€’çš„æ‹·è´ï¼Œä½†æ˜¯å› ä¸ºä¸Šé¢é‚£äº›ç»“æ„å®é™…ä¸Šæœ‰æŒ‡å‘å®é™…ä½ç½®çš„æŒ‡é’ˆï¼Œå¯¼è‡´è™½ç„¶ä¼ é€’çš„æ˜¯æ‹·è´ï¼Œä½†æ˜¯è¿˜æ˜¯èƒ½å¯¹åŸå‚æ•°è¿›è¡Œä¿®æ”¹ï¼Œä»¥ååœ¨ç¼–ç¨‹æ—¶éœ€è¦ç•™å¿ƒè¿™ä¸€ç‚¹é¿å…é€ æˆå†…å­˜æ³„æ¼ã€‚\næ­¤å¤„ä¹ŸæŒ‚ä¸€ä¸‹å¼•ç”³çš„é˜…è¯»èµ„æ–™ï¼š Goå‡½æ•°å‚æ•°ä¼ é€’^2\né”™è¯¯æ›´æ­£åªéœ€ä¿®æ”¹Printlnå’ŒInsertä¸¤ä¸ªå‡½æ•°å‚æ•°å³å¯\n// ... code before\n\nfunc main() {\n    ch := make(chan struct{}, 10)\n    wg := &amp;sync.WaitGroup{}\n\tgo Println(ch, wg)\n\tgo Insert(100, ch, wg)\n\twg.Wait()\n}\n\nfunc Println(ch chan struct{}, wg *sync.WaitGroup) {\n    // ...implements\n}\n\nfunc Insert(times int, ch chan struct{}, wg sync.WaitGroup) {\n    // ...implements\n}\n\n2. sync.WaitGroupåœ¨goç¨‹å†…æ“ä½œä¸å½“å¯¼è‡´æœªèƒ½é˜»å¡ä½ä¸»è¿›ç¨‹é”™è¯¯ä»£ç package main\n\nimport (\n\t\"sync\"\n\t\"time\"\n)\n\nfunc main() {\n\tch := make(chan struct{}, 10)\n\twg := sync.WaitGroup{}\n\twg.Add(1)\n\tgo Println(ch, wg)\n\tgo Insert(100, ch, wg)\n\twg.Wait()\n}\n\nfunc Println(ch chan struct{}, wg sync.WaitGroup) {\n\tindex := 1\n\tfor {\n\t\tselect {\n\t\tcase &lt;-ch:\n\t\t\tprintln(index)\n\t\t\tindex++\n\t\t\twg.Done()\n\t\tdefault:\n\t\t\tprintln(\"wait for printing...\")\n\t\t\ttime.Sleep(time.Millisecond)\n\t\t}\n\t}\n}\n\nfunc Insert(times int, ch chan struct{}, wg sync.WaitGroup) {\n\tfor i := 0; i &lt; times; {\n\t\tselect {\n\t\tcase ch &lt;- struct{}{}:\n\t\t\ti++\n\t\t\twg.Add(1)\n\t\tdefault:\n\t\t\tprintln(\"wait for inserting...\")\n\t\t\ttime.Sleep(time.Millisecond)\n\t\t}\n\t}\n}\n\næŠ¥é”™ä¿¡æ¯æ— æŠ¥é”™ä¿¡æ¯ï¼Œä½†æ˜¯ç¨‹åºä¼šæå‰é€€å‡º\né”™è¯¯åŸå› åœ¨Insertå‡½æ•°ä¸­ï¼ŒæˆåŠŸå¾€chanelå†…å†™å…¥äº†ä¸€ä¸ªä¿¡å·ï¼Œä¾¿ä¼šè§¦å‘ä¸€æ¬¡WaitGroup.Add()ï¼Œä½†æ˜¯åŒæ—¶ï¼Œåœ¨Printlnå‡½æ•°ä¸­ï¼ŒæˆåŠŸæ‰“å°äº†ä¸€ä¸ªæ•°å­—ï¼Œä¹Ÿä¼šè§¦å‘ä¸€æ¬¡WaitGroup.Done()ï¼Œæœ‰å¯èƒ½å‡ºç°Insertå†™å…¥æ¬¡æ•°ä¸Printlnæ‰“å°æ¬¡æ•°ç›¸ç­‰çš„æ—¶å€™ï¼Œæ­¤æ—¶WaitGroupçš„è®¡æ•°å™¨ä¸º0ï¼Œmainä¸­çš„WaitGroup.Wait()ä¾¿ä¸ä¼šé˜»å¡ç¨‹åºï¼Œå¯¼è‡´ç¨‹åºæ„å¤–ç»“æŸè¿è¡Œï¼Œè€Œä¸¤ä¸ªgoç¨‹æ²¡æœ‰è¾¾åˆ°é¢„æœŸçš„ä½œä¸šæ•ˆæœ\né”™è¯¯æ›´æ­£éœ€è¦å°†ç”Ÿäº§è€…Insertçš„æ“ä½œä¹Ÿå½“ä½œä¸€æ¬¡ä½œä¸šå®Œæˆï¼Œå¹¶ä¸”åœ¨WaitGroupè¢«åˆ›å»ºæ—¶ï¼Œä¹Ÿéœ€è¦å°†è®¡æ•°å™¨+1ç›´åˆ°ç”Ÿäº§è€…å°†æ€»ä½œä¸šæ•°è®¾ç½®å®Œæ¯•ï¼Œä»¥é˜²ç”Ÿäº§è€…Insertå‡½æ•°å’Œæ¶ˆè´¹è€…Printlnå‡½æ•°éƒ½æœªæ­£å¼æ‰§è¡Œæ—¶ï¼Œmainå‡½æ•°æ‰§è¡Œåˆ°äº†WaitGroup.Wait()ï¼Œæ­¤æ—¶è®¡æ•°å™¨ä¾æ—§ä¸º0ï¼Œç¨‹åºä¾ç„¶ä¼šæ„å¤–é€€å‡º\n// ... code before\n\nfunc main() {\n    ch := make(chan struct{}, 10)\n    wg := &amp;sync.WaitGroup{}\n    wg.Add(1)\n\tgo Println(ch, wg)\n\tgo Insert(100, ch, wg)\n\twg.Wait()\n}\n\nfunc Insert(times int, ch chan struct{}, wg *sync.WaitGroup) {\n    wg.Add(2*times)\n    wg.Done()\n    for i := 0; i &lt; times; {\n\t\tselect {\n\t\tcase ch &lt;- struct{}{}:\n\t\t\ti++\n\t\t\twg.Done()\n\t\tdefault:\n\t\t\tprintln(\"wait for inserting...\")\n\t\t\ttime.Sleep(time.Millisecond)\n\t\t}\n\t}\n}\n\n// ... code after\n\nå¼•ç”¨æ–‡ç« \nä½ çœŸçš„ä¼šç”¨sync.WaitGroupå— - gnehsbc\nGoå‡½æ•°å‚æ•°ä¼ é€’ - å¯Œå£«åº·è´¨æ£€å‘˜å¼ å…¨è›‹\n\n\n\n","slug":"WaitGroup-Blog","date":"2022-02-17T08:15:59.000Z","categories_index":"blog","tags_index":"Golang,Concurrency,sync.WaitGroup","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"b8d46bdb901a3fa647b17fec08a37916","title":"é£ä¹¦å°ç¨‹åºåŒæ­¥è¯¾è¡¨ä¸æ—¥å†","content":"\n\n\n\n\n\n\n\n\né£ä¹¦æ›´æ–°äº†APIï¼Œç¨‹åºç›®å‰æ— æ³•è¿è¡Œï¼Œå°šåœ¨FIX\n1. å‡†å¤‡å·¥ä½œ1.1 åˆ›å»ºé£ä¹¦å°ç¨‹åºç•¥\n1.2 ç»™æœºå™¨äººæ·»åŠ ç›¸åº”æƒé™ç•¥\n1.3 åˆ†æè¯¾è¡¨ç»“æ„è¥¿å—å¤§å­¦æ•™åŠ¡ç³»ç»Ÿè¿”å›çš„è¯¾è¡¨å¯ä»¥åœ¨å¼€å‘è€…å·¥å…·ä¸­çœ‹åˆ°å…·ä½“æ•°æ®ï¼Œæ˜¯jsonæ ¼å¼çš„ä¸€ä¸ªæ–‡ä»¶ã€‚\n\n\n\n\n\n\n\n\n\nç”±äºè¥¿å—å¤§å­¦æ•™åŠ¡ç³»ç»Ÿçš„é‰´æƒæµç¨‹è¿‡äºé˜´é—´ï¼Œæˆ‘ä»¬è‡³ä»Šæœªèƒ½çŸ¥é“å®ƒåˆ°åº•ç”¨çš„æ˜¯cookieè¿˜æ˜¯JWTè¿˜æ˜¯OAuthï¼ŒæŠ‘æˆ–æ˜¯æ˜¯ä¸­çš„ä¸€ç§ï¼Œå› ä¸ºè¿™äº›æ•°æ®ä»–éƒ½ä¼ è¾“è¿‡ï¼Œæ‰€ä»¥è¯¾è¡¨æ•°æ®ç›´æ¥ä½¿ç”¨è¿™ä¸ªjsonæ–‡ä»¶ï¼Œä¸ç®¡ç™»é™†æµç¨‹ã€‚\nç„¶åæˆ‘ä»¬å¯¹ç…§å„ç§å¥‡æ€ªçš„å‘½åæ–¹å¼ï¼Œåˆ†æå‡ºäº†æˆ‘ä»¬éœ€è¦çš„ç»“æ„ï¼š\n// Response å“åº”ä½“çš„ç»“æ„\ntype Response struct {\n\tStudentInfo struct {\n\t\tStudentClass  string `json:\"BJMC\"` // å­¦ç”Ÿç­çº§ | ç­çº§åç§°\n\t\tStudentName   string `json:\"XM\"`   // å­¦ç”Ÿå§“å | å§“å\n\t\tStudentNumber string `json:\"XH\"`   // å­¦ç”Ÿå­¦å· | å­¦å·\n\t} `json:\"xsxx\"`                     // å­¦ç”Ÿä¿¡æ¯\n\tLessonList []Lesson `json:\"kbList\"` // è¯¾ç¨‹åˆ—è¡¨\n}\n\n// è¯¾ç¨‹ä¿¡æ¯çš„ç»“æ„\ntype Lesson struct {\n\tLessonName         string `json:\"kcmc\" example:\"è®¡ç®—æœºç½‘ç»œ\"`  // è¯¾ç¨‹åç§°\n\tLessonType         string `json:\"kclb\" example:\"å­¦ç§‘åŸºç¡€è¯¾ç¨‹\"` // è¯¾ç¨‹ç±»åˆ«\n\tLessonProperty     string `json:\"kcxz\" example:\"å­¦å¿…\"`     // è¯¾ç¨‹æ€§è´¨\n\tLessonScore        string `json:\"xf\" example:\"3.5\"`      // è¯¾ç¨‹å­¦åˆ† | å­¦åˆ†\n\tLessonTeacher      string `json:\"xm\" example:\"ä¸åå³°\"`      // æˆè¯¾æ•™å¸ˆ | å§“å\n\tLessonClassroom    string `json:\"cdmc\" example:\"è£æ˜Œ9302\"` // ä¸Šè¯¾åœ°ç‚¹ | åœºåœ°åç§°\n\tLessonIsExperiment string `json:\"xslxbj\" example:\"â—†\"`    // æ˜¯å¦æ˜¯å®éªŒè¯¾ | æ˜¾ç¤ºç±»å‹æ ‡è®°\n\tLessonStartEndTime string `json:\"jcor\" example:\"1-2\"`    // è¯¾ç¨‹èµ·æ­¢æ—¶é—´\n\tLessonStartEndDate string `json:\"zcd\" example:\"1-12å‘¨\"`   // è¯¾ç¨‹èµ·æ­¢æ—¥æœŸ\n\tLessonWeekday      string `json:\"xqj\" example:\"2\"`       // è¯¾ç¨‹æ—¥æœŸ | æ˜ŸæœŸå‡ \n\tLessonTeacherTitle string `json:\"zcmc\" example:\"è®²å¸ˆï¼ˆé«˜æ ¡ï¼‰\"` // æˆè¯¾æ•™å¸ˆèŒç§° | èŒç§°åç§°\n}\n\næˆ‘ä»¬åªéœ€è¦å°†jsonæ•°æ®ååºåˆ—åŒ–åˆ°è¿™ä¸ªç»“æ„ä½“ä¸­ï¼Œå°±å¯ä»¥æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œäº†ã€‚\n1.4 è®¡ç®—æ—¥ç¨‹æ—¶é—´ç”±äºæ•™åŠ¡ç³»ç»Ÿè¿”å›çš„æ—¶é—´ä¸ºç¬¬å‡ èŠ‚è¯¾ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å°†ç¬¬å‡ èŠ‚è¯¾è½¬æ¢ä¸ºå…·ä½“æ—¶é—´ï¼Œæ–¹ä¾¿ä»¥RFCæ ‡å‡†å‘é€åˆ°é£ä¹¦åç«¯ã€‚\n\n\n\n\n\n\n\n\n\næ­¤å¤„ç”±äºè¥¿å—å¤§å­¦æ•™åŠ¡å¤„æœ€è¿‘è°ƒæ•´äº†æ¯èŠ‚è¯¾çš„ä¸Šä¸‹è¯¾æ—¶é—´ï¼Œæ­¤å¤„ä»£ç æ— å‚è€ƒæ„ä¹‰ã€‚è€Œä¸”æ­¤å¤„ä¸åº”è¯¥ä½¿ç”¨ç¡¬ç¼–ç ã€‚\n// CalculateTimeMap å°†æ—¶åˆ†ä¿¡æ¯è½¬æ¢ä¸ºéœ€è¦çš„æ•´å‹\nfunc CalculateTimeMap(hour, minute int) int {\n\treturn (hour-8)*60+minute\n}\n\nfunc CalculateDateStartEnd(l Lesson) (starts, ends time.Time, ending int) {\n\tDateStartEnd := strings.Split(strings.Replace(l.LessonStartEndDate, \"å‘¨\", \"\", -1), \"-\")\n\tTimeStartEnd := strings.Split(l.LessonStartEndTime, \"-\")\n\tLessonTipsStart := []int{\n\t\tCalculateTimeMap(8, 0),\n\t\tCalculateTimeMap(8, 55),\n\t\tCalculateTimeMap(10, 0),\n\t\tCalculateTimeMap(10, 55),\n\t\tCalculateTimeMap(12, 10),\n\t\tCalculateTimeMap(13, 5),\n\t\tCalculateTimeMap(14, 0),\n\t\tCalculateTimeMap(14, 55),\n\t\tCalculateTimeMap(15, 50),\n\t\tCalculateTimeMap(16, 55),\n\t\tCalculateTimeMap(17, 50),\n\t\tCalculateTimeMap(19, 20),\n\t\tCalculateTimeMap(20, 15),\n\t\tCalculateTimeMap(21, 10),\n\t}\n\tLessonTipsEnd := []int{\n\t\tCalculateTimeMap(8, 45),\n\t\tCalculateTimeMap(9, 40),\n\t\tCalculateTimeMap(10, 45),\n\t\tCalculateTimeMap(11, 40),\n\t\tCalculateTimeMap(12, 55),\n\t\tCalculateTimeMap(13, 50),\n\t\tCalculateTimeMap(14, 45),\n\t\tCalculateTimeMap(15, 40),\n\t\tCalculateTimeMap(16, 35),\n\t\tCalculateTimeMap(17, 40),\n\t\tCalculateTimeMap(18, 35),\n\t\tCalculateTimeMap(20, 5),\n\t\tCalculateTimeMap(21, 0),\n\t\tCalculateTimeMap(21, 55),\n\t}\n\tWeekDay, _ := strconv.Atoi(l.LessonWeekday)\n\tsD, _ := strconv.Atoi(DateStartEnd[0])\n\teD, _ := strconv.Atoi(DateStartEnd[1])\n\tsT, _ := strconv.Atoi(TimeStartEnd[0])\n\teT, _ := strconv.Atoi(TimeStartEnd[1])\n\tbasicTime := time.Date(2022, 2, 28, 8, 0, 0, 0, time.Local)\n\tstarts = basicTime.Add(time.Duration((sD-1)*24*7) * time.Hour).Add(time.Duration(LessonTipsStart[sT-1]) * time.Minute).Add(time.Duration((WeekDay-1) * 24) * time.Hour)\n\tends = basicTime.Add(time.Duration((sD-1)*24*7) * time.Hour).Add(time.Duration(LessonTipsEnd[eT-1]) * time.Minute).Add(time.Duration((WeekDay-1) * 24) * time.Hour)\n\tending = eD-sD+1\n\treturn\n}\n\n","slug":"LarkCalendarProgram","date":"2021-12-03T06:31:32.000Z","categories_index":"blog","tags_index":"lark,Backend,Golang","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"7c7ffd2e1448fe10d3fa1123a825b256","title":"æœåŠ¡ç«¯ä½¿ç”¨é£ä¹¦æœºå™¨äººå‘é€ä¿¡æ¯","content":"1. å‡†å¤‡å·¥ä½œ1.1 åˆ›å»ºé£ä¹¦æœºå™¨äººæ–‡æ¡£ï¼š å¼€å‘æµç¨‹ä¸å·¥å…·ä»‹ç»\n1.2 ç»™æœºå™¨äººæ·»åŠ ç›¸åº”æƒé™æ–‡æ¡£ï¼š åº”ç”¨æƒé™\n1.3 è·å– lark-sdké¡¹ç›®ï¼š chyroc&#x2F;lark\nlarkæ˜¯ä¸€ä¸ªå®ç°äº†é£ä¹¦å„APIçš„golangæ¨¡å—ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼è·å–lark\ngo get -u github.com&#x2F;chyroc&#x2F;lark\n\n2. æ­£å¼ç¼–ç¨‹2.1 åœ¨æœåŠ¡ç«¯å®ä¾‹åŒ–larkcli := lark.New(\n    lark.WithAppCredential(\"appID\", \"appSecret\"),\n    lark.WithEventCallbackVerify(\"encryptKey\", \"verificationToken\"),\n)\n\n2.2 è·å– tokenæ–‡æ¡£ï¼š è·å– tenant_access_tokenï¼ˆä¼ä¸šè‡ªå»ºåº”ç”¨ï¼‰\nlarkåº”ç”¨éœ€è¦ä½¿ç”¨è¿™ä¸ªtokenä½œä¸ºæ ‡è¯†æ¥è¿›è¡Œå„ç§æ“ä½œã€‚\n\n\n\n\n\n\n\n\n\ntoken æœ‰æ•ˆæœŸä¸º 2 å°æ—¶ï¼Œåœ¨æ­¤æœŸé—´è°ƒç”¨è¯¥æ¥å£ token ä¸ä¼šæ”¹å˜ã€‚å½“ token æœ‰æ•ˆæœŸå°äº 30 åˆ†çš„æ—¶å€™ï¼Œå†æ¬¡è¯·æ±‚è·å– token çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ tokenï¼Œä¸æ­¤åŒæ—¶è€çš„ token ä¾ç„¶æœ‰æ•ˆã€‚\nctx := context.Background()\nresponse, _, _ := cli.Auth.GetTenantAccessToken(ctx)\n\nè‹¥æ— æ„å¤–ï¼Œresponse ä¸­çš„ Token å­—æ®µå³ä¸º tenant_access_tokenã€‚\n2.3 è·å– chat_idæ–‡æ¡£ï¼š ç¾¤ID è¯´æ˜\nlarkåº”ç”¨åœ¨å‘é€ä¿¡æ¯çš„æ—¶å€™éœ€è¦ä½¿ç”¨ chat_id æ¥è¯†åˆ«åº”è¯¥å‘é€åˆ°å“ªä¸ªä¼šè¯ã€‚\n\n\n\n\n\n\n\n\n\nchat_idæ˜¯ä¸€ä¸ªç¾¤èŠçš„å”¯ä¸€æ ‡è¯†ã€‚å½“åˆ›å»ºä¸€ä¸ªç¾¤èŠçš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆè¯¥IDã€‚\nctx2 := context.WithValue(context.Background(), \"Authorization\", response.Token)\nresponse2, _, _ := cli.Chat.GetChatListOfSelf(ctx2, &amp;lark.GetChatListOfSelfReq&#123;&#125;)\n\nè‹¥æ— æ„å¤–ï¼Œ response2 ä¸­çš„ Items å­—æ®µå³ä¸ºæ‰€æœ‰ chat_idÃŸ çš„åˆ—è¡¨ã€‚\n2.4 å‘é€ä¿¡æ¯æ–‡æ¡£ï¼š å‘é€æ¶ˆæ¯\nlarkåº”ç”¨å¯ä»¥è°ƒç”¨é£ä¹¦æ¥å£ï¼Œå®ç°ä¿¡æ¯å‘é€ã€‚\nctx3 := context.Background()\ncli.Message.Send().ToChatID(\"chat_id\").SendText(ctx3, \"Hello\")\n\nè‹¥æ— æ„å¤–ï¼Œæœºå™¨äººå°±èƒ½å°†ä¸€æ¡å†…å®¹ä¸º Hello çš„ä¿¡æ¯å‘é€åˆ° chat_id çš„èŠå¤©ã€‚\n3. å‚è€ƒä»£ç import (\n\t\"context\"\n\t\"fmt\"\n\t\"github.com/chyroc/lark\"\n)\n\nfunc main() &#123;\n\tcli := lark.New(\n        lark.WithAppCredential(\"appID\", \"appSecret\"),\n        lark.WithEventCallbackVerify(\"encryptKey\", \"verificationToken\"),\n\t)\n\tctx := context.Background()\n\n\tresponse, _, _ := cli.Auth.GetTenantAccessToken(ctx)\n\tfmt.Println(response.Token)\n\n\tctx2 := context.WithValue(context.Background(), \"Authorization\", response.Token)\n\tresponse2, _, _ := cli.Chat.GetChatListOfSelf(ctx2, &amp;lark.GetChatListOfSelfReq&#123;&#125;)\n\n\tctx3 := context.Background()\n\tfor _, x := range response2.Items &#123;\n\t\t_, _, _ = cli.Message.Send().ToChatID(x.ChatID).SendText(ctx3, `Hello`)\n\t&#125;\n&#125;\n\n4. é™„è®°larkæ‰€æä¾›çš„æ¥å£å…¶å®ä¸å¤ªå¥½ç”¨ï¼Œæ›´å»ºè®®åœ¨å¼€å‘çš„æ—¶å€™æ‰‹åŠ¨ä½¿ç”¨é£ä¹¦å®˜æ–¹çš„APIæ¥å£è¿›è¡Œè°ƒç”¨ã€‚\n","slug":"LarkChatBackend","date":"2021-11-28T08:16:18.000Z","categories_index":"blog","tags_index":"lark,Backend,Golang","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"6744708d0acb1352be9f52cb85bacb83","title":"Hexoåšå®¢éƒ¨ç½²æ€»ç»“","content":"1. ç¯å¢ƒé…ç½®1.1 nvmçš„å®‰è£…a. ä¸‹è½½nvmå®‰è£…åŒ…\n\n\n\n\n\n\n\n\nnvmçš„å…¨ç§°ä¸ºnode version managerï¼Œå³nodeç‰ˆæœ¬ç®¡ç†å™¨ï¼Œç”¨äºä¾¿æ·çš„ç®¡ç†å„ä¸ªç‰ˆæœ¬çš„node.jsã€‚\nnvm-windowsçš„å®˜æ–¹å‘å¸ƒåœ°å€ä¸ºï¼š \nhttps://github.com/coreybutler/nvm-windows/releasesã€‚\nä½†æ˜¯ç”±äºè¶…çº§é˜²ç«å¢™çš„åŸå› ï¼Œè¿™ä¸ªåœ°å€æœ‰çš„æ—¶å€™æ— æ³•æ­£å¸¸è®¿é—®ï¼Œéœ€è¦å¤§å®¶ä½¿ç”¨ç§‘å­¦çš„æ–¹å¼è¿›è¡Œä¸Šç½‘ã€‚\nb. å®‰è£…nvmå°†å…¶ä¸‹è½½åˆ°æœ¬æœºä»¥åï¼Œè§£å‹ååŒå‡»å®‰è£…åŒ…å¹¶æ ¹æ®å®‰è£…æç¤ºè¿›è¡Œå®‰è£…ã€‚\nc. æ£€éªŒnvmæ˜¯å¦å®‰è£…æˆåŠŸåœ¨å‘½ä»¤æç¤ºç¬¦çª—å£ä¸­ï¼Œè¾“å…¥æŒ‡ä»¤ï¼š\nnvm version\n\næ¥æŸ¥çœ‹nvmçš„ç‰ˆæœ¬ï¼Œå¦‚æœå®‰è£…æˆåŠŸï¼Œåˆ™åº”è¯¥ä¼šæ‰“å°å‡ºnvmçš„ç‰ˆæœ¬ï¼š\n1.1.8\n\n1.2 Nodeçš„å®‰è£…\n\n\n\n\n\n\n\n\nNodeæ˜¯è¯­è¨€JavaScriptçš„è¿è¡Œç¯å¢ƒã€‚\na. å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Node.jsåœ¨å‘½ä»¤æç¤ºç¬¦çª—å£ä¸­ï¼Œè¾“å…¥æŒ‡ä»¤ï¼š\nnvm install ${version}\n\nversionä¸ºç‰ˆæœ¬å·ï¼Œæ­¤å¤„æ¨èç‰ˆæœ¬ä¸º14ï¼Œåˆ™å¯ä»¥è¾“å…¥ï¼š\nnvm install 14\n\nb. ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„Node.jsåœ¨å‘½ä»¤æç¤ºç¬¦çª—å£ä¸­ï¼Œè¾“å…¥æŒ‡ä»¤ï¼š\nnvm use ${version}\n\nversionä¸ºç‰ˆæœ¬å·ï¼Œæ­¤å¤„æ¨èç‰ˆæœ¬ä¸º14ï¼Œåˆ™å¯ä»¥è¾“å…¥ï¼š\nnvm use 14\n\nc. æµ‹è¯•Node.jsæ˜¯å¦å®‰è£…æˆåŠŸåœ¨å‘½ä»¤æç¤ºç¬¦çª—å£ä¸­ï¼Œè¾“å…¥æŒ‡ä»¤ï¼š\nnode -v\n\næ¥æŸ¥çœ‹nodeçš„ç‰ˆæœ¬ï¼Œå¦‚æœå®‰è£…æˆåŠŸï¼Œåˆ™åº”è¯¥è¿”å›nodeçš„ç‰ˆæœ¬ï¼š\nv14.15.1\n\nd. å°è¯•è¿è¡ŒJavaScriptè¯­å¥\n\n\n\n\n\n\n\n\nå½“ç„¶è¿™ä¸ªä¸æ˜¯é‡ç‚¹ã€‚\nç”±äºJavaScriptæ˜¯è§£é‡Šå‹è¯­è¨€ï¼Œå…¶ä¸éœ€è¦è¿›è¡Œç¼–è¯‘ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œä¸€äº›è¯­å¥ï¼Œæ­¤å¤„æˆ‘ä»¬æ¥åšä¸€ä¸ªç®€å•çš„Hello, Worldç¨‹åºã€‚\nåœ¨å‘½ä»¤æç¤ºç¬¦çª—å£ä¸­ï¼Œè¾“å…¥æŒ‡ä»¤è¿›å…¥nodeç¯å¢ƒï¼š\nnode\n\nç„¶åè¾“å…¥JavaScriptè¯­å¥ï¼š\nconsole.log(\"Hello, World\")\n\né”®å…¥å›è½¦å³å¯è¿è¡Œã€‚è¿è¡Œç»“æœä¸ºï¼š\nHello, World\n\n1.3 Gitçš„å®‰è£…\n\n\n\n\n\n\n\n\nGitæ˜¯ä¸€ä¸ªç‰ˆæœ¬ç®¡ç†å·¥å…·\nä¸‹è½½åœ°å€ï¼š git-scm: download\nå®éªŒå®¤åŠ é€Ÿåœ°å€ï¼š Git-Windows-64\né€‰æ‹©å¯¹åº”çš„ç³»ç»Ÿç›´æ¥ä¸‹è½½å³å¯ã€‚\n2. åˆå§‹åŒ–åšå®¢2.1 ä½¿ç”¨npmæ¥å®‰è£…hexoåŒ…\n\n\n\n\n\n\n\n\nnpmçš„å…¨ç§°ä¸ºnode package managerï¼Œæ„ä¸ºNodeåŒ…ç®¡ç†å™¨ï¼Œæ˜¯node.jsçš„ä¸€ä¸ªå®˜æ–¹å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå·¥å…·æ¥è·å–æˆ‘ä»¬æƒ³è¦çš„åˆ«äººå‘å¸ƒçš„nodeç¨‹åºåŒ…ã€‚\nhexoæ˜¯ä¸€ä¸ªè‘—ååšå®¢è½¯ä»¶ï¼Œå¯ä»¥å¿«é€Ÿçš„ç”Ÿæˆåšå®¢ç«™ç‚¹ã€‚\nä¸ºäº†åŠ é€Ÿnpmçš„ä¸‹è½½ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæ›´æ¢npmçš„ä¸‹è½½æºï¼š\nnpm config set registry https://registry.npm.taobao.org \n\nåœ¨å‘½ä»¤æç¤ºç¬¦çª—å£ä¸­ï¼Œè¾“å…¥æŒ‡ä»¤ï¼š\nnpm install hexo-cli -g\n\næ¥å®‰è£…hexoå’Œå®ƒçš„è„šæ‰‹æ¶ã€‚å¦‚æœæ²¡æœ‰æŠ¥é”™çš„è¯ï¼Œå°±æ˜¯å®‰è£…æˆåŠŸã€‚\n2.2 ä½¿ç”¨hexo-cliåˆ›å»ºä¸€ä¸ªåšå®¢é¡¹ç›®åœ¨ä½ æƒ³å­˜å‚¨é¡¹ç›®çš„ç›®å½•ä¸‹ï¼Œè¾“å…¥æŒ‡ä»¤ï¼š\nhexo init ${blog_name}\n\nå…¶ä¸­blog_nameæ˜¯åˆ›å»ºçš„åšå®¢ç«™ç‚¹çš„åå­—ï¼Œä¹Ÿæ˜¯æ–‡ä»¶å¤¹çš„åå­—ã€‚å¦‚æœæ²¡æœ‰æŠ¥é”™çš„è¯ï¼Œå°±æ˜¯åˆ›å»ºæˆåŠŸã€‚\n2.3 ä½¿ç”¨hexo-cliåˆ›å»ºåšå®¢ç½‘ç«™åœ¨${blog_name}ç›®å½•ä¸‹ï¼Œè¾“å…¥æŒ‡ä»¤ï¼š\nhexo s\n\nç„¶åå°±å¯ä»¥åœ¨å®ƒç»™ä½ çš„åœ°å€è®¿é—®ä½ çš„åšå®¢ç½‘ç«™äº†ã€‚\n3. æ’°å†™åšå®¢å†…å®¹åœ¨${blog_name}ç›®å½•ä¸‹ï¼Œè¾“å…¥æŒ‡ä»¤ï¼š\nhexo new post ${post_name}\n\nå…¶ä¸­post_nameæ˜¯æ–‡ç« çš„æ ‡é¢˜ï¼Œä¹Ÿæ˜¯æ–‡ç« çš„uriã€‚æ‰§è¡Œå®Œæˆåï¼Œhexoä¼šåœ¨./source/postç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º${blog_name}.mdçš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªmarkdownæ–‡ä»¶ã€‚\n\n\n\n\n\n\n\n\n\nMarkdownæ˜¯ä¸€ç§æ ‡è®°å¼å†™ä½œè¯­è¨€ï¼Œå¹¿æ³›åœ¨è®¡ç®—æœºé¢†åŸŸã€å­¦æœ¯é¢†åŸŸä½¿ç”¨ã€‚\nç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ï¼Œä¿å­˜åå°±å¯ä»¥åˆ°åšå®¢ç«™ç‚¹ä¸ŠæŸ¥çœ‹å˜æ›´åçš„å†…å®¹äº†ã€‚\n4. Markdownè¯­æ³•Markdownä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§è¯­æ³•ï¼š\n\næ ‡é¢˜\nåˆ—è¡¨\næœ‰åºåˆ—è¡¨\næ— åºåˆ—è¡¨\nå¾…åŠåˆ—è¡¨\n\n\nåª’ä½“\nå›¾ç‰‡\né“¾æ¥\næµç¨‹å›¾\n\n\nè¡¨æ ¼\nå…¬å¼\nå¼•ç”¨\nä»£ç \nè¡Œå†…ä»£ç \nä»£ç å—\n\n\n\n4.1 Markdownçš„æ ‡é¢˜#ç”¨äºæ ‡è®°ä¸€çº§æ ‡é¢˜ï¼Œå¦‚ï¼š\n# æˆ‘æ˜¯ä¸€çº§æ ‡é¢˜\n\n##ç”¨äºæ ‡è®°äºŒçº§æ ‡é¢˜ï¼Œå¦‚ï¼š\n## æˆ‘æ˜¯äºŒçº§æ ‡é¢˜\n\n###ç”¨äºæ ‡è®°ä¸‰çº§æ ‡é¢˜ï¼Œå¦‚ï¼š\n### æˆ‘æ˜¯ä¸‰çº§æ ‡é¢˜\n\n4.2 Markdownçš„åˆ—è¡¨a. æ— åºåˆ—è¡¨+/-éƒ½å¯ä»¥ç”¨æ¥æ ‡è®°æ— åºåˆ—è¡¨ï¼Œå¦‚ï¼š\n+ æˆ‘æ˜¯åˆ—è¡¨é¡¹\n+ æˆ‘æ˜¯åˆ—è¡¨é¡¹\n+ æˆ‘æ˜¯åˆ—è¡¨é¡¹\n\n- æˆ‘æ˜¯åˆ—è¡¨é¡¹\n- æˆ‘æ˜¯åˆ—è¡¨é¡¹\n- æˆ‘æ˜¯åˆ—è¡¨é¡¹\n\nb. æœ‰åºåˆ—è¡¨${index}.å¯ä»¥ç”¨æ¥æ ‡è®°æœ‰åºåˆ—è¡¨ï¼Œå¦‚ï¼š\n1. æˆ‘æ˜¯åˆ—è¡¨é¡¹1\n2. æˆ‘æ˜¯åˆ—è¡¨é¡¹2\n3. æˆ‘æ˜¯åˆ—è¡¨é¡¹3\n\nc. å¾…åŠåˆ—è¡¨- [ ]/- [x]å¯ä»¥ç”¨æ¥æ ‡è®°å¾…åŠåˆ—è¡¨ï¼Œå¦‚ï¼š\n- [ ] æˆ‘æ²¡åšå®Œ\n- [x] æˆ‘åšå®Œäº†\n\næ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š\n\n \næˆ‘æ²¡åšå®Œ\n\n \næˆ‘åšå®Œäº†\n\n\n4.3 Markdownçš„åª’ä½“a. å›¾ç‰‡![${pic_title}](${pic_uri})å¯ä»¥ç”¨æ¥æ ‡è®°å›¾ç‰‡ï¼Œå¦‚ï¼š\n![](https://swu-acm-lab.github.io/Ceobebot-Document/_media/CeobeBot.png)\n\næ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š\n\nb. é“¾æ¥[${link_show_text}](${link_uri})å¯ä»¥ç”¨æ¥æ ‡è®°é“¾æ¥ï¼Œå¦‚ï¼š\n[CeobeBot - åˆ»ä¿„æŸæœºå™¨äºº](https://swu-acm-lab.github.io/Ceobebot-Document/_media/CeobeBot.png)\n\næ˜¾ç¤ºæ•ˆæœä¸ºï¼š\nCeobeBot - åˆ»ä¿„æŸæœºå™¨äºº\nc. æµç¨‹å›¾\n\n\n\n\n\n\n\n\næµç¨‹å›¾éœ€è¦æ’ä»¶æ‰èƒ½è§£æï¼Œæ­¤å¤„ä¸è¿‡å¤šè¯´æ˜ï¼Œå»ºè®®åœ¨Typoraä¸­å°è¯•\nflowæ˜¯ä¸€ä¸ªåœ¨markdownä¸­ç”»æµç¨‹å›¾çš„è¯­è¨€ï¼Œå¦‚ï¼š\n```flow\nst=&gt;start: å¼€å§‹\nop=&gt;operation: æ“ä½œ\ned=&gt;end: ç»“æŸ\n\nst-&gt;op-&gt;ed\n```\n\næ˜¾ç¤ºæ•ˆæœä¸ºï¼š\nst=&gt;start: å¼€å§‹\nop=&gt;operation: æ“ä½œ\ned=&gt;end: ç»“æŸ\n\nst-&gt;op-&gt;ed\n\n4.4 Markdownçš„è¡¨æ ¼\n\n\n\n\n\n\n\n\nå»ºè®®ä½¿ç”¨å·¥å…·ç”Ÿæˆè¡¨æ ¼\nmarkdownçš„è¡¨æ ¼æ ‡è®°æ ¼å¼å¦‚ä¸‹ï¼š\n| åˆ—å1 | åˆ—å2 |\n| :--: | :--: |\n| å†…å®¹1 | å†…å®¹2 |\n\næ˜¾ç¤ºæ•ˆæœä¸ºï¼š\n\n\n\nåˆ—å1\nåˆ—å2\n\n\n\nå†…å®¹1\nå†…å®¹2\n\n\n4.5 Markdownçš„å…¬å¼\n\n\n\n\n\n\n\n\nMarkdownçš„å…¬å¼ä½¿ç”¨LaTeXçš„å…¬å¼è¯­æ³•ã€‚\na. è¡Œå†…å…¬å¼$ç”¨äºæ ‡æ³¨è¡Œå†…å…¬å¼ï¼Œå¦‚ï¼š\näºŒæ¬¡å‡½æ•°å®šä¹‰ä¸ºï¼š $y = f(x) = ax^2 + bx + c$\n\næ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š\näºŒæ¬¡å‡½æ•°å®šä¹‰ä¸ºï¼š \nb. å—å…¬å¼$$ç”¨äºæ ‡æ³¨å—å…¬å¼ï¼Œå¦‚ï¼š\näºŒæ¬¡å‡½æ•°å®šä¹‰ä¸º$(1)$å¼ï¼š\n\n$$\ny = f(x) = ax^2 + bx + c \\tag{1}\n$$\n\næ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š\näºŒæ¬¡å‡½æ•°å®šä¹‰ä¸ºå¼ï¼š\n\n4.6 Markdownçš„å¼•ç”¨&gt;ç”¨äºæ ‡è®°å¼•è¨€ï¼Œå¦‚ï¼š\n&gt; æˆ‘æ˜¯åäººåè¨€\n\næ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š\n\n\n\n\n\n\n\n\n\næˆ‘æ˜¯åäººåè¨€\n4.7 Markdownçš„ä»£ç a. è¡Œå†…ä»£ç markdownè¡Œå†…ä»£ç çš„æ ‡æ³¨æ ¼å¼å¦‚ä¸‹ï¼š\n`printf(\"hello\\n\")` æ˜¯ä¸€å¥ä»£ç \n\næ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š\nprintf(\"hello\\n\") æ˜¯ä¸€å¥ä»£ç \nb. å—ä»£ç markdownå—ä»£ç çš„æ ‡æ³¨æ ¼å¼å¦‚ä¸‹ï¼š\n```${language}\n${code_content}\n```\n\nå…¶ä¸­languageæ˜¯ä»£ç çš„è¯­è¨€ç±»å‹ï¼Œä¸€èˆ¬ä¸ºä»£ç æ–‡ä»¶æ‹“å±•åï¼Œcode_contentæ˜¯ä»£ç å—çš„å†…å®¹ï¼Œå¦‚ï¼š\n```cpp\n#include &lt;cstdio&gt;\n\nint main() {\n    printf(\"hello\\n\");\n    return 0;\n}\n```\n\næ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š\n#include &lt;cstdio&gt;\n\nint main() {\n    printf(\"hello\\n\");\n    return 0;\n}\n\n5. å°†åšå®¢éƒ¨ç½²åˆ°ç½‘ç»œä¸Š\n\n\n\n\n\n\n\n\næˆ‘ä»¬ä½¿ç”¨GitHub PagesæœåŠ¡æ¥å¸®åŠ©æˆ‘ä»¬éƒ¨ç½²ã€‚\nä¿®æ”¹_config.ymlæ–‡ä»¶ï¼Œè¿™ä¸ªæ˜¯åšå®¢é¡¹ç›®çš„é…ç½®æ–‡ä»¶ã€‚æ‰¾åˆ°deployé€‰é¡¹ï¼š\ndeploy:\n  type: git\n  repo: ${your_github_repo}\n  branch: ${your_repo_branch}\n  token: ${your_github_token}\n  name: ${your_name}\n  email: ${your_email_address}\n\n\nå…¶ä¸­your_github_repoæ˜¯ä½ åœ¨GitHubåˆ›å»ºçš„é¡¹ç›®åœ°å€ï¼Œyour_repo_branchæ˜¯ä½ æƒ³éƒ¨ç½²çš„åˆ†æ”¯åï¼Œ${your_github_token}æ˜¯ä½ åœ¨GitHubç”Ÿæˆçš„è®¿é—®å¯†é’¥ï¼Œ${your_name}æ˜¯ä½ çš„å¤§å(å»ºè®®è‹±æ–‡)ï¼Œ${your_email_address}æ˜¯ä½ çš„é‚®ç®±ï¼Œå»ºè®®å’ŒGitHubæ³¨å†Œé‚®ç®±ä¸€è‡´ã€‚\nå®‰è£…hexo-deployer-git:\nnpm install hexo-deployer-git --save\n\nå®Œæˆåï¼Œä½¿ç”¨ä¸‹é¢çš„æŒ‡ä»¤ï¼š\nhexo d\n\næ ¹æ®æç¤ºè¾“å…¥ä½ çš„è´¦å·å’Œå¯†ç ï¼Œå°±å¯ä»¥éƒ¨ç½²åˆ°GitHub Pagesä¸Šäº†ã€‚\n","slug":"HexoInit","date":"2021-11-06T01:59:06.000Z","categories_index":"blog","tags_index":"Hexo,Blog,GitHub Actions,GitHub Pages","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"33d946be9412bd8a90fb75fab5562d37","title":"2021çº§æ–°ç”Ÿè®­ç»ƒèµ›ç¬¬ä¸€åœºé¢˜è§£","content":"è½®åˆ°SunistCæ¥ç»™å¤§ä¸€æ–°ç”Ÿä»¬å†™è®­ç»ƒèµ›é¢˜è§£äº†ã€‚\niridescentè¿·ä¸Šäº†ç¥å¥‡çš„æ•°(5åˆ†) - é¢˜è§£æœ¬é¢˜è®¡ç®—å†…æœ‰å¤šå°‘ä¸ªç´ æ•°ï¼Œç­”æ¡ˆä¸ºã€‚å¯ä»¥è€ƒè™‘ä¸‰ç§æ€è·¯ï¼Œå…¶ä¸­æ€è·¯1æ— æ³•åŠæ—¶å¾—å‡ºç»“æœã€‚\n1. æš´åŠ›æ±‚è§£æŒ‰ç…§ç´ æ•°å®šä¹‰è¿›è¡Œåˆ¤æ–­ï¼š\n#include &lt;iostream&gt;\n\nint main() {\n    int a = 11451419;\n    int ans = 1;\n    for (int i = 2; i &lt;= a; i++) {\n        for (int j = 2; j &lt;= i; j++) {\n            if (i % j == 0) {\n                ans += 1;\n                break;\n            }\n        }\n    }\n    std::cout &lt;&lt; a - ans &lt;&lt; std::endl;\n    return 0;\n}\n\nè‹¥ä¸è¿›è¡Œä¼˜åŒ–ï¼Œæœ¬æ€è·¯æ‰€ç”¨æ—¶é—´ä¸º NaNã€‚è·‘äº†åŠå°æ—¶æ²¡è·‘å‡ºæ¥ã€‚\n\n\n\n\n\n\n\n\n\nå¤šçº¿ç¨‹æš´åŠ›ï¼š\nåœ¨æœ¬æ€è·¯çš„åŸºç¡€ä¸Šï¼Œå°†åŒºé—´æ‹†åˆ†ä¸ºè‹¥å¹²ç­‰åˆ†ï¼Œå¯¹æ¯ä¸€ä¸ªå­åŒºé—´æ–°å»ºçº¿ç¨‹è¿›è¡Œæš´åŠ›æ±‚è§£ã€‚è¿™æ˜¯æ‰“è¡¨æ³•/æš´åŠ›æ³•çš„é€šç”¨ä¼˜åŒ–æ€è·¯ã€‚\nåœ¨ä½¿ç”¨åå…­çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œæœ¬æ€è·¯æ‰€ç”¨æ—¶é—´ä¸ºï¼š NaNã€‚è·‘äº†åŠå°æ—¶æ²¡è·‘å‡ºæ¥ã€‚\n2. sqrtä¼˜åŒ–æš´åŠ›åœ¨ä¸Šé¢çš„ç®—æ³•ä¸­ï¼Œå…¶å®å¹¶ä¸éœ€è¦æŒ‰ç…§å®šä¹‰ä¸€ç›´åˆ¤æ–­åˆ°ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ¤æ–­ä»åˆ°ä¹‹é—´çš„æ•´æ•°å°±å¯ä»¥äº†ã€‚\n\n\n\n\n\n\n\n\n\nè¯æ˜ï¼š\nè‹¥ä¸æ˜¯ç´ æ•°ï¼Œåˆ™å…¶å¯ä»¥è¡¨ç¤ºä¸ºï¼Œæˆ‘ä»¬ä¸å¦¨ä»¤ã€‚\næ­¤æ—¶æˆ‘ä»¬çŸ¥é“å¯èƒ½å–å¾—æœ€å¤§å€¼æ—¶ï¼Œæœ‰ï¼Œå³ï¼Œæ­¤æ—¶ã€‚\næ‰€ä»¥ï¼Œå³è‹¥ä¸æ˜¯ç´ æ•°ï¼Œå…¶å¿…æœ‰ä¸€ä¸ªå› æ•°åœ¨åŒºé—´ã€‚\nè¯æ˜å®Œæ¯•ã€‚\nä¼˜åŒ–åçš„å…·ä½“ä»£ç ä¸ºï¼š\n#include &lt;iostream&gt;\n#include &lt;cmath&gt;\n\nint main() {\n    int a = 11451419;\n    int ans = 1;\n    for (int i = 2; i &lt;= a; i++) {\n        int temp = sqrt(i); // é¿å…æ¯æ¬¡jçš„å¾ªç¯éƒ½è¿›è¡Œä¸€æ¬¡å¼€æ–¹è¿ç®—\n        for (int j = 2; j &lt;= temp; j++) {\n            if (i % j == 0) {\n                ans += 1;\n                break;\n            }\n        }\n    }\n    std::cout &lt;&lt; a - ans &lt;&lt; std::endl;\n    \n    return 0;\n}\n\nä½¿ç”¨æœ¬ä¼˜åŒ–æ€è·¯ï¼Œæ‰€ç”¨æ—¶é—´ä¸º 4469ms ã€‚\n3. ç­›æ³•è€ƒè™‘è¿™æ ·ä¸€ä»¶äº‹æƒ…ï¼šå¦‚æœæ˜¯åˆæ•°ï¼Œé‚£ä¹ˆçš„å€æ•°ä¹Ÿä¸€å®šæ˜¯åˆæ•°ã€‚åˆ©ç”¨è¿™ä¸ªç»“è®ºï¼Œæˆ‘ä»¬å¯ä»¥é¿å…å¾ˆå¤šæ¬¡ä¸å¿…è¦çš„æ£€æµ‹ã€‚å¦‚æœæˆ‘ä»¬ä»å°åˆ°å¤§è€ƒè™‘æ¯ä¸ªæ•°ï¼Œç„¶ååŒæ—¶æŠŠå½“å‰è¿™ä¸ªæ•°çš„æ‰€æœ‰ï¼ˆæ¯”è‡ªå·±å¤§çš„ï¼‰å€æ•°è®°ä¸ºåˆæ•°ï¼Œé‚£ä¹ˆè¿è¡Œç»“æŸçš„æ—¶å€™æ²¡æœ‰è¢«æ ‡è®°çš„æ•°å°±æ˜¯ç´ æ•°äº†ã€‚\nè¿™ä¸ªæ€è·¯è¢«ç§°ä¸ºç­›æ³•ï¼Œä¹Ÿæ˜¯ç­›æ³•ä¸­æœ€ç®€å•ã€æ—¶é—´å¤æ‚åº¦æœ€é«˜çš„åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸ºã€‚\nå…·ä½“ä»£ç ä¸ºï¼š\n#include &lt;iostream&gt;\n\n// æ ‡å‡†åŸƒæ°ç­›\nint Eratosthenes(int n, bool *is_prime, int *prime)\n{\n    int p = 0;\n    for (int i = 0; i &lt;= n; ++i)\n        is_prime[i] = 1;\n    is_prime[0] = is_prime[1] = 0;\n    for (int i = 2; i &lt;= n; ++i)\n    {\n        if (is_prime[i])\n        {\n            prime[p++] = i; // prime[p]æ˜¯i,åç½®è‡ªå¢è¿ç®—ä»£è¡¨å½“å‰ç´ æ•°æ•°é‡\n            if ((long long)i * i &lt;= n)\n                for (int j = i * i; j &lt;= n; j += i)\n                    // å› ä¸ºä» 2 åˆ° i-1 çš„å€æ•°æˆ‘ä»¬ä¹‹å‰ç­›è¿‡äº†ï¼Œè¿™é‡Œç›´æ¥ä» i\n                    // çš„å€æ•°å¼€å§‹ï¼Œæé«˜äº†è¿è¡Œé€Ÿåº¦\n                    is_prime[j] = 0; // æ˜¯içš„å€æ•°çš„å‡ä¸æ˜¯ç´ æ•°\n        }\n    }\n    return p;\n}\n\nint main()\n{\n    int a = 11451419;\n    bool *is_prime = new bool[a];\n    int *prime = new int[a];\n    int ans = Eratosthenes(a, is_prime, prime);\n    std::cout &lt;&lt; ans &lt;&lt; std::endl;\n    return 0;\n}\n\nä½¿ç”¨æœ¬ä¼˜åŒ–æ€è·¯ï¼Œæ‰€ç”¨æ—¶é—´ä¸º 93ms ã€‚\næœ€å¤§å…¬çº¦æ•°(5åˆ†) - é¢˜è§£æœ¬é¢˜è®¡ç®—ä¸çš„æœ€å¤§å…¬çº¦æ•°ï¼Œç­”æ¡ˆä¸ºã€‚å¯ä»¥è€ƒè™‘ä¸‰ç§æ€è·¯ï¼Œå…¶ä¸­æ€è·¯1æ— æ³•åŠæ—¶å¾—å‡ºç»“æœã€‚\næ‰‹ç®—å¦‚é¢˜ï¼Œä½¿ç”¨çŸ­é™¤æ³•ç­‰æ•°å­¦æ€è·¯ç”¨æ‰‹æ¥ç®—ã€‚\næš´åŠ›æ±‚è§£è§‚å¯Ÿå¯çŸ¥é¢˜ä¸­ä¸¤æ•°å¯èƒ½çš„æœ€å¤§å…¬çº¦æ•°å–å€¼èŒƒå›´ä¸ºï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹è¿™ä¸ªåŒºé—´ä¸­çš„æ¯ä¸€ä¸ªæ•°ä»å¤§åˆ°å°è¿›è¡Œåˆ¤æ–­ï¼Œçœ‹èƒ½å¦åŒæ—¶æ•´é™¤ä¸¤æ•°ï¼Œæ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªæ•°å³ä¸ºä¸¤æ•°çš„æœ€å¤§å…¬çº¦æ•°ã€‚\n#include &lt;iostream&gt;\n\nint main()\n{\n    long long a = 1145141919810, b = 60606;\n    for (int i = b; i &gt; 1; i--)\n    {\n        if (a % i == 0 &amp;&amp; b % i == 0)\n        {\n            std::cout &lt;&lt; i &lt;&lt; std::endl;\n            break;\n        }\n    }\n    return 0;\n}\n\nä½¿ç”¨æœ¬æ€è·¯ï¼Œæ‰€ç”¨æ—¶é—´ä¸º 2ms ã€‚\næ¬§å‡ é‡Œå¾—ç®—æ³•/è¾—è½¬ç›¸é™¤æ³•åœ¨é«˜ä¸­æ•°å­¦å¿…ä¿®3ç¬¬ä¸€ç« ç¬¬ä¸‰èŠ‚ä¸­ï¼Œæœ‰å­¦è¿‡ä¸€ä¸ªåä¸ºè¾—è½¬ç›¸é™¤æ³•çš„ç®—æ³•ï¼Œç”¨äºè®¡ç®—ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°ï¼Œå…¶ç¨‹åºæ¡†å›¾å¦‚ä¸‹ï¼š\nstart=&gt;start: å¼€å§‹\ninput=&gt;inputoutput: è¾“å…¥a, b\nmod=&gt;operation: c = a MOD b, a = b, b = c\njudge=&gt;condition: c = 0?\noutput=&gt;inputoutput: è¾“å‡ºa\nend=&gt;end: ç»“æŸ\n\nstart-&gt;input-&gt;mod(right)-&gt;judge\njudge(yes)-&gt;output-&gt;end\njudge(no)-&gt;mod\n\n#include &lt;iostream&gt;\n\nlong long gcd(long long a, long long b) {\n\treturn b ? gcd(b, a % b) : a;\n}\n\nint main() {\n    long long a = 1145141919810, b = 60606;\n    std::cout &lt;&lt; gcd(a, b) &lt;&lt; std::endl;\n    return 0;\n}\n\nå…¶ä¸­Cæ ‡å‡†åº“ä¹Ÿå°è£…äº†æœ¬ç®—æ³•ï¼š\n#include &lt;iostream&gt;\n#include &lt;algorithm&gt;\n\nint main() {\n    long long a = 1145141919810, b = 60606;\n    std::cout &lt;&lt; std::__gcd(a, b) &lt;&lt; std::endl;\n    return 0;\n}\n\n ä½¿ç”¨æœ¬æ€è·¯ï¼Œæ‰€ç”¨æ—¶é—´ä¸º 1ms ã€‚\nExcelå¤„ç†æ•°æ®(10åˆ†) - é¢˜è§£æœ¬é¢˜ä¸ºè®¡ç®—åŒºé—´ä¸­å»æ‰è‹¥å¹²ä¸ªåŒºé—´åï¼Œæœ‰å¤šå°‘ä¸ªæ•°å­—ï¼Œç­”æ¡ˆä¸ºã€‚å¯ä»¥è€ƒè™‘ä¸¤ç§æ€è·¯ã€‚\nç›´æ¥æš´åŠ›ç›´æ¥ä»åŒºé—´èµ·ç‚¹å¼€å§‹ï¼Œåˆ°åŒºé—´ç»ˆç‚¹ç»“æŸï¼Œæ¯ä¸€ä¸ªæ•°åˆ¤æ–­å…¶æ˜¯å¦åœ¨å»æ‰çš„åŒºé—´å†…ï¼Œå¦‚æœåœ¨ï¼Œåˆ™ä¸è®¡æ•°ï¼Œå¦‚æœä¸åœ¨ï¼Œåˆ™è®¡æ•°ã€‚\n#include &lt;iostream&gt;\n\nint count7(int n)\n{\n    int temp = n;\n    int ans = 0;\n    while (temp != 0)\n    {\n        ans += temp % 10 == 7 ? 1 : 0;\n        temp /= 10;\n    }\n    return ans;\n}\n\nbool should_calculate(int n, int *start, int *end)\n{\n    for (int i = 0; i &lt; 20; i++)\n    {\n        if (n &gt;= start[i] &amp;&amp; n &lt;= end[i])\n        {\n            return false;\n        }\n    }\n    return true;\n}\n\nint main() {\n    int starts[] = {14, 1139, 4998, 26789, 3, 11401, 38768, 92322, 52322, 87653, 113, 973, 49923, 28211, 4836, 89900, 68923, 112988, 348, 8909};\n    int ends[] = {78, 4789, 8907, 29876, 8, 11490, 40000, 102234, 58223, 89764, 294, 1004, 51008, 33387, 6982, 101102, 79321, 114326, 892, 10086};\n    int ans = 0;\n    for (int i = 1; i &lt;= 114514; i++)\n    {\n        if (should_calculate(i, starts, ends))\n        {\n            ans += count7(i);\n        }\n    }\n    std::cout &lt;&lt; ans &lt;&lt; std::endl;\n    return 0;\n}\n\nä½¿ç”¨æœ¬æ€è·¯ï¼Œæ‰€ç”¨æ—¶é—´ä¸ºï¼š 1ms ã€‚\né¢„å¤„ç†å°†åŒºé—´é¢„å…ˆç»Ÿä¸€å¤„ç†ï¼ŒèŠ‚çº¦äº†æ¯ä¸ªæ•°åˆ¤æ–­æ˜¯å¦åœ¨åŒºé—´å†…çš„æ—¶é—´ã€‚\n#include &lt;iostream&gt;\n\nint count7(int n)\n{\n    int temp = n;\n    int ans = 0;\n    while (temp != 0)\n    {\n        ans += temp % 10 == 7 ? 1 : 0;\n        temp /= 10;\n    }\n    return ans;\n}\n\nint main() {\n    int starts[] = {14, 1139, 4998, 26789, 3, 11401, 38768, 92322, 52322, 87653, 113, 973, 49923, 28211, 4836, 89900, 68923, 112988, 348, 8909};\n    int ends[] = {78, 4789, 8907, 29876, 8, 11490, 40000, 102234, 58223, 89764, 294, 1004, 51008, 33387, 6982, 101102, 79321, 114326, 892, 10086};\n    bool *temparr = new bool[114516];\n    for (int i = 1; i &lt;= 114514; i++)\n    {\n        temparr[i] = true;\n    }\n    for (int i = 0; i &lt; 20; i++)\n    {\n        for (int j = starts[i]; j &lt;= ends[i]; j++)\n        {\n            temparr[j] = false;\n        }\n    }\n\n    int ans = 0;\n    for (int i = 1; i &lt;= 114514; i++)\n    {\n        if (temparr[i])\n        {\n            ans += count7(i);\n        }\n    }\n    \n    std::cout &lt;&lt; ans &lt;&lt; std::endl;\n    return 0;\n}\n\nä½¿ç”¨æœ¬æ€è·¯ï¼Œæ‰€ç”¨æ—¶é—´ä¸ºï¼š 1ms ã€‚\n","slug":"20211001-TrainningAssignmentAnserwer","date":"2021-10-02T08:12:30.000Z","categories_index":"answer","tags_index":"Algorithm,ACM,Answer","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"d3efaf25e370a6934d01ee2c4302e610","title":"è®­ç»ƒç¬”è®° - è®¡ç®—å‡ ä½•","content":"è®¡ç®—å‡ ä½•åŸºç¡€å…¥é—¨è®¡ç®—å‡ ä½•æ˜¯ç”±å¾®åˆ†å‡ ä½•ã€ä»£æ•°å‡ ä½•ã€æ•°å€¼è®¡ç®—ã€é€¼è¿‘è®ºã€æ‹“æ‰‘å­¦ä»¥åŠæ•°æ§æŠ€æœ¯ç­‰å½¢æˆçš„ä¸€é—¨æ–°å…´è¾¹ç¼˜å­¦ç§‘ï¼Œå…¶ä¸»è¦ç ”ç©¶å¯¹è±¡å’Œå†…å®¹æ˜¯å¯¹è‡ªç”±å½¢æ›²çº¿ã€æ›²é¢çš„æ•°å­¦æè¿°ã€è®¾è®¡ã€åˆ†æåŠå›¾å½¢çš„æ˜¾ç¤ºã€å¤„ç†ç­‰ã€‚\nå¯¹äºæµ®ç‚¹æ•°çš„å¤„ç†ä¸è¦ç›´æ¥ç”¨ç­‰å·åˆ¤æ–­æµ®ç‚¹æ•°æ˜¯å¦ç›¸ç­‰ï¼\n\n\n\n\n\n\n\n\n\nåŒæ ·çš„ä¸€ä¸ªæ•°1.5ã€‚å¦‚æœä»ä¸åŒçš„é€”å¾„è®¡ç®—å¾—æ¥ï¼Œå®ƒä»¬çš„å‚¨å­˜æ–¹å¼å¯èƒ½ä¼šæ˜¯a=1.4999999 ä¸ b=1.5000001ï¼Œæ­¤æ—¶ä½¿ç”¨a==båˆ¤æ–­å°†è¿”å›falseã€‚\næ‰€ä»¥æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªä»€ä¹ˆå°çš„é‡ eps,åœ¨å¯¹æµ®ç‚¹æ•°è¿›è¡Œå¤§å°æ¯”è¾ƒæ—¶ï¼Œå¦‚æœä»–ä»¬çš„å·®çš„ç»å¯¹å€¼å°äºè¿™ä¸ªé‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºä»–ä»¬æ˜¯ç›¸ç­‰çš„ã€‚epsåœ¨å¤§éƒ¨åˆ†é¢˜ç›®æ—¶å– 1e-8æˆ–è€…1e-9 å°±å¤Ÿäº†ï¼Œä½†è¦æ ¹æ®é¢˜ç›®å®é™…çš„å†…å®¹è¿›è¡Œè°ƒæ•´ã€‚\nä»£ç æ¨¡æ¿const double eps = 1e-8;\nbool dcmp(double x, double y){\n    if(fabs(x - y) &lt; eps){// è¿™é‡Œæ³¨æ„è¦ä½¿ç”¨fabs()ï¼Œä¸èƒ½ç”¨abs().\n        return 0;//ä¸¤æ•°ç›¸ç­‰\n    }else if(x &gt; y){\n        return 1; //  x &gt; y\n    }\n    return -1;\n}\n\næµ®ç‚¹æ ‘è¾“å…¥è¾“å‡ºç”¨ scanf è¾“å…¥æµ®ç‚¹æ•°æ—¶ï¼Œ double çš„å ä½ç¬¦æ˜¯ %lf ï¼Œä½†æ˜¯æµ®ç‚¹æ•° double åœ¨ printf ç³»åˆ—å‡½æ•°ä¸­çš„æ ‡å‡†å ä½ç¬¦æ˜¯ %f è€Œä¸æ˜¯ %lf ï¼Œä½¿ç”¨æ—¶æœ€å¥½ä½¿ç”¨å‰è€…ã€‚\nå¼€æ–¹æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯double sqrt (double x)å‡½æ•°æ¥è¿›è¡Œå¯¹æ­£æ•°çš„å¼€æ–¹ï¼Œä½†æ˜¯å½“è¾“å…¥è´Ÿæ•°æ—¶,sqrt ä¼šè¿”å› nan ï¼Œè¾“å‡ºæ—¶ä¼šæ˜¾ç¤ºæˆ nan æˆ– -1.#IND00 ï¼ˆæ ¹æ®ç³»ç»Ÿçš„ä¸åŒï¼‰ã€‚å¦‚æœå¯¹ä¸€ä¸ªå‡ ä¹æ¥è¿‘0çš„è´Ÿæ•°ï¼Œç”±ä¸Šé¢çš„è¯¯å·®åˆ†æå¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªè´Ÿæ•°ä¸0ç›¸ç­‰ï¼Œä½†æ˜¯å¼€æ–¹ä¸èƒ½å¾—åˆ°æ­£ç¡®çš„ç­”æ¡ˆã€‚é‚£ä¹ˆè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªå‡½æ•°äº†ã€‚\ndouble mySqrt(double x) {\n    return max(0.0,sqrt(x));\n}\n\nè´Ÿé›¶è¾“å‡ºæ—¶ä¸€å®šè¦å°å¿ƒä¸è¦è¾“å‡º âˆ’0ï¼Œæ¯”å¦‚\ndouble a = -0.000001;\nprintf(\"%.4f\", a);\n// -0.0000\n\nå–æ•´int fx = floor(x);//å‘ä¸‹å–æ•´å‡½æ•°\nint cx = ceil(x);//å‘ä¸Šå–æ•´å‡½æ•°\nint rx = round(x);//å››èˆäº”å…¥å‡½æ•°\n\n\nå‘é‡ç®€å•æ¥è¯´ï¼Œæ—¢æœ‰å¤§å°åˆæœ‰æ–¹å‘çš„é‡å«åšå‘é‡åœ¨è®¡ç®—æœºä¸­æˆ‘ä»¬å¸¸ç”¨åæ ‡è¡¨ç¤º\nç‚¹çš„å®šä¹‰æˆ‘ä»¬ä½¿ç”¨ç»“æ„ä½“æ¥å­˜å‚¨ç‚¹\nstruct Pt {\n    double x, y;//å¿…è¦æ—¶ä½¿ç”¨int\n    Pt(double x, double y): x(x), y(y) { }\n};\n\nå‘é‡è®¡ç®—åœ¨é«˜ä¸­å’Œå¤§å­¦ä¸­ï¼Œæˆ‘ä»¬å·²ç»å­¦è¿‡äº†å‘é‡çš„åŠ å‡æ³•ï¼Œå°±ä¸ç»™å‡ºå…¬å¼äº†ã€‚\nåŠ æ³•\n\n\n\n\n\n\n\n\n\npt operator + (pt A, pt B){\n    return pt(A.x+B.x, A.y+B.y);\n} \n\nå‡æ³•\n\n\n\n\n\n\n\n\n\npt operator - (pt A, pt B){\n    return pt(A.x-B.x, A.y-B.y);\n} \n\næ•°ä¹˜å‘é‡çš„æ•°ä¹˜æ˜¯ä¸€ä¸ªå‘é‡å’Œå®æ•°çš„è¿ç®—ã€‚\npt operator * (double A, pt p) { \n    return pt(p.x*A, p.y*A);\n}\npt operator * (pt p, double A) { \n    return pt(p.x*A, p.y*A);\n}\n\nç‚¹ä¹˜double dot(pt A, pt B){\n    return A.x*B.x + A.y*B.y; \n}\nåº”ç”¨ç‚¹ç§¯å¯ä»¥ç”¨æ¥è®¡ç®—ä¸¤å‘é‡çš„å¤¹è§’ã€‚\nå‰ç§¯\ndouble det(pt A, pt B) { return A.x * B.y - A.y * B.x; }\nåº”ç”¨\nè®¡ç®—ä¸¤ä¸ªä¸¤ä¸ªæ„æˆçš„å¹³è¡Œå››è¾¹å½¢é¢ç§¯æˆ–è€…ä¸‰è§’å½¢é¢ç§¯\næ ¹æ®çš„å‡ºç°çš„æ­£è´Ÿæ¥åˆ¤æ–­Aä¸Bå‘é‡çš„æ–¹å‘é™¤æ³•pt operator / (pt A, double p){\n    return pt(A.x/p, A.y/p);\n}\nç­‰äºè¿ç®—bool operator == (const Point&amp; A, const Point&amp; B){\n    if(dcmp(A.x-B.x) == 0 &amp;&amp; dcmp(A.y-B.y) == 0)\n        return true;\n    return false;\n}\né•¿åº¦double Length(pt A){\n    return mySqrt(Dot(A, A));\n}\n\ndouble Length(pt A){\n    return mySqrt(Dot(A, A));\n}\n\n","slug":"ComputationalGeometry","date":"2021-04-13T04:23:08.000Z","categories_index":"notes","tags_index":"Algorithm,ACM,Computational Geometry","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"a6bba6665e00ecf0e71f128b79f675d3","title":"è®­ç»ƒç¬”è®° - æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡","content":"ç¬¬ä¸€ç«  æ¦‚ç‡è®ºåŸºæœ¬æ¦‚å¿µ4. äº‹ä»¶ç‹¬ç«‹æ€§è‹¥äº‹ä»¶å’Œäº‹ä»¶ç›¸äº’ç‹¬ç«‹ï¼Œåˆ™äº‹ä»¶å’Œäº‹ä»¶ï¼Œäº‹ä»¶å’Œäº‹ä»¶ï¼Œäº‹ä»¶å’Œäº‹ä»¶ä¹Ÿç›¸äº’ç‹¬ç«‹ï¼Œè‹¥ä¸‰ä¸ªäº‹ä»¶ç›¸äº’ç‹¬ç«‹ï¼Œåˆ™\n5. å…¨æ¦‚ç‡åŠè´å¶æ–¯å…¬å¼5.1 å…¨æ¦‚ç‡å…¬å¼å…¨æ¦‚ç‡å…¬å¼ä¸ºï¼š\n$$P(A) = \\sum^{n}{i=1} {P(AB{i})} = \\sum^{n}{i=1} {P(A|B{i})P(B_{i})}$$\nå³ï¼Œå½“æ‰€æ±‚äº‹ä»¶Aå¯ä»¥åˆ†æˆå¯æ•°ç§æƒ…å†µæ—¶ï¼Œäº‹ä»¶Aå‘ç”Ÿçš„æ¦‚ç‡å°±æ˜¯è¿™äº›æƒ…å†µå¯¹åº”æ¦‚ç‡ä¹‹å’Œ\n5.2 è´å¶æ–¯å…¬å¼è´å¶æ–¯å…¬å¼ä¸ºï¼š\n$$P(B_{i} | A) = \\frac{P(B_{i}A)}{P(A)} = \\frac{P(A|B_{i})P(B_{i})}{ \\sum^{n}{j=1}{P(A|B{j})P(B_{j})}}$$\nå³ï¼Œè‹¥å·²çŸ¥ç»“æœAå‘ç”Ÿäº†ï¼Œè¦åˆ¤æ–­æ˜¯é‚£ç§æƒ…å†µæ˜¯ï¼Œåº”å½“ä½¿ç”¨è´å¶æ–¯å…¬å¼\ne.g. è®¾å·¥å‚ç”²å’Œå·¥å‚ä¹™çš„æ¬¡å“ç‡åˆ†åˆ«æ˜¯å’Œï¼Œç°åœ¨ä»ç”²å·¥å‚å’Œä¹™å·¥å‚çš„äº§å“åˆ†åˆ«å å’Œçš„ä¸€æ‰¹äº§å“ä¸­éšæœºæŠ½å–ä¸€ä»¶ï¼Œæ±‚: (1)è¿™ä»¶äº§å“æ˜¯æ¬¡å“çš„æ¦‚ç‡ (2)è¯¥æ¬¡å“æ˜¯ç”±å‡å·¥å‚ç”Ÿäº§çš„æ¦‚ç‡\nans. \nè§£ï¼š\nè®¾äº‹ä»¶ä¸ºæŠ½å–çš„æ˜¯æ¬¡å“ï¼Œäº‹ä»¶ä¸ºè¯¥æ¬¡å“æ¥è‡ªç”²å‚ï¼Œè¡¨ç¤ºè¯¥äº§å“æ¥è‡ªä¹™å‚ï¼Œåˆ™\n\n(1) ç”±å…¨æ¦‚ç‡å…¬å¼å¯çŸ¥\n\n(2) ç”±è´å¶æ–¯å…¬å¼å¯çŸ¥\n\nç¬¬ä¸€ç«  æ¦‚ç‡è®ºåŸºæœ¬æ¦‚å¿µ1. éšæœºäº‹ä»¶ä¸æ ·æœ¬ç©ºé—´2. äº‹ä»¶æ¦‚ç‡3. è¿ç®—æ³•åˆ™4. äº‹ä»¶ç‹¬ç«‹æ€§$$\\begin{aligned}\n  äº‹ä»¶Aå’Œäº‹ä»¶Bç‹¬ç«‹ &amp;\\Longleftrightarrow P(AB) = P(A)P(B) \\\n  &amp;\\Longleftrightarrow P(B) = P(B|A) (P(A) &gt; 0)\\\n  &amp;\\Longleftrightarrow P(B|A) = P(B|\\overline{A}) (0 &lt; P(A) &lt; 1)\n\\end{aligned}$$\nè‹¥äº‹ä»¶å’Œäº‹ä»¶ç›¸äº’ç‹¬ç«‹ï¼Œåˆ™äº‹ä»¶å’Œäº‹ä»¶ï¼Œäº‹ä»¶å’Œäº‹ä»¶ï¼Œäº‹ä»¶å’Œäº‹ä»¶ä¹Ÿç›¸äº’ç‹¬ç«‹ï¼Œè‹¥ä¸‰ä¸ªäº‹ä»¶ç›¸äº’ç‹¬ç«‹ï¼Œåˆ™\n5. å…¨æ¦‚ç‡åŠè´å¶æ–¯å…¬å¼5.1 å…¨æ¦‚ç‡å…¬å¼å…¨æ¦‚ç‡å…¬å¼ä¸ºï¼š\n$$P(A) = \\sum^{n}{i=1} {P(AB{i})} = \\sum^{n}{i=1} {P(A|B{i})P(B_{i})}$$\nå³ï¼Œå½“æ‰€æ±‚äº‹ä»¶Aå¯ä»¥åˆ†æˆå¯æ•°ç§æƒ…å†µæ—¶ï¼Œäº‹ä»¶Aå‘ç”Ÿçš„æ¦‚ç‡å°±æ˜¯è¿™äº›æƒ…å†µå¯¹åº”æ¦‚ç‡ä¹‹å’Œ\n5.2 è´å¶æ–¯å…¬å¼è´å¶æ–¯å…¬å¼ä¸ºï¼š\n$$P(B_{i} | A) = \\frac{P(B_{i}A)}{P(A)} = \\frac{P(A|B_{i})P(B_{i})}{ \\sum^{n}{j=1}{P(A|B{j})P(B_{j})}}$$\nå³ï¼Œè‹¥å·²çŸ¥ç»“æœAå‘ç”Ÿäº†ï¼Œè¦åˆ¤æ–­æ˜¯é‚£ç§æƒ…å†µæ˜¯ï¼Œåº”å½“ä½¿ç”¨è´å¶æ–¯å…¬å¼\ne.g. è®¾å·¥å‚ç”²å’Œå·¥å‚ä¹™çš„æ¬¡å“ç‡åˆ†åˆ«æ˜¯å’Œï¼Œç°åœ¨ä»ç”²å·¥å‚å’Œä¹™å·¥å‚çš„äº§å“åˆ†åˆ«å å’Œçš„ä¸€æ‰¹äº§å“ä¸­éšæœºæŠ½å–ä¸€ä»¶ï¼Œæ±‚: (1)è¿™ä»¶äº§å“æ˜¯æ¬¡å“çš„æ¦‚ç‡ (2)è¯¥æ¬¡å“æ˜¯ç”±å‡å·¥å‚ç”Ÿäº§çš„æ¦‚ç‡\nans. \nè§£ï¼š\nè®¾äº‹ä»¶ä¸ºæŠ½å–çš„æ˜¯æ¬¡å“ï¼Œäº‹ä»¶ä¸ºè¯¥æ¬¡å“æ¥è‡ªç”²å‚ï¼Œè¡¨ç¤ºè¯¥äº§å“æ¥è‡ªä¹™å‚ï¼Œåˆ™(1) ç”±å…¨æ¦‚ç‡å…¬å¼å¯çŸ¥(2) ç”±è´å¶æ–¯å…¬å¼å¯çŸ¥\nç¬¬äºŒç«  éšæœºå˜é‡åŠå…¶åˆ†å¸ƒ1. åŸºæœ¬æ¦‚å¿µ1.1 åˆ†å¸ƒå‡½æ•°\nåˆ†å¸ƒå‡½æ•°\n\nåˆ†å¸ƒå‡½æ•°çš„å››ä¸ªç‰¹å¾\n\n\nå•è°ƒä¸å‡\nå³è¿ç»­\n\n\n\nåˆ†å¸ƒå‡½æ•°çš„å››ä¸ªæ€§è´¨\n\n\n\n\n\n\n\n\n1.2 åˆ†å¸ƒå¾‹\nåˆ†å¸ƒå¾‹ï¼Œä»…é€‚ç”¨äºç¦»æ•£å‹å˜é‡\n\n\n\n\n\n1.3 æ¦‚ç‡å¯†åº¦å‡½æ•°\næ¦‚ç‡å¯†åº¦å‡½æ•°ï¼Œä»…é€‚ç”¨äºè¿ç»­å‹å˜é‡\n\n\n\n\n\n\n2. å¸¸è§éšæœºå˜é‡åˆ†å¸ƒ2.1 ç¦»æ•£å‹éšæœºå˜é‡\n0-1åˆ†å¸ƒ\näºŒé¡¹åˆ†å¸ƒ\nåˆ†å¸ƒå¾‹è¡¨è¾¾å¼ï¼š \n\n\næ³Šæ¾åˆ†å¸ƒ\nåˆ†å¸ƒå¾‹è¡¨è¾¾å¼ï¼š \n\n\nè¶…å‡ ä½•åˆ†å¸ƒ\nåˆ†å¸ƒå¾‹è¡¨è¾¾å¼ï¼š \n\n\n\n2.2 è¿ç»­å‹éšæœºå˜é‡\nå‡åŒ€åˆ†å¸ƒ\næ¦‚ç‡å¯†åº¦å‡½æ•°è¡¨è¾¾å¼ï¼š å…¶ä»–\n\n\næŒ‡æ•°åˆ†å¸ƒ\næ¦‚ç‡å¯†åº¦å‡½æ•°è¡¨è¾¾å¼ï¼š \n\n\næ­£æ€åˆ†å¸ƒ\næ¦‚ç‡å¯†åº¦å‡½æ•°è¡¨è¾¾å¼ï¼š \nï¼Œæœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œå…¶æ¦‚ç‡å¯†åº¦å‡½æ•°è¡¨è¾¾å¼ä¸ºï¼šï¼Œå…¶åˆ†å¸ƒå‡½æ•°ä¸ºï¼š\næ­£æ€åˆ†å¸ƒå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š\n\næ­£æ€åˆ†å¸ƒå¯†åº¦å‡½æ•°å…³äºå¯¹ç§°ï¼Œå³\nè‹¥ï¼Œåˆ™ï¼Œ==è¿™ä¸ªæ€§è´¨éå¸¸é‡è¦==\nè‹¥ï¼Œåˆ™\n\n\n\n\n\n3. éšæœºå˜é‡çš„å˜æ¢3.1 ç¦»æ•£å‹éšæœºå˜é‡e.g. è®¾æœä»ä¸‹è¿°åˆ†å¸ƒå¾‹ï¼Œæ±‚è§£çš„åˆ†å¸ƒå¾‹\n\n\n\n\n0\n1\n2\n3\n\n\n\n\n0.5\n0.2\n0.15\n0.15\n\n\nans.\nå°†çš„å–å€¼åˆ†åˆ«å¸¦å…¥å’Œï¼Œå¯ä»¥è®¡ç®—å‡ºå®ƒä»¬çš„åˆ†å¸ƒå¾‹ä¸ºï¼š\n\n\n\n\n1\n3\n5\n7\n\n\n\n\n0\n1\n4\n9\n\n\n\n0.5\n0.2\n0.15\n0.15\n\n\n3.2 è¿ç»­å‹éšæœºå˜é‡==TODOâ€¦==\n\n\n\n\n\n\n\n\n\nhttps://zhuanlan.zhihu.com/p/268870366\nCtrl+F: è¿ç»­å‹éšæœºå˜é‡çš„é¢˜ç›®ç›¸å¯¹éº»çƒ¦ä¸€ç‚¹ï¼Œæœ‰çš„çœ‹è¿‡ä¹¦çš„åŒå­¦åº”è¯¥çŸ¥é“ä¹¦ä¸Šç»™å‡ºäº†å‡ ä¸ªå…¬å¼ç”¨äºè®¡ç®—è¿ç»­å‹éšæœºå˜é‡å˜æ¢çš„é¢˜ç›®ï¼Œä½†æ˜¯ä¸ªäººä¸å»ºè®®å»æ­»è®°ç¡¬èƒŒé‚£äº›å…¬å¼ï¼Œæ•°å­¦å·²ç„¶æœ‰å¾ˆå¤šå…¬å¼è¦èƒŒäº†ï¼Œèƒ½å°‘ä¸€ä¸ªæ˜¯ä¸€ä¸ªï¼Œæ¥ä¸‹æ¥é‡ç‚¹æ¥äº†ï¼š\nç¬¬ä¸‰ç«  å¤šç»´éšæœºå˜é‡åŠå…¶åˆ†å¸ƒå‰ç½®ï¼šäºŒé‡ç§¯åˆ†\n==TODOâ€¦==\n\n\n\n\n\n\n\n\n\nå¤ä¹ é«˜ç­‰æ•°å­¦ï¼Œå¦‚ä½•è¿›è¡ŒäºŒé‡ç§¯åˆ†\n1. åŸºæœ¬æ¦‚å¿µ1.1 åˆ†å¸ƒå‡½æ•°\nè”åˆåˆ†å¸ƒå‡½æ•°\n\nè®¾ä¸ºäºŒç»´éšæœºå˜é‡ï¼Œåˆ™ç§°ä¸ºéšæœºå˜é‡çš„è”åˆåˆ†å¸ƒå‡½æ•°\nè”åˆåˆ†å¸ƒå‡½æ•°å…·æœ‰ä»¥ä¸‹åŸºæœ¬ç‰¹å¾ä¸æ€§è´¨\n\nå…³äºå•è°ƒä¸å‡\nå…³äºæˆ–è€…éƒ½æ˜¯å³è¿ç»­\n\n\n\n\n\nè¾¹ç¼˜åˆ†å¸ƒå‡½æ•°\n\nè¾¹ç¼˜åˆ†å¸ƒå‡½æ•°å³ä¸€ç»´éšæœºå˜é‡çš„åˆ†å¸ƒå‡½æ•°ï¼Œåœ¨è®¡ç®—æŸä¸ªå˜é‡çš„è¾¹ç¼˜åˆ†å¸ƒæ—¶ï¼Œéœ€è¦è€ƒè™‘å¦ä¸€ä¸ªå˜é‡çš„æ‰€æœ‰å–å€¼æƒ…å†µï¼š\n\n\n\n1.2 åˆ†å¸ƒå¾‹\nè”åˆåˆ†å¸ƒç‡\nè”åˆåˆ†å¸ƒç‡æ˜¯äºŒç»´ç¦»æ•£å‹éšæœºå˜é‡çš„åˆ†å¸ƒå¾‹ï¼Œå…¶è¡¨è¾¾å¼ä¸ºï¼š\näºŒç»´è”åˆåˆ†å¸ƒå¾‹æ»¡è¶³\n\n\nè¾¹ç¼˜åˆ†å¸ƒå¾‹\nè¾¹ç¼˜åˆ†å¸ƒå¾‹æ˜¯ä»¥ä¸ºéšæœºæ¯”é‚£é‡çš„åˆ†å¸ƒå¾‹ï¼Œåˆ©ç”¨äºŒç»´åˆ†å¸ƒç‡è®¡ç®—ä¸€ç»´å˜é‡çš„åˆ†å¸ƒå¾‹ï¼š\n\n\n\ne.g. ä»¥ä¸‹æ˜¯çš„è”åˆåˆ†å¸ƒå¾‹ï¼Œæ±‚è§£è¾¹ç¼˜åˆ†å¸ƒå¾‹\n\n\n\n\n\n\n\n\n\n\n0.4\n0.2\n\n\n\n0.1\na\n\n\nans.\næ˜“çŸ¥ï¼Œï¼Œåˆ™å¾—\nåˆ™çš„è¾¹ç¼˜åˆ†å¸ƒå¾‹ä¸ºï¼šçš„è¾¹ç¼˜åˆ†å¸ƒå¾‹ä¸ºï¼š\n1.3 æ¦‚ç‡å¯†åº¦å‡½æ•°\nè”åˆæ¦‚ç‡å¯†åº¦å‡½æ•°\nè®¾çš„è”åˆåˆ†å¸ƒå‡½æ•°ä¸ºï¼Œè‹¥å­˜åœ¨éè´Ÿä½¿å¾—ï¼Œåˆ™ç§°ä¸ºå˜é‡çš„è”åˆæ¦‚ç‡å¯†åº¦å‡½æ•°\nè”åˆæ¦‚ç‡å¯†åº¦å‡½æ•°æ»¡è¶³\n\n\nè¾¹ç¼˜æ¦‚ç‡å¯†åº¦å‡½æ•°\nè¾¹ç¼˜æ¦‚ç‡å¯†åº¦å‡½æ•°æ˜¯ä¸€ç»´éšæœºå˜é‡çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼Œåˆ©ç”¨äºŒç»´æ¦‚ç‡å¯†åº¦å‡½æ•°è¿›è¡Œè®¡ç®—ï¼Œåœ¨è®¡ç®—æŸä¸ªå˜é‡çš„å¯†åº¦å‡½æ•°æ—¶ï¼Œéœ€è¦å¯¹å¦ä¸€ä¸ªå˜é‡çš„æ‰€æœ‰æƒ…å†µè¿›è¡Œç§¯åˆ†ï¼š\n\n\n\ne.g. è®¡ç®—ä¸‹åˆ—æ¦‚ç‡å¯†åº¦å‡½æ•°çš„å€¼ï¼ŒåŠè¾¹ç¼˜å¯†åº¦å‡½æ•°å…¶ä»–ans.\n(1) æ±‚è§£çš„å€¼ï¼šå¾—\n(2) æ±‚è§£è¾¹ç¼˜å¯†åº¦å‡½æ•°\n1.4 æ¡ä»¶åˆ†å¸ƒå‡½æ•°æ¡ä»¶åˆ†å¸ƒçš„åŸºæœ¬å…¬å¼ä¸ºï¼š\n\nç¦»æ•£å‹æ¡ä»¶åˆ†å¸ƒå‡½æ•°\n\nè®¾ï¼Œåœ¨äº‹ä»¶å‘ç”Ÿçš„æƒ…å†µä¸‹ï¼Œäº‹ä»¶å‘ç”Ÿçš„æ¡ä»¶æ¦‚ç‡ä¸ºï¼š    åŒç†ï¼Œæ±‚æ•‘çš„æ¡ä»¶æ¦‚ç‡æ—¶æœ‰å¦‚ä¸‹å…¬å¼ï¼š  \n\n\nè¿ç»­å‹æ¡ä»¶åˆ†å¸ƒ\n\nè®¾ï¼Œåˆ™åœ¨çš„æ¡ä»¶ä¸‹ï¼Œçš„æ¡ä»¶æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸ºï¼š\nè®¾ï¼Œåˆ™åœ¨çš„æ¡ä»¶ä¸‹ï¼Œçš„æ¡ä»¶æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸ºï¼š\n\n\n\n2. äºŒç»´éšæœºå˜é‡å‡½æ•°åˆ†å¸ƒ2.1 äºŒç»´å‡åŒ€åˆ†å¸ƒ\näºŒç»´å‡åŒ€åˆ†å¸ƒçš„è”åˆå¯†åº¦è¡¨è¾¾å¼ä¸ºï¼š    å…¶ä¸­æ˜¯åŒºåŸŸçš„é¢ç§¯\n\ne.g. æœä»åŒºåŸŸä¸Šçš„å‡åŒ€åˆ†å¸ƒï¼Œä¸ºï¼Œæ±‚è§£\nans.\nç”±é¢˜æ„å¾—ï¼šæ‰€ä»¥\n2.2 äºŒç»´æ­£æ€åˆ†å¸ƒ\näºŒç»´æ­£æ€åˆ†å¸ƒçš„è”åˆå¯†åº¦è¡¨è¾¾å¼å¦‚ä¸‹ï¼š  \n\nè‹¥äºŒç»´æ­£æ€åˆ†å¸ƒä¸ºï¼Œåˆ™ï¼Œå…¶ä¸­ï¼Œæ˜¯ä¸¤ä¸ªå˜é‡çš„ç›¸å…³ç³»æ•°\n\n\n3. éšæœºå˜é‡çš„ç‹¬ç«‹æ€§TODOâ€¦\n\n\n\n\n\n\n\n\n\nçŸ¥ä¹ä¸“æ æ²¡æœ‰è®²æ¸…æ¥š\nç¬¬å…­ç«  æ•°ç†ç»Ÿè®¡åŸºæœ¬æ¦‚å¿µ1. åŸºæœ¬æ¦‚å¿µ1.1 ç»Ÿè®¡é‡\nç»Ÿè®¡é‡æ˜¯æ ·æœ¬çš„æ— å‚å‡½æ•°ï¼Œå³ä¸å«ä»»ä½•æœªçŸ¥æ•°çš„æ ·æœ¬å‡½æ•°\n\n2. æ ·æœ¬å¸¸ç”¨ç»Ÿè®¡é‡2.1 æ ·æœ¬å‡å€¼\næ ·æœ¬å‡å€¼è¡¨ç¤ºä¸ºï¼š\n\n2.2 æ ·æœ¬æ–¹å·®\næ ·æœ¬æ–¹å·®è¡¨ç¤ºä¸ºï¼š \n\n\n\n\n\n\n\n\n\n\n[é—®] ä¸ºä»€ä¹ˆæ ·æœ¬æ–¹å·®çš„åˆ†æ¯æ˜¯?\n[ç­”] å‚è€ƒçŸ¥ä¹å›ç­”ä¸ºä»€ä¹ˆæ ·æœ¬æ–¹å·®ï¼ˆsample varianceï¼‰çš„åˆ†æ¯æ˜¯ n-1ï¼Ÿ\n2.3 æ ·æœ¬ké˜¶åŸç‚¹çŸ©\næ ·æœ¬ké˜¶åŸç‚¹çŸ©è¡¨ç¤ºä¸ºï¼š ï¼Œå…¶ä¸­ï¼Œæ ·æœ¬å‡å€¼ä¸ºä¸€é˜¶åŸç‚¹çŸ©\n\n2.4 æ ·æœ¬çš„ké˜¶ä¸­å¿ƒçŸ©\næ ·æœ¬çš„ké˜¶ä¸­å¿ƒçŸ©è¡¨ç¤ºä¸ºï¼š \n\n4. å¸¸ç”¨çš„ç»Ÿè®¡åˆ†å¸ƒæ€§è´¨ä»¥ä¸‹ä¸ºå¸¸ç”¨çš„å…­ä¸ªç»Ÿè®¡åˆ†å¸ƒæ€§è´¨ï¼š\nè®¾æ€»ä½“ï¼Œæ˜¯æ¥è‡ªæ­£æ€æ€»ä½“çš„ç®€å•æ ·æœ¬ï¼Œåˆ™\n\n\n\n\n\n\nä¸ç›¸äº’ç‹¬ç«‹\n\n","slug":"MathematicalStatistics","date":"2021-04-09T10:54:20.000Z","categories_index":"notes","tags_index":"Algorithm,ACM,Mathematical Statistics","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"0e67ea3c9c88de3508878bdcc5b54c50","title":"è®­ç»ƒç¬”è®° - æ•°è®ºä¸æ•°å­¦","content":"æ•°è®ºæ¿å—1. è£´èœ€å¼•ç†é¢„å¤‡çŸ¥è¯†ï¼š\n\nçº¦æ•°å’Œå€æ•°: å¦‚æœä¸€ä¸ªæ•´æ•°èƒ½å¤Ÿè¢«æ­£æ•´æ•°æ•´é™¤ï¼Œåˆ™å­˜åœ¨å¦ä¸€ä¸ªæ•´æ•°ä½¿å¾—æˆ–è€…ã€‚ç§°æ˜¯çš„çº¦æ•°æˆ–å› æ•°ï¼Œæ˜¯çš„å€æ•°ã€‚æ­£æ•´æ•°çš„ä¸¤ä¸ªå€æ•°çš„å’Œæˆ–è€…å·®ä»ç„¶æ˜¯çš„å€æ•°ã€‚\nå…¬çº¦æ•°å’Œæœ€å¤§å…¬çº¦æ•°: å¦‚æœæ­£æ•´æ•°åŒæ—¶æ˜¯ä¸¤ä¸ªæ•´æ•°ï¼Œçš„çº¦æ•°ï¼Œç§°ä¸ºå’Œçš„å…¬çº¦æ•°ï¼Œå’Œæ‰€æœ‰å…¬çº¦æ•°ä¸­æœ€å¤§çš„æ•°ç§°ä¸ºæœ€å¤§å…¬çº¦æ•°ã€‚æ˜¯æ‰€æœ‰æ•°çš„å€æ•°ã€‚æ‰€æœ‰çš„æ­£æ•´æ•°éƒ½æ˜¯çš„çº¦æ•°ã€‚\nå¸¦ä½™é™¤æ³•: ç»™å®šä¸€ä¸ªæ•´æ•°å’Œä¸€ä¸ªæ•´æ•°ï¼Œæ€»èƒ½æ‰¾åˆ°ä¸€ä¸ªæ•´æ•°ä½¿å¾—ï¼Œå…¶ä¸­ï¼Œç§°ä¸ºè¢«é™¤çš„ä½™æ•°ã€‚æ€»èƒ½çš„è¯æ˜: ç”»æ•°è½´ï¼Œä¸ºå•ä½ï¼Œæ€»èƒ½è½åœ¨æ•°è½´ä¸Š\nç´ æ•°: ä¸€ä¸ªå¤§äºçš„æ­£æ•´æ•°ï¼Œå¦‚æœåªæœ‰å’Œå®ƒæœ¬èº«ä¸¤ä¸ªçº¦æ•°ï¼Œå°±ç§°å®ƒä¸ºç´ æ•°ã€‚  ä¸¤ä¸ªæ•´æ•°çš„æœ€å¤§å…¬çº¦æ•°å¦‚æœä¸ºï¼Œåˆ™ç§°è¿™ä¸¤ä¸ªæ•°äº’ç´ ã€‚\n\nè£´èœ€å¼•ç†ï¼š ç»™å®šä¸¤ä¸ªæ•´æ•°å’Œï¼Œå‡è®¾ä»–ä»¬çš„æœ€å¤§å…¬çº¦æ•°æ˜¯ï¼Œå½“ä¸”ä»…å½“æ˜¯çš„å€æ•°æ—¶ï¼Œä¸‹åˆ—æ–¹ç¨‹æœ‰æ•´æ•°è§£:\nè¯æ˜ï¼š\n(1) è‹¥ï¼Œåˆ™. è¿™æ—¶å®šç†æ˜¾ç„¶æˆç«‹ã€‚\n(2) è‹¥ä¸ç­‰äºï¼š\nè®°, å¯¹ï¼Œä¸¤è¾¹åŒæ—¶é™¤ä»¥ï¼Œå¯å¾—ï¼Œå…¶ä¸­ã€‚\nè½¬è¯ã€‚ç”±å¸¦ä½™é™¤æ³•:\næ‰€ä»¥ï¼Œç”±å’Œæ¨å‡º\n\nå†ç»“åˆæ¨å‡º\n\nå†ç»“åˆæ¨å‡º\n\n\nå†ç»“åˆæ¨å‡º\n\nå†ç»“åˆæ¨å‡º\n\nå†ç»“åˆæ¨å‡º\n\nè¯æ˜å®Œæ¯•ã€‚\næ¨è®º\n\nå½“ä¸”ä»…å½“ä¸‹é¢æ–¹ç¨‹æœ‰æ•´æ•°è§£æ—¶ï¼Œä¸¤ä¸ªæ•´æ•°å’Œäº’ç´ ï¼š\nå¦‚æœç´ æ•°æ•´é™¤ä¸¤ä¸ªæ•´æ•°å’Œçš„ä¹˜ç§¯ï¼Œåˆ™å¿…ç„¶ä¼šæ•´é™¤æˆ–\n\n2. è¾—è½¬ç›¸é™¤æ³•è¾—è½¬ç›¸é™¤æ³•æ˜¯æ±‚ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°çš„ç®—æ³•ã€‚\nè¾—è½¬ç›¸é™¤æ³•æ˜¯æ±‚ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°çš„ç®—æ³•ï¼Œå¯¹äºè€Œè¨€ï¼Œå…¶æœ‰ä»¥ä¸‹æ­¥éª¤:\n\næ±‚\nä»¤ï¼Œé‡å¤æ­¥éª¤\nå½“æ—¶ï¼Œä¸ºæ‰€æ±‚æœ€å¤§å…¬çº¦æ•°\n\nä½¿ç”¨è¾—è½¬ç›¸é™¤æ³•æ—¶ï¼Œå…¶æ­¥éª¤å¦‚ä¸‹ï¼Œä»¥æ±‚å’Œçš„æœ€å¤§å…¬çº¦æ•°ä¸ºä¾‹ï¼š\n\næ­¤æ—¶æ±‚å¾—å’Œçš„æœ€å¤§å…¬çº¦æ•°ä¸ºã€‚\nè¾—è½¬ç›¸é™¤æ³•(æ¬§å‡ é‡Œå¾—ç®—æ³•)çš„C++å®ç°å¦‚ä¸‹ï¼š\n/**\n * @description: æ¬§å‡ é‡Œå¾—ç®—æ³•çš„é€’å½’å®ç°\n * @param {int} a æ±‚æœ€å¤§å…¬çº¦æ•°çš„æŸæ•°\n * @param {int} b æ±‚æœ€å¤§å…¬çº¦æ•°çš„æŸæ•°\n * @return {int} æ±‚å¾—çš„æœ€å¤§å…¬çº¦æ•°\n */\nint gcd(int a, int b) \n{\n    return b ? gcd(b, a % b) : a;\n}\n\n/**\n * @description: æ¬§å‡ é‡Œå¾—ç®—æ³•çš„å¾ªç¯å®ç°\n * @param {int} a æ±‚æœ€å¤§å…¬çº¦æ•°çš„æŸæ•°\n * @param {int} b æ±‚æœ€å¤§å…¬çº¦æ•°çš„æŸæ•°\n * @return {int} æ±‚å¾—çš„æœ€å¤§å…¬çº¦æ•°\n */\nint gcd(int a, int b) \n{\n    int c = a % b;\n    while (c != 0) \n    {\n        a = b;\n        b = c;\n        c = a % b; \n    }\n    return b;\n}\n\n3. ç®—æœ¯åŸºæœ¬å®šç†ç®—æœ¯åŸºæœ¬å®šç†ï¼š å¦‚æœä¸è€ƒè™‘æ’åˆ—æ¬¡åºçš„è¯ï¼Œæ¯ä¸ªå¤§äº1çš„è‡ªç„¶æ•°éƒ½åªèƒ½æœ‰ä¸€ç§æ–¹å¼åˆ†è§£æˆè‹¥å¹²ä¸ªç´ æ•°çš„ä¹˜ç§¯ã€‚\nå¯ä»¥ç†è§£ä¸ºï¼š\n\nå­˜åœ¨æ€§ï¼š æ¯ä¸ªå¤§äºçš„è‡ªç„¶æ•°éƒ½å¯ä»¥åˆ†è§£æˆç´ æ•°çš„ä¹˜ç§¯\nå”¯ä¸€æ€§ï¼š è¿™ç§åˆ†è§£ä¸è€ƒè™‘æ¬¡åºæ’åˆ—çš„æ„ä¹‰ä¸‹æ˜¯å”¯ä¸€çš„\n\nè¯æ˜ï¼š\nè‹¥æ˜¯ç´ æ•°ï¼Œåˆ™ã€‚è‹¥æ˜¯åˆæ•°ï¼Œåˆ™ï¼Œå¯¹é‡å¤ä¸Šè¿‡ç¨‹ï¼Œå¯å¾—ç´ æ•°é›†ã€‚\nåˆ™ä»»æ„ï¼Œå‡å¯ä»¥åˆ†è§£æˆç´ æ•°çš„ä¹˜ç§¯ï¼Œè¯å¾—å­˜åœ¨æ€§ã€‚\nè®¾\n\nåˆ™ï¼Œå³ã€‚\nåˆç´ æ•°é›†ï¼Œåˆ™å½“æ—¶ï¼Œã€‚\næ‰€ä»¥å¿…å®šæœ‰ï¼Œæ‰èƒ½ä½¿å¾—ã€‚\nä»¤ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œå¯ä»¥å¾—çŸ¥å¯¹äºä»»æ„ï¼Œå¿…ç„¶æœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”ã€‚\næ‰€ä»¥å¿…ç„¶æœ‰ä¸€ç§æ’åˆ—ä½¿å¾—ï¼Œå³åœ¨ä¸è€ƒè™‘æ’åˆ—çš„æƒ…å†µä¸‹ï¼Œè¿™ç§åˆ†è§£æ˜¯å”¯ä¸€çš„ï¼Œå”¯ä¸€æ€§å¾—è¯ã€‚\nè¯æ˜å®Œæ¯•ã€‚\n4. æœ€å¤§å…¬çº¦æ•°ä¸æœ€å°å…¬å€æ•°çš„å…³ç³»å¦‚æœæ­£æ•´æ•°åŒæ—¶æ˜¯ä¸¤ä¸ªæ•´æ•°ï¼Œçš„çº¦æ•°ï¼Œç§°ä¸ºå’Œçš„å…¬çº¦æ•°ï¼Œå’Œæ‰€æœ‰å…¬çº¦æ•°ä¸­æœ€å¤§çš„æ•°ç§°ä¸ºæœ€å¤§å…¬çº¦æ•°ï¼Œè®°ä½œã€‚\nå¦‚æœæ­£æ•´æ•°åŒæ—¶æ˜¯ä¸¤ä¸ªæ•´æ•°çš„å€æ•°ï¼Œç§°ä¸ºå’Œçš„å…¬å€æ•°ï¼Œå’Œæ‰€æœ‰å…¬å€æ•°ä¸­æœ€å°çš„æ•°ç§°æœ€å°å…¬å€æ•°ï¼Œè®°ä½œã€‚\næœ€å¤§å…¬çº¦æ•°ä¸æœ€å°å…¬å€æ•°çš„å…³ç³»ï¼š å¯¹äºä»»æ„çš„æ­£æ•´æ•°ï¼Œå…¶æœ€å¤§å…¬çº¦æ•°ä¸æœ€å°å…¬å€æ•°æ»¡è¶³ä¸‹è¿°å…³ç³»ï¼š\n\nè¯æ˜ï¼š\nè‹¥ä¸­æŸæ•°ç­‰äºï¼Œæ»¡è¶³ä¸Šè¿°å…³ç³»ã€‚\nå·²çŸ¥ä»»æ„å¤§äºä¸€çš„æ•´æ•°éƒ½å¯ä»¥è¡¨ç¤ºä¸ºè‹¥å¹²ä¸ªç´ æ•°çš„ä¹˜ç§¯ï¼Œåˆ™å¯¹äºï¼š\n\nå…¶ä¸­ç´ æ•°é›†ï¼Œæ‰€ä»¥çš„æœ€å¤§å…¬çº¦æ•°å¯ä»¥è¡¨ç¤ºä¸ºï¼š\n\nçš„æœ€å°å…¬å€æ•°å¯ä»¥è¡¨ç¤ºä¸ºï¼š\n\nè€Œå¯¹äºä»»æ„ï¼Œéƒ½æœ‰æ’æˆç«‹ã€‚\nåˆ™æœ‰ï¼š\n\nè¯æ˜å®Œæ¯•ã€‚\n5. ç´ æ•°5.0 ä»¥å†…çš„ç´ æ•°æœ‰å‡ ä¸ªç´ æ•°è®¡ç®—å‡½æ•°ï¼š\nå°äºæˆ–ç­‰äºçš„ç´ æ•°çš„ä¸ªæ•°ï¼Œå¯ä»¥ç”¨è¡¨ç¤ºï¼Œæœ‰ï¼š\n\nåœ¨æ—¶ï¼Œæ­¤å‡½æ•°çš„è¯¯å·®å·²ç»å°äºäº†ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨æ­¤å‡½æ•°ä¼°è®¡ç´ æ•°çš„ä¸ªæ•°ã€‚\n5.1 å¦‚ä½•åˆ¤æ–­ç´ æ•°å¤æ‚åº¦ç®—æ³•ï¼š\nåˆ¤æ–­ä¸€ä¸ªå¤§äºçš„æ•´æ•°æ˜¯å¦ä¸ºç´ æ•°ï¼Œæœ€ç®€å•çš„æ–¹æ³•ä¾¿æ˜¯æ ¹æ®ç´ æ•°çš„å®šä¹‰å»åˆ¤æ–­ï¼Œå³ä½¿ç”¨ä»åˆ°ä¹‹é—´çš„æ‰€æœ‰æ•´æ•°ä¸åšé™¤æ³•ï¼Œçœ‹èƒ½å¦ä¸æ•´é™¤ï¼Œå…¶ä»£ç å®ç°å¦‚ä¸‹ï¼š\nbool isPrime(int n) \n{\n\tfor (int i = 2; i &lt; n; ++i)\n\t{\n\t\tif (n % i == 0) \n\t\t{\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\nå¤æ‚åº¦ç®—æ³•ï¼š\nåœ¨ä¸Šé¢çš„ç®—æ³•ä¸­ï¼Œå…¶å®å¹¶ä¸éœ€è¦æŒ‰ç…§å®šä¹‰ä¸€ç›´åˆ¤æ–­åˆ°ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ¤æ–­ä»åˆ°ä¹‹é—´çš„æ•´æ•°å°±å¯ä»¥äº†ã€‚\nè¯æ˜ï¼š\nè‹¥ä¸æ˜¯ç´ æ•°ï¼Œåˆ™å…¶å¯ä»¥è¡¨ç¤ºä¸ºï¼Œæˆ‘ä»¬ä¸å¦¨ä»¤ã€‚\næ­¤æ—¶æˆ‘ä»¬çŸ¥é“å¯èƒ½å–å¾—æœ€å¤§å€¼æ—¶ï¼Œæœ‰ï¼Œå³ï¼Œæ­¤æ—¶ã€‚\næ‰€ä»¥ï¼Œå³è‹¥ä¸æ˜¯ç´ æ•°ï¼Œå…¶å¿…æœ‰ä¸€ä¸ªå› æ•°åœ¨åŒºé—´ã€‚\nè¯æ˜å®Œæ¯•ã€‚\nå…¶ä»£ç å®ç°è¾ƒä¸Šæ–‡å·®åˆ«ä¸å¤§ï¼Œæ­¤å¤„å°±ä¸å•ç‹¬å±•ç¤ºäº†ã€‚\n(é€‰å­¦)Fermatç´ æ€§æµ‹è¯•ï¼š\næˆ‘ä»¬å¯ä»¥æ ¹æ®è´¹é©¬å°å®šç†å¾—å‡ºä¸€ç§æ£€éªŒç´ æ•°çš„æ€è·¯ï¼š\nä¸æ–­åœ°é€‰å–åœ¨ä¸­çš„åŸºï¼Œå¹¶æ£€éªŒæ˜¯å¦æ¯æ¬¡éƒ½æœ‰ \nå…¶C++å®ç°å¦‚ä¸‹ï¼š\n/**\n * @description: è´¹é©¬ç´ æ€§æµ‹è¯•\n * @param {int} n è¦åˆ¤æ–­çš„æ•°n\n * @return {bool} næ˜¯å¦ä¸ºç´ æ•°ï¼Œæ˜¯åˆ™è¿”å›true\n */\nbool millerRabin(int n) {\n    if (n &lt; 3) \n    {\n        return n == 2;\n    }\n\n    // test_timeä¸ºæµ‹è¯•æ¬¡æ•°,å»ºè®®è®¾ä¸ºä¸å°äº8çš„æ•´æ•°ä»¥ä¿è¯æ­£ç¡®ç‡,ä½†ä¹Ÿä¸å®œè¿‡å¤§,å¦åˆ™ä¼šå½±å“æ•ˆç‡\n    for (int i = 1; i &lt;= test_time; ++i) \n    {\n        int a = rand() % (n - 2) + 2;\n        if (quickPow(a, n - 1, n) != 1) \n        {\n            return false;\n        }\n    }\n    return true;\n}\n\nä½†æ˜¯è´¹é©¬å°å®šç†çš„é€†å®šç†å¹¶ä¸æˆç«‹ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿä¸æ˜¯å®Œå…¨å‡†ç¡®çš„ï¼Œéœ€è¦é¢å¤–è€ƒè™‘Carmichael Numberã€‚è¿™ä¸ªæ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦å¤§è‡´ä¸ºã€‚\n5.2 å¦‚ä½•ç”Ÿæˆç´ æ•°åœ¨ä¸Šé¢æˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯ç´ æ•°ï¼Œé‚£ä¹ˆå¼•ç”³å‡ºäº†å¦ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¦å¦‚ä½•æ±‚æŸä¸ªåŒºé—´å†…çš„æ‰€æœ‰ç´ æ•°å‘¢ï¼Ÿ\næˆ‘ä»¬å½“ç„¶å¯ä»¥æŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•å¯¹åŒºé—´å†…æ¯ä¸€ä¸ªæ•°éƒ½è¿›è¡Œä¸€æ¬¡åˆ¤æ–­ï¼Œä½†æˆ‘ä»¬ç¨ä½œåˆ†æå°±çŸ¥é“ï¼Œåˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯ç´ æ•°çš„æ—¶é—´å¤æ‚åº¦æ˜¯ï¼Œé‚£ä¹ˆåˆ¤æ–­ä¸ªæ•°æ˜¯ä¸æ˜¯ç´ æ•°çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªååˆ†è´¹æ—¶çš„ç®—æ³•ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¼šè¢«æ¯”èµ›å¡è¶…æ—¶ã€‚\nç„¶åæˆ‘ä»¬å°±è¦è®²åˆ°æˆ‘ä»¬çš„ä¸¤å¤§æ³•å®ï¼š åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•å’Œçº¿æ€§ç­›æ³•\nåŸƒæ°ç­›\nåŸƒæ°ç­›æ³•çš„åŸºæœ¬åŸç†æ˜¯ï¼šå¦‚æœæ‰¾åˆ°ä¸€ä¸ªè´¨æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªè´¨æ•°çš„å€æ•°éƒ½ä¸æ˜¯è´¨æ•°ã€‚\næˆ‘ä»¬åªéœ€è¦å°†èŒƒå›´å†…çš„æ‰€æœ‰æ•°ä»å¤´å¼€å§‹å¹¶æ ‡è®°å‡ºä»–ä»¬çš„å€æ•°ï¼Œé‡åˆ°æ ‡è®°è¿‡çš„æ•°å°±è·³è¿‡ï¼Œç›´åˆ°æ ‡è®°åˆ°æœ€åä¸ºæ­¢ã€‚å…¶è¿‡ç¨‹è¡¨ç¤ºå¦‚ä¸‹ï¼š\n\n\nè¿™ä¸ªè¿‡ç¨‹çš„C++å®ç°å¦‚ä¸‹ï¼š\n// include &lt;cstdlib&gt;\n\n/**\n * @description: åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•\n * @param {int} n è¦æ±‚çš„ç´ æ•°åŒºé—´ï¼Œå³æ±‚[2, n]ä¹‹é—´çš„ç´ æ•°\n * @return {*} isPrimeä¸ºtrueçš„å‡ä¸ºç´ æ•°\n */\nvoid EratosthenesMethod(int n) \n{\n    bool *tag = new bool[n];\n    for (int i = 0; i &lt; n; ++i) \n    {\n        isPrime[i] = true;\n    }\n\n    for (int i = 2; i * i &lt; n; ++i) \n    {\n        if (isPrime[i]) \n        {\n            for (int j = i * i; j &lt; n; j += i) \n            {\n                isPrime[j] = false;\n            }\n        }\n    }\n}\n\nä¸Šé¢çš„ç®—æ³•å¯ä»¥é¢„å…ˆå¤„ç†æ¯ä¸ªæ•°éƒ½æœ‰çš„è´¨å› æ•°ä»¥æå‡æ•ˆç‡ã€‚å…¶å¤æ‚åº¦ä¸º\næƒ³çœ‹å…¶å¤æ‚åº¦è®¡ç®—è¿‡ç¨‹å—ï¼Ÿ\n\n\n\n\n\n\n\n\n\nå‚è€ƒè‡ªOI-Wiki.org\nå¯ä»¥ç›´æ¥è§‚å¯ŸçŸ¥åŸƒæ°ç­›æ³•çš„å¤æ‚åº¦ä¸º\n\nè°ƒå’Œçº§æ•°ï¼Œç”±å”¯ä¸€åˆ†è§£å®šç†å¯å¾—ï¼š\n\nä¸¤è¾¹åŒæ—¶å–å¯¹æ•°ï¼Œå¾—ï¼š\n\næ˜“çŸ¥ï¼Œç”±å¾®ç§¯åˆ†åŸºæœ¬å®šç†ï¼š\n\nå¾—\n\nå³\n\nç”¨æ³•è¡¨ç¤ºå³ä¸º\nçº¿æ€§ç­›\nåŸƒæ°ç­›æ³•ä»æœ‰ä¼˜åŒ–ç©ºé—´ï¼Œå®ƒä¼šå°†ä¸€ä¸ªåˆæ•°é‡å¤å¤šæ¬¡æ ‡è®°ã€‚æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•çœæ‰æ— æ„ä¹‰çš„æ­¥éª¤å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚\nå¦‚æœèƒ½è®©æ¯ä¸ªåˆæ•°éƒ½åªè¢«æ ‡è®°ä¸€æ¬¡ï¼Œé‚£ä¹ˆæ—¶é—´å¤æ‚åº¦å°±å¯ä»¥é™åˆ°äº†ã€‚\nå…¶C++ä»£ç å®ç°å¦‚ä¸‹ï¼š\n/**\n * @description: æ¬§æ‹‰ç­›æ³•\n * @param {int} n è¦æ±‚çš„nä»¥å†…çš„ç´ æ•°\n * @return {void}\n */\nvoid EulerMethod (int n) {\n\tunsigned long long *phi = new unsigned long long[n];\n\tphi[1] = 1;\n\tint cnt = 0;\n\n\tfor (int i = 2; i &lt; n; ++i) \n\t{\n\t\tif (!vis[i])\n\t\t{\n\t\t\tphi[i] = i - 1;\n\t\t\tpri[cnt++] = i;\n\t\t}\n\n\t\tfor (int j = 0; j &lt; cnt; ++j) \n\t\t{\n\t\t\tif (1ll * i * pri[j] &gt;= n) // æ­¤å¤„1llæ˜¯åœ¨è®¡ç®—æ—¶ä½¿ç”¨long longç±»å‹ï¼Œé¿å…æº¢å‡º\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tvis[i * pri[j]] = 1;\n\t\t\tif (i % pri[j]) \n\t\t\t{\n\t\t\t\tphi[i * pri[j]] = phi[i] * (pri[j] - 1);\n\t\t\t} \n\t\t\telse \n\t\t\t{\n\t\t\t\tphi[i * pri[j]] = phi[i] * pri[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n}\n\n(é€‰å­¦) min_25ç­›æ³•\nè¿™ä¸ªç­›æ³•æ˜¯min_25å¤§ä½¬åœ¨æ¯”èµ›çš„æ—¶å€™å‘æ˜çš„ç­›æ³•ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸ºï¼Œå…¶ä¸­å¾ˆå¤šå†…å®¹æˆ‘ä»¬ä¹Ÿä¸ä¼šéœ€è¦åŒå­¦ä»¬è‡ªå·±ç†è§£\n\n\n\n\n\n\n\n\n\næœ¬èŠ‚å‚è€ƒäº†å¤§é‡èµ„æ–™ï¼š\n\nSum of Multiplicative Function - min_25\nmin_25ç­› - ç§Ÿé…¥é›¨\nmin25ç­›å­¦ä¹ ç¬”è®°&amp;æ¨¡æ¿è¯¦è§£ - Flyppy_White\n\né¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€äº›ç¬¦å·å’Œè¯´æ˜ï¼š\n\nå¹¶ä¸”ç´ æ•°é›†ï¼Œæ˜¯æ‰€æœ‰ç´ æ•°ä¸­ç¬¬å°çš„ç´ æ•°ï¼Œç‰¹åˆ«å®šä¹‰\nè¡¨ç¤ºæœ€å°çš„è´¨å› æ•°ï¼Œç‰¹åˆ«å®šä¹‰\næ˜¯ä¸€ä¸ªå…³äºçš„é¡¹æ•°è¾ƒå°‘çš„å¤šé¡¹å¼æˆ–è€…å¯ä»¥å¿«é€Ÿæ±‚å€¼çš„å¤šé¡¹å¼ï¼Œéœ€è¦èƒ½å¤Ÿå¿«é€Ÿæ±‚å€¼\n\n\n\næˆ‘ä»¬ä¸éš¾çŸ¥é“ï¼Œé€šè¿‡æšä¸¾æ¯ä¸ªçš„æœ€å°è´¨å› å­åŠå…¶æ¬¡æ•°å¯ä»¥å¾—åˆ°çš„é€’æ¨å¼\n\næœ€åä¸€æ­¥æ¨å¯¼åŸºäºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼š\nå¯¹äºæ»¡è¶³çš„ï¼Œæœ‰ï¼š\n\nå³\n\nå…¶C++å®ç°ï¼Œè¯·è½¬åˆ°min25ç­›å­¦ä¹ ç¬”è®°&amp;æ¨¡æ¿è¯¦è§£ - Flyppy_White\næ•°å­¦æ¿å—1. çŸ©é˜µå¿«é€Ÿå¹‚1.1 çŸ©é˜µè¿™ä¸€ç‚¹å›å»æ‰¾çº¿æ€§ä»£æ•°è€å¸ˆã€‚\n1.2 å¿«é€Ÿå¹‚å¯¹äºä»»æ„çš„æ•°ï¼Œéƒ½å¯ä»¥é€šè¿‡ä½è¿ç®—å°†å®ƒåŒ–ä¸ºå¤šä¸ªçš„å¹‚çš„å’Œçš„å½¢å¼ã€‚\nä¾‹å¦‚:\n\nä½†æ˜¯ï¼Œå½“æŒ‡æ•°ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œå¦‚ï¼Œæˆ‘ä»¬æƒ³è¦è®¡ç®—å®ƒçš„æ—¶å€™ï¼Œå°±å¾—è®¡ç®—æ¬¡ä¹˜æ³•æ‰èƒ½å¾—å‡ºç»“æœã€‚è¿™æ ·æˆ‘ä»¬å°±å¾—ç­‰å¾ˆä¹…æ‰èƒ½è®¡ç®—å®Œæ¯•ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•èƒ½å¤ŸåŠ é€Ÿè¿™ä¸€è¿‡ç¨‹å‘¢ï¼Ÿ\näº²äº²ï¼Œæœ‰çš„ï¼è¿™ä¸ªæ–¹æ³•å°±æ˜¯å¿«é€Ÿå¹‚ï¼š\nä»¥ä¸ºä¾‹ï¼š\n\nåŒæ—¶ï¼Œæ ¹æ®å¸¸è¯† å¸¸äººæ‰€ä¸çŸ¥é“çš„çŸ¥è¯†ï¼š\n\næˆ‘ä»¬çŸ¥é“å…¶æ—¶é—´å¤æ‚åº¦ä¸ºï¼Œå¯¹äºå¼çš„å¹‚åªéœ€è¦æ¬¡ä½è¿ç®—å³å¯æ±‚å¾—ï¼š\nï¼Œ\nå³ï¼š\n\næˆ‘ä»¬å†å†ä¾æ¬¡æ±‚çš„å¹‚ï¼Œæ±‚å®Œç›¸åŠ æ¬¡æ•°å°±å˜ä¸ºäº†æ¬¡ä¹˜æ³•å’Œæ¬¡åŠ æ³•ï¼Œä¸€å…±æ¬¡è¿ç®—ã€‚ä½†å®é™…ç¼–ç¨‹ä¸­åä¸€æ¬¡è¿ç®—çš„ç»“æœå¯ä»¥ç”±å‰ä¸€æ¬¡è¿ç®—çš„ç»“æœè¿­ä»£è€Œæ¥ã€‚\nå³ï¼š\n\n\n\n\n\n\n\n\n\nç”±äºä½è¿ç®—å¸®åŠ©æˆ‘ä»¬è®¡ç®—æ˜¯å¦è¯¥å–è¯¥æ•°ï¼Œå®é™…ä¸Šè¿ç®—æ¬¡æ•°æ˜¯æ¬¡ä¹˜æ³•è¿ç®—ã€æ¬¡åŠ æ³•è¿ç®—å’Œæ¬¡ä½è¿ç®—ï¼Œä¸€å…±æ¬¡ã€‚ç”±æ¬¡è¿ç®—é™ä½ä¸ºæ¬¡è¿ç®—ï¼Œæ•ˆç‡ä¸Šå¤§å¤§æé«˜ã€‚è¿™å°±æ˜¯å¿«é€Ÿå¹‚ã€‚\nå¿«é€Ÿå¹‚çš„C++å®ç°å¦‚ä¸‹ï¼š\n/**\n * @description: å¿«é€Ÿå¹‚ï¼Œè®¡ç®—base^index\n * @param {int} base åº•æ•°\n * @param {int} index æŒ‡æ•°\n * @return {int} è®¡ç®—ç»“æœbase^index\n */\nint quick_power (int base, int index)\n{\n    int result = 1;\n    while (index)\n    {\n        if (index &amp; 1)\n        {\n            result *= base;\n        }\n        base *= base;\n        index = index &gt;&gt; 1;\n    }\n    return result;\n}\n\n1.3 çŸ©é˜µå¿«é€Ÿå¹‚ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“äº†ä»€ä¹ˆæ˜¯çŸ©é˜µï¼Œä»€ä¹ˆæ˜¯å¿«é€Ÿå¹‚ã€‚èªæ˜çš„åŒå­¦ä»¬ä¸€å®šèƒ½å¾ˆç®€å•çš„æ¨å‡ºä»€ä¹ˆæ˜¯çŸ©é˜µå¿«é€Ÿå¹‚å§ï¼\né‚£ä¹ˆä»€ä¹ˆæ˜¯çŸ©é˜µå¿«é€Ÿå¹‚å‘¢ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯çŸ©é˜µçš„å¿«é€Ÿå¹‚å•¦ï¼\n\n\n\n\n\n\n\n\n\nä¸‹é¢ä¸ºäº†å™è¿°æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä½¿ç”¨æ–¹é˜µä¸¾ä¾‹ï¼ŒçŸ©é˜µä¹Ÿæœ‰åŒæ ·çš„æ€§è´¨ã€‚\nå¯¹äºä¸€ä¸ªæ–¹é˜µ,å®ƒçš„æ¬¡å¹‚ä¸ºï¼š\n\nå¯¹äºï¼Œéœ€è¦åšæ¬¡ä¹˜æ³•è¿ç®—ã€‚ç”±æ•´æ•°å¿«é€Ÿå¹‚çš„è®¡ç®—æ–¹æ³•ï¼Œä½ å¯èƒ½å·²ç»æƒ³åˆ°äº†ï¼Œæ–¹é˜µä¹Ÿå¯ä»¥ç®€åŒ–è¿ç®—ã€‚æ²¡é”™ï¼Œè¿™å°±æ˜¯çŸ©é˜µå¿«é€Ÿå¹‚ã€‚\nå¦‚:\nåŒæ ·åé¢çš„è¿ç®—ç»“æœå¯ä»¥ç”±å‰é¢çš„è¿ç®—ç»“æœè¿­ä»£è€Œæ¥:\n\n\n\n\nè¿ç®—è¿‡ç¨‹å’Œæ•´æ•°å¿«é€Ÿå¹‚ç›¸åŒï¼Œè€Œä¸¤ä¸ªçŸ©é˜µçš„ä¹˜æ³•è¿ç®—æˆ‘ä»¬æ—©å°±åˆ»è¿›DNAå•¦ æˆ‘ä»¬ä¹Ÿèƒ½æ²¡ä»€ä¹ˆéš¾åº¦åœ°å®ç°ã€‚\n\b\bé‚£ä¹ˆä¸‹é¢å°±æ˜¯æ–¹é˜µå¿«é€Ÿå¹‚çš„C++ä»£ç å®ç°äº†ï¼š\n/**\n * @description: æ–¹é˜µå¿«é€Ÿå¹‚\n * @param {SquareMatrix} A å¿«é€Ÿå¹‚çš„åº•ï¼Œå³æ–¹é˜µA\n * @param {int} n æŒ‡æ•°\n * @return {SquareMatrix} è®¡ç®—ç»“æœï¼Œå³A^n\n */\nSquareMatrix matrix_quick_power(SquareMatrix A,int n){\n    SquareMatrix base = A;\n    SquareMatrix result;\n    //å¯¹Bè¿›è¡Œåˆå§‹åŒ–ï¼Œåˆå§‹åŒ–ä¸ºå•ä½é˜µ\n    for(int i = 0;i &lt; N;i++){\n        for(int j = 0;j &lt; N;j++){\n            if(i == j){\n                result.matrix[i][j] = 1;\n            }else{\n                result.matrix[i][j] = 0;\n            }\n        }\n    }\n    while(n)\n    {\n        if(n&amp;1)\n        {\n            result = mul(result,base);\n        }\n        base = mul(base,base);\n        n = n&gt;&gt;1;\n    }\n    return result;\n}\n\né‚£ä¹ˆçŸ©é˜µå¿«é€Ÿå¹‚æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿè¯·åŒå­¦ä»¬è½¬åˆ°å¿«é€Ÿå¹‚ä»”ç»†é˜…è¯»ã€‚ ä¸æ˜¯æ‡’ä¸å†™å•Šï¼Œå·²ç»åŠ ç²—äº†ï¼Œè‡ªå·±æ²¡çœ‹é”™è¿‡äº†åæœè‡ªè´Ÿã€‚\n2. é«˜ç²¾åº¦è®¡ç®—é«˜ç²¾åº¦è®¡ç®—(Arbitrary-Precision Arithmetic)ï¼Œä¹Ÿè¢«ç§°ä½œå¤§æ•´æ•°(bignum)è®¡ç®—ï¼Œè¿ç”¨äº†ä¸€äº›ç®—æ³•ç»“æ„æ¥æ”¯æŒæ›´å¤§æ•´æ•°é—´çš„è¿ç®—(æ•°å­—å¤§å°è¶…è¿‡è¯­è¨€å†…å»ºæ•´å‹)ã€‚\næ­¤èŠ‚éš¾åº¦è¾ƒä½ï¼ŒåŒå­¦ä»¬ä»…éœ€çŸ¥é“ç«–å¼æ˜¯æ€ä¹ˆç®—çš„å°±è¡Œäº†ï¼Œæ¨¡æ‹Ÿå®ç°è¿™äº›è¿‡ç¨‹å°±å®Œäº‹äº†ã€‚\nä¸ä¼šå»ºè®®é€€å­¦é‡è¯»å°å­¦ã€‚\nå¯ä»¥å‚è€ƒé«˜ç²¾åº¦çš„æ¨¡ç‰ˆï¼šé«˜ç²¾åº¦è®¡ç®—\n3. ç»„åˆæ•°å­¦æ’åˆ—ç»„åˆæ˜¯ç»„åˆæ•°å­¦ä¸­çš„åŸºç¡€ã€‚\n\næ’åˆ—å°±æ˜¯æŒ‡ä»ç»™å®šä¸ªæ•°çš„å…ƒç´ ä¸­å–å‡ºæŒ‡å®šä¸ªæ•°çš„å…ƒç´ è¿›è¡Œæ’åº\nç»„åˆåˆ™æ˜¯æŒ‡ä»ç»™å®šä¸ªæ•°çš„å…ƒç´ ä¸­ä»…ä»…å–å‡ºæŒ‡å®šä¸ªæ•°çš„å…ƒç´ ï¼Œä¸è€ƒè™‘æ’åºã€‚\n\næ’åˆ—ç»„åˆçš„ä¸­å¿ƒé—®é¢˜æ˜¯ç ”ç©¶ç»™å®šè¦æ±‚çš„æ’åˆ—å’Œç»„åˆå¯èƒ½å‡ºç°çš„æƒ…å†µæ€»æ•°ã€‚æ’åˆ—ç»„åˆä¸å¤å…¸æ¦‚ç‡è®ºå…³ç³»å¯†åˆ‡ã€‚\nåœ¨æˆ‘ä»¬æ‰€æœ‰çš„æš´åŠ›ã€æšä¸¾é¢˜ç›®ä¸­ï¼Œæ— é—æ¼åœ°è¿›è¡Œæ’åˆ—ç»„åˆæ˜¯æˆ‘ä»¬è§£é¢˜çš„å…³é”®ã€‚\n3.1 æ’åˆ—ç»„åˆåŠ æ³•åŸç†ã€ä¹˜æ³•åŸç†ã€äºŒé¡¹å¼å®šç†å•¥çš„å¦‚æœä¸çŸ¥é“è‡ªå·±å›å»è¡¥è¯¾ï¼Œæ­¤å¤„é‡ç‚¹ä»‹ç»å…¨æ’åˆ—ã€‚\nä»€ä¹ˆæ˜¯å…¨æ’åˆ—å‘¢ï¼Ÿä»¥ä¸‰ä¸ªæ•°(çŠ¶æ€)ä¸ºä¾‹ï¼Œå®ƒä»¬çš„å…¨æ’åˆ—ä¸ºï¼š\n\nå¯¹äºç§çŠ¶æ€çš„å…¨æ’åˆ—è€Œè¨€ï¼Œå®ƒä»¬æœ‰ç§æƒ…å†µã€‚\nå¯¹äºè€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°å†™å‡ºå¯¹åº”çš„ä»£ç ï¼š\nvoid printPermutation () \n{\n    for (int i = 1; i &lt;= 3; ++i) \n    {\n        for (int j = 1; j &lt;= 3; ++j) \n        {\n            for (int k = 1; k &lt;= 3; ++k) \n            {\n                if (i == j || i == k || j == k) \n                {\n                    continue;\n                }\n                else \n                {\n                    print(i, j, k);\n                }\n            }\n        }\n    }\n}\n\nåœ¨çŠ¶æ€æ•°é‡è¾ƒå°‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¾ªç¯æ¥è¿›è¡Œå…¨æ’åˆ—ï¼Œä½†æ˜¯åœ¨çŠ¶æ€è¾ƒå¤šçš„æ—¶å€™ï¼Œå¾ªç¯å°±æ˜¾å¾—è¿‡äºç¹å¤ï¼ŒåŒæ—¶å¾ªç¯ä¹Ÿæ— æ³•å¤„ç†çŠ¶æ€æ•°é‡æœªçŸ¥çš„å…¨æ’åˆ—ã€‚æ­¤æ—¶æˆ‘ä»¬å°±åº”è¯¥è€ƒè™‘å…¶ä»–æ–¹æ³•å®ç°å…¨æ’åˆ—äº†ã€‚\né€’å½’å®ç°ï¼š\næˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå…¨æ’åˆ—æ˜¯æŠŠå·²çŸ¥çš„æ‰€æœ‰çŠ¶æ€æŒ‰ç…§ä¸åŒçš„é¡ºåºåˆ†åˆ«å±•ç¤ºå‡ºæ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸éš¾æƒ³åˆ°æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å›¾ç»“æ„å’Œæ·±åº¦ä¼˜å…ˆæœç´¢æ¥å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬åªéœ€è¦ä»ä¸åŒçš„èŠ‚ç‚¹å‡ºå‘ï¼Œéå†æœ‰æ‰€æœ‰çŠ¶æ€ç»„æˆçš„å›¾å³å¯ã€‚\nå…¶C++å®ç°å¦‚ä¸‹ï¼š\nvoid printPermutation(int x, int n, bool *Visited, int *answer)\n{\n\tif (x &gt; n)\n\t{\n\t\tfor (int i = 0; i &lt; n; i++)\n\t\t{\n\t\t\tprint(answer[i]);\n\t\t}\n\t}\n\tfor (int i = 0; i &lt; n; i++)\n\t{\n\t\tif (!Visited[i])\n\t\t{\n\t\t\tanswer[x-1] = i+1;\n\t\t\tVisited[i] = true;\n\t\t\tprintPermutation(x+1, n, Visited, answer);\n\t\t\tVisited[i] = false;\n\t\t}\n\t}\n}\n\nå½“ç„¶ï¼Œå»ºç«‹æ ‘å¹¶å¯¹æ ‘è¿›è¡Œéå†ä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ï¼Œæ›´å¤šçš„å†™æ³•å¯ä»¥è½¬åˆ°P1706 å…¨æ’åˆ—é—®é¢˜ é¢˜è§£ - æ´›è°·\nSTLå®ç°ï¼š\nåœ¨C++ STLä¸­ï¼Œæœ‰ä¸€ä¸ªå‡½æ•°å«åšå…¨æ’åˆ—å‡½æ•°ï¼Œå®ƒåˆ†ä¸ºnext_permutationå’Œprev_permutationï¼Œä½œç”¨æ˜¯æ±‚å½“å‰æ’åˆ—çš„ä¸Šä¸€ä¸ªæ’åˆ—å’Œä¸‹ä¸€ä¸ªæ’åˆ—ã€‚\nbool next_permutation(iterator start,iterator end);\nbool prev_permutation(iterator start,iterator end);\n\nå…¶ä¸­startæ˜¯æ’åˆ—çŠ¶æ€çš„å¼€å§‹ä½ç½®ï¼Œendæ˜¯æ’åˆ—çŠ¶æ€çš„ç»“æŸä½ç½®ï¼Œè¿”å›å€¼æ˜¯èƒ½å¦æ‰¾åˆ°ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªæ’åˆ—ï¼Œèƒ½åˆ™è¿”å›trueï¼Œä¸èƒ½åˆ™è¿”å›falseã€‚\nåŒæ—¶ï¼Œæ­¤å‡½æ•°çš„ä¸Šä¸€é¡¹ã€ä¸‹ä¸€é¡¹æŒ‰ç…§å­—å…¸åºè¿›è¡Œæ’åˆ—ã€‚\nè‡³äºå…·ä½“çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥è½¬åˆ°C++STLä¸­å…¨æ’åˆ—å‡½æ•°next_permutationçš„ä½¿ç”¨ - AC_Gibson\n3.2 å®¹æ–¥åŸç†æˆ‘ä»¬å…ˆå¼•å…¥ä¸€ä¸ªé—®é¢˜ï¼š\n\n\n\n\n\n\n\n\n\nå‡è®¾ç­é‡Œæœ‰ä¸ªå­¦ç”Ÿå–œæ¬¢æ•°å­¦ï¼Œä¸ªå­¦ç”Ÿå–œæ¬¢è¯­æ–‡ï¼Œä¸ªå­¦ç”Ÿå–œæ¬¢ç¼–ç¨‹ï¼Œç­é‡Œè‡³å°‘å–œæ¬¢ä¸€é—¨å­¦ç§‘çš„æœ‰å¤šå°‘ä¸ªå­¦ç”Ÿå‘¢ï¼Ÿ\næ˜¯ä¸ªå—ï¼Ÿæ˜¾ç„¶ä¸æ˜¯çš„ï¼Œå› ä¸ºæœ‰äº›å­¦ç”Ÿå¯èƒ½åŒæ—¶å–œæ¬¢æ•°å­¦å’Œè¯­æ–‡ï¼Œæˆ–è€…è¯­æ–‡å’Œç¼–ç¨‹ï¼Œç”šè‡³è¿˜æœ‰å¯èƒ½ä¸‰è€…éƒ½å–œæ¬¢ã€‚\nå¯¹äºä¸Šé¢çš„é—®é¢˜ï¼Œå…¶å¾ˆæœ‰å¯èƒ½æ˜¯ä¸‹å›¾è¿™ç§æƒ…å†µï¼š\n\n\nç°åœ¨æˆ‘ä»¬å¼•å…¥å®¹æ–¥åŸç†ã€‚\nè®¾ç§å…ƒç´ æœ‰ç§ä¸åŒçš„å±æ€§ï¼Œè€Œç¬¬ç§å±æ€§ç§°ä¸ºï¼Œæ‹¥æœ‰å±æ€§çš„å…ƒç´ æ„æˆé›†åˆï¼Œé‚£ä¹ˆæœ‰ï¼š\n\nå³ï¼š\n\nçœ‹æ‡‚äº†å—ï¼Ÿæ˜¯ä¸æ˜¯è¶…çº§ç®€å•ã€‚ ä¸Šé¢çš„ä¹±ä¸ƒå…«ç³Ÿçš„å…¬å¼å…¶å®å°±æ˜¯åœ¨åšä¸€ä»¶äº‹ï¼š\nå…ˆä¸è€ƒè™‘é‡å çš„æƒ…å†µï¼ŒæŠŠåŒ…å«äºæŸå†…å®¹ä¸­çš„æ‰€æœ‰å¯¹è±¡çš„æ•°ç›®å…ˆè®¡ç®—å‡ºæ¥ï¼Œç„¶åå†æŠŠè®¡æ•°æ—¶é‡å¤è®¡ç®—çš„æ•°ç›®æ’æ–¥å‡ºå»ï¼Œä½¿å¾—è®¡ç®—çš„ç»“æœæ—¢æ— é—æ¼åˆæ— é‡å¤ã€‚\nè¿™ç§åŸç†åœ¨æˆ‘ä»¬çš„ç¨‹åºè®¾è®¡ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚\n4. æ¦‚ç‡è®ºè¿™ç©æ„ä¸»è¦ä»¥ç†è®ºä¸ºä¸»ï¼Œä¸è®¡ç®—æœºæ²¡æœ‰ç›´æ¥äº¤é›†ï¼Œæ­¤å¤„è·³è¿‡ã€‚\n5. (é€‰å­¦)åšå¼ˆè®ºåšå¼ˆè®ºï¼Œæ˜¯ç»æµå­¦çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸»è¦ç ”ç©¶å…·æœ‰ç«äº‰æˆ–å¯¹æŠ—æ€§è´¨çš„å¯¹è±¡ï¼Œåœ¨ä¸€å®šè§„åˆ™ä¸‹äº§ç”Ÿçš„å„ç§è¡Œä¸ºã€‚åšå¼ˆè®ºè€ƒè™‘æ¸¸æˆä¸­çš„ä¸ªä½“çš„é¢„æµ‹è¡Œä¸ºå’Œå®é™…è¡Œä¸ºï¼Œå¹¶ç ”ç©¶å®ƒä»¬çš„ä¼˜åŒ–ç­–ç•¥ã€‚\né€šä¿—åœ°è®²ï¼Œåšå¼ˆè®ºä¸»è¦ç ”ç©¶çš„æ˜¯ï¼šåœ¨ä¸€ä¸ªæ¸¸æˆä¸­ï¼Œè¿›è¡Œæ¸¸æˆçš„å¤šä½ç©å®¶çš„ç­–ç•¥ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªNimæ¸¸æˆçš„ç¤ºä¾‹ï¼š\nå †ç‰©å“ï¼Œæ¯å †æœ‰ä¸ªï¼Œä¸¤ä¸ªç©å®¶è½®æµå–èµ°ä»»æ„ä¸€å †çš„ä»»æ„ä¸ªç‰©å“ï¼Œä½†ä¸èƒ½ä¸å–ã€‚å–èµ°æœ€åä¸€ä¸ªç‰©å“çš„äººè·èƒœã€‚\n\n\n\n\n\n\n\n\n\nä¾‹å¦‚ï¼Œå¦‚æœç°åœ¨æœ‰å †ç‰©å“ï¼Œè€Œæ¯å †åˆ†åˆ«æœ‰ä¸ªï¼Œé‚£ä¹ˆå¯ä»¥å–èµ°ç¬¬å †ä¸­çš„ä¸ªç‰©å“ï¼Œå±€é¢å°±å˜æˆäº†ï¼›æˆ–è€…ä¹Ÿå¯ä»¥å–èµ°ç¬¬å †çš„ä¸ªç‰©å“ï¼Œå±€é¢å°±å˜æˆäº†ã€‚\nå¦‚æœç°åœ¨çš„å±€é¢ä¸ºï¼Œç”²å–èµ°äº†ç¬¬å †çš„ä¸ªç‰©å“ï¼Œä¹Ÿå°±æ˜¯å–èµ°äº†æœ€åä¸€ä¸ªç‰©å“ï¼Œæ­¤æ—¶ç”²è·èƒœã€‚\nå¦‚æœå°†æ¯ä¸ªçŠ¶æ€è§†ä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå†ä»æ¯ä¸ªçŠ¶æ€å‘å®ƒçš„åç»§çŠ¶æ€è¿è¾¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªåšå¼ˆçŠ¶æ€å›¾ã€‚å¦‚æœèŠ‚ç‚¹è¡¨ç¤ºå±€é¢ä¸ºæ—¶çš„çŠ¶æ€ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥ç”»å‡ºä¸‹é¢çš„åšå¼ˆå›¾(ç”±äºç¯‡å¹…æœ‰é™ï¼Œæ•…ä»…æ˜¾ç¤ºéƒ¨åˆ†çŠ¶æ€èŠ‚ç‚¹å’Œéƒ¨åˆ†è¾¹)ï¼š\n\n\nå®šä¹‰å¿…èƒœçŠ¶æ€ä¸ºå…ˆæ‰‹å¿…èƒœçš„çŠ¶æ€ï¼Œå¿…è´¥çŠ¶æ€ä¸ºå…ˆæ‰‹å¿…è´¥çš„çŠ¶æ€ã€‚\né€šè¿‡æ¨ç†ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸‹é¢ä¸‰æ¡å®šç†ï¼š\n\nå®šç† 1ï¼šæ²¡æœ‰åç»§çŠ¶æ€çš„çŠ¶æ€æ˜¯å¿…è´¥çŠ¶æ€ã€‚\nå®šç† 2ï¼šä¸€ä¸ªçŠ¶æ€æ˜¯å¿…èƒœçŠ¶æ€å½“ä¸”ä»…å½“å­˜åœ¨è‡³å°‘ä¸€ä¸ªå¿…è´¥çŠ¶æ€ä¸ºå®ƒçš„åç»§çŠ¶æ€ã€‚\nå®šç† 3ï¼šä¸€ä¸ªçŠ¶æ€æ˜¯å¿…è´¥çŠ¶æ€å½“ä¸”ä»…å½“å®ƒçš„æ‰€æœ‰åç»§çŠ¶æ€å‡ä¸ºå¿…èƒœçŠ¶æ€.\n\nå¯¹äºå®šç† 1ï¼Œå¦‚æœæ¸¸æˆè¿›è¡Œä¸ä¸‹å»äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªç©å®¶å°±è¾“æ‰äº†æ¸¸æˆã€‚\nå¯¹äºå®šç† 2ï¼Œå¦‚æœè¯¥çŠ¶æ€è‡³å°‘æœ‰ä¸€ä¸ªåç»§çŠ¶æ€ä¸ºå¿…è´¥çŠ¶æ€ï¼Œé‚£ä¹ˆç©å®¶å¯ä»¥é€šè¿‡æ“ä½œåˆ°è¯¥å¿…è´¥çŠ¶æ€ï¼›æ­¤æ—¶å¯¹æ‰‹çš„çŠ¶æ€ä¸ºå¿…è´¥çŠ¶æ€â€”â€”å¯¹æ‰‹å¿…å®šæ˜¯å¤±è´¥çš„ï¼Œè€Œç›¸ååœ°ï¼Œè‡ªå·±å°±è·å¾—äº†èƒœåˆ©ã€‚\nå¯¹äºå®šç† 3ï¼Œå¦‚æœä¸å­˜åœ¨ä¸€ä¸ªåç»§çŠ¶æ€ä¸ºå¿…è´¥çŠ¶æ€ï¼Œé‚£ä¹ˆæ— è®ºå¦‚ä½•ï¼Œç©å®¶åªèƒ½æ“ä½œåˆ°å¿…èƒœçŠ¶æ€ï¼›æ­¤æ—¶å¯¹æ‰‹çš„çŠ¶æ€ä¸ºå¿…èƒœçŠ¶æ€â€”â€”å¯¹æ‰‹å¿…å®šæ˜¯èƒœåˆ©çš„ï¼Œè‡ªå·±å°±è¾“æ‰äº†æ¸¸æˆã€‚\nç°åœ¨æˆ‘ä»¬å®šä¹‰Nimå’Œï¼Œè®°ä½œï¼š\n\nåˆ™å½“ä¸”ä»…å½“æ—¶ï¼Œè¯¥çŠ¶æ€ä¸ºå¿…è´¥çŠ¶æ€ï¼Œå¦åˆ™ä¸ºå¿…èƒœçŠ¶æ€ã€‚\nè¯¥ç»“è®ºçš„è¯æ˜è¿‡ç¨‹å¯è§Nimæ¸¸æˆ - åšå¼ˆè®º\nä¸ºäº†è®¡ç®—è¿™ä¸ªï¼Œæˆ‘ä»¬å¼•å…¥å‡½æ•°ä¸å‡½æ•°ï¼š\n\nå³å‡½æ•°è®¡ç®—ä¸å±äºé›†åˆä¸­çš„æœ€å°éè´Ÿæ•´æ•°ã€‚\n\nå¯¹äºç”±ä¸ªæœ‰å‘å›¾æ¸¸æˆç»„æˆçš„ç»„åˆæ¸¸æˆï¼Œè®¾å®ƒä»¬çš„èµ·ç‚¹åˆ†åˆ«ä¸ºï¼Œåˆ™æœ‰å®šç†ï¼š\nå½“ä¸”ä»…å½“:\n\nè¿™ä¸ªæ¸¸æˆæ˜¯å…ˆæ‰‹å¿…èƒœçš„ã€‚\næˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å‡½æ•°ä¸çš„ç»“è®ºæ¥è®¡ç®—åšå¼ˆè®ºä¸­çš„å¿…èƒœé—®é¢˜äº†ã€‚\n6. è¿›åˆ¶è½¬æ¢è®²è¿‡å¤ªå¤šæ¬¡ï¼Œä¸æƒ³å†è®²äº†ã€‚\n","slug":"NumberTheory","date":"2021-04-07T19:19:19.000Z","categories_index":"notes","tags_index":"Number Theory,Algorithm,ACM","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"},{"id":"7f3e2fd4afd1d0c67545b22531185c26","title":"2019çº§æ•°æ®ç»“æ„æœŸä¸­æµ‹è¯•é¢˜ç›®ä¸è¯¦è§£","content":"ç”±äºè¿™æ¬¡æ•°æ®ç»“æ„æœŸä¸­è€ƒè¯•çš„é¢˜ç›®éƒ½åšå¯¹äº†ï¼Œæ•…å†™æ­¤é¢˜è§£ä¸å¤§å®¶åˆ†äº«ã€‚\né¢˜ç›®ä¸‹é¢ç¨‹åºæ®µçš„æ—¶é—´å¤æ‚åº¦æ˜¯( )\ni = 1;\nwhile (i &lt;= n) {\n    i = i * 3; \n}\n\nå¦‚æœå¯¹çº¿æ€§è¡¨çš„æ“ä½œåªæœ‰ä¸¤ç§ï¼Œå³åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨æœ€åä¸€ä¸ªå…ƒç´ çš„åé¢æ’å…¥æ–°å…ƒç´ ï¼Œåˆ™æœ€å¥½ä½¿ç”¨( )\nA. åªæœ‰è¡¨å¤´æŒ‡é’ˆæ²¡æœ‰è¡¨å°¾æŒ‡é’ˆçš„å¾ªç¯å•é“¾è¡¨B. åªæœ‰è¡¨å°¾æŒ‡é’ˆæ²¡æœ‰è¡¨å¤´æŒ‡é’ˆçš„å¾ªç¯å•é“¾è¡¨C. éå¾ªç¯åŒé“¾è¡¨D. å¾ªç¯åŒé“¾è¡¨\nä¸€ä¸ªæ ˆçš„è¿›æ ˆåºåˆ—æ˜¯ï¼Œåˆ™æ ˆçš„ä¸å¯èƒ½çš„è¾“å‡ºåºåˆ—æ˜¯( )\nA. B. C. D. \nè‹¥å·²çŸ¥ä¸€ä¸ªæ ˆçš„è¿›æ ˆåºåˆ—æ˜¯ï¼Œå…¶è¾“å‡ºåºåˆ—ä¸ºï¼Œè‹¥ï¼Œåˆ™ ä¸º( )\nA. B. C. D. ä¸ç¡®å®š\né˜Ÿåˆ—çš„â€œå…ˆè¿›å…ˆå‡ºâ€ç‰¹æ€§æ˜¯æŒ‡( )\nA. æœ€æ—©æ’å…¥é˜Ÿåˆ—ä¸­çš„å…ƒç´ æ€»æ˜¯æœ€åè¢«åˆ é™¤B. å½“åŒæ—¶è¿›è¡Œæ’å…¥ã€åˆ é™¤æ“ä½œæ—¶ï¼Œæ€»æ˜¯æ’å…¥æ“ä½œä¼˜å…ˆC. æ¯å½“æœ‰åˆ é™¤æ“ä½œæ—¶ï¼Œæ€»æ˜¯è¦å…ˆåšä¸€æ¬¡æ’å…¥æ“ä½œD. æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­åˆ é™¤çš„æ€»æ˜¯æœ€æ—©æ’å…¥çš„å…ƒç´ \nè‹¥Aæ˜¯æŒ‰åˆ—åºä¸ºä¸»åºè¿›è¡Œå­˜å‚¨çš„çš„äºŒç»´æ•°ç»„,å…¶æ¯ä¸ªå…ƒç´ å ç”¨3ä¸ªå­˜å‚¨å•å…ƒ,å¹¶ä¸”A[0][0]çš„å­˜å‚¨åœ°å€ä¸º1000,å…ƒç´ A[1][3]çš„å­˜å‚¨åœ°å€ä¸º( )ï¼Œè¯¥æ•°ç»„å…±å ç”¨( )ä¸ªå­˜å‚¨å•å…ƒã€‚\nè¡¨è¾¾å¼çš„åç¼€è¡¨è¾¾å¼ä¸º( )ã€‚\nå·²çŸ¥Lnodeæ˜¯å•é“¾è¡¨èŠ‚ç‚¹çš„ç±»å‹ï¼Œè¯·è¯´æ˜ä¸‹é¢å‡½æ•°çš„åŠŸèƒ½ã€‚\nvoid MADE(Lnode * &amp;H1) {\n    Lnode *p;\n    p = H1;\n    H1 = NULL;\n    while (p != NULL) {\n        Lnode *q = p;\n        p = p-&gt;next;\n        q-&gt;next = H1;\n        H1 = q;\n    } \n}\n\né¢˜è§£\nè®¾è®¡åŸºæœ¬è¯­å¥çš„æ‰§è¡Œæ¬¡æ•°ä¸ºï¼Œåˆ™æœ‰ã€‚å› æ­¤ã€‚\n\nå› ä¸ºéœ€è¦åœ¨æœ€åä¸€ä¸ªå…ƒç´ çš„åé¢æ’å…¥å…ƒç´ ï¼Œåˆ™æˆ‘ä»¬åªéœ€è¦çŸ¥é“æœ€åä¸€ä¸ªå…ƒç´ çš„ä½ç½®å³å°¾æŒ‡é’ˆå³ å¯ï¼Œåˆ™Aé¡¹ä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆéœ€è¦åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™æˆ‘ä»¬éœ€è¦çŸ¥é“ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä¸Šä¸€ä¸ªå…ƒç´ çš„ä½ ç½®å³å¤´æŒ‡é’ˆæˆ–è€…å¾ªç¯é“¾è¡¨çš„å°¾æŒ‡é’ˆï¼Œæ•…çŸ¥Bé¡¹æ»¡è¶³é¢˜æ„ï¼Œä¸”åŒé“¾è¡¨çš„ç©ºé—´å¤æ‚åº¦æ¯”å•é“¾è¡¨è¦é«˜ï¼Œ æ•…æœ¬é¢˜é€‰Bã€‚\n\nè‹¥è¿›æ ˆé¡ºåºä¸ºA, B, Cï¼Œåˆ™ä¸å¯èƒ½çš„å‡ºæ ˆæƒ…å†µä¸ºC, A, Bï¼Œè§‚å¯Ÿå¾—çŸ¥Cé¡¹å‡ºç°äº†A, B, Cè¿›æ ˆè€Œ C, A, Bå‡ºæ ˆçš„æƒ…å†µï¼Œåˆ™Cé¡¹æ˜¯ä¸å¯èƒ½çš„è¾“å‡ºåºåˆ—ã€‚\n\næ˜“çŸ¥è¿›æ ˆåºåˆ—ä¸º1 â†’ nï¼Œè€Œç¬¬ä¸€ä¸ªå‡ºæ ˆçš„å…ƒç´ ä¸ºnï¼Œåˆ™å¯ä»¥æ¨æ–­å‡ºæ‰€æœ‰å…ƒç´ éƒ½è¿›æ ˆäº†ä»¥åæ‰å¼€å§‹ æŠ›å‡ºå…ƒç´ ï¼Œåˆ™å‡ºæ ˆé¡ºåºä¸ºnâ†’1ï¼Œå³n,nâˆ’1,nâˆ’2,â‹¯,3,2,1ï¼Œåˆ™pi =nâˆ’i+1ï¼Œé€‰æ‹© Cé¡¹ã€‚\n\næ¦‚å¿µé¢˜ï¼Œé€‰Dã€‚\n\næ³¨æ„æ•°ç»„æŒ‰åˆ—åºå­˜å‚¨å³å¯ï¼Œç”»å›¾è§£å†³é—®é¢˜ï¼Œç­”æ¡ˆä¸º\n\nä½¿ç”¨è¯¾æœ¬ä¸Šçš„æ–¹æ³•æ¨¡æ‹Ÿä¸€éå³å¯è§£å†³é—®é¢˜ï¼Œç­”æ¡ˆä¸º[]\n\nç­”æ¡ˆä¸ºï¼š å°†H1åŠå…¶åé¢çš„æ‰€æœ‰èŠ‚ç‚¹ååºã€‚\n è¿™ä¸ªå‡½æ•°ä¸­çš„whileå¾ªç¯ä¸­ï¼Œåœ¨pæŒ‡é’ˆä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œæ¯è¿›è¡Œä¸€æ¬¡å¾ªç¯ï¼Œéƒ½ä¼šå°†på’Œp-1é—´çš„é“¾æ¥é¡ºåºä»p âˆ’ 1 â†’ pè½¬æ¢ä¸ºp â†’ p âˆ’ 1ï¼Œå¹¶ä¸”å°†pæŒ‡é’ˆå‘ä¸‹ä¸€ä¸ªå…ƒç´ è¿­ä»£ã€‚\n å½“å¾ªç¯å®Œæˆæ—¶ï¼Œè‹¥åŸæ¥çš„H1åŠå…¶åé¢çš„èŠ‚ç‚¹é¡ºåºä¸º:\n H1 -&gt; H2 -&gt; ... -&gt; Hn -&gt; NULL\n\n åˆ™æ‰§è¡Œç»“æœä¸º:\n NULL &lt;- H1 &lt;- H2 &lt;- ... &lt;- Hn\n\n\n\n","slug":"DataStructureAnswer","date":"2020-10-23T07:20:53.000Z","categories_index":"answer","tags_index":"Answer,DataStucture","author_index":"ğš‚ğšğš—ğš’ğšœğšğ™²"}]